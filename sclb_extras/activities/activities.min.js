!function($){$.fn.activityControls=function(action,options){var shouldReturnResults=!1,results=[],params=null;"object"==typeof(action=action||"initialize")&&(options=action,action="initialize"),"initialize"==action?options=options?$.extend(!0,{},$.fn.activityControls.defaults,options):$.fn.activityControls.defaults:params=options;var optionsReference=options;if($(this).each(function(){switch(action){case"initialize":!function(target,options){log(target,options,"Initializing Activity Controls","info"),(options=$.extend(!0,{},options)).containers.controls.reference=target,$(options.containers.controls.reference).hasClass(options.containers.controls.css.identifier)||$(options.containers.controls.reference).addClass(options.containers.controls.css.identifier);options.containers.top.reference||(options.containers.top.reference=$("<div />"),$(options.containers.controls.reference).append(options.containers.top.reference));$(options.containers.top.reference).hasClass(options.containers.top.css.identifier)||$(options.containers.top.reference).addClass(options.containers.top.css.identifier);options.containers.top.show||$(options.containers.top.reference).hasClass(options.containers.top.css.hidden)||$(options.containers.top.reference).addClass(options.containers.top.css.hidden);options.containers.bottom.reference||(options.containers.bottom.reference=$("<div />"),$(options.containers.controls.reference).append(options.containers.bottom.reference));$(options.containers.bottom.reference).hasClass(options.containers.bottom.css.identifier)||$(options.containers.bottom.reference).addClass(options.containers.bottom.css.identifier);options.containers.bottom.show||$(options.containers.bottom.reference).hasClass(options.containers.bottom.css.hidden)||$(options.containers.bottom.reference).addClass(options.containers.bottom.css.hidden);options.containers.positionIndicator.container.reference||(options.containers.positionIndicator.container.reference=$("<ul />"),$(options.containers.top.reference).append(options.containers.positionIndicator.container.reference));$(options.containers.positionIndicator.container.reference).hasClass(options.containers.positionIndicator.container.css.identifier)||$(options.containers.positionIndicator.container.reference).addClass(options.containers.positionIndicator.container.css.identifier);options.containers.status.reference||(options.containers.status.reference=$("<div />"),$(options.containers.bottom.reference).append(options.containers.status.reference));$(options.containers.status.reference).hasClass(options.containers.status.css.identifier)||$(options.containers.status.reference).addClass(options.containers.status.css.identifier);options.containers.buttons.container.reference||(options.containers.buttons.container.reference=$("<div />"),$(options.containers.bottom.reference).append(options.containers.buttons.container.reference));$(options.containers.buttons.container.reference).hasClass(options.containers.buttons.container.css.identifier)||$(options.containers.buttons.container.reference).addClass(options.containers.buttons.container.css.identifier);options.containers.buttons.previousSet.container.reference||(options.containers.buttons.previousSet.container.reference=$("<div />"),$(options.containers.buttons.container.reference).append(options.containers.buttons.previousSet.container.reference));$(options.containers.buttons.previousSet.container.reference).hasClass(options.containers.buttons.previousSet.container.css.identifier)||$(options.containers.buttons.previousSet.container.reference).addClass(options.containers.buttons.previousSet.container.css.identifier);options.containers.buttons.previousSet.container.show||$(options.containers.buttons.previousSet.container.reference).hasClass(options.containers.buttons.previousSet.container.css.hidden)||$(options.containers.buttons.previousSet.container.reference).addClass(options.containers.buttons.previousSet.container.css.hidden);options.containers.buttons.previousSet.label.reference||(options.containers.buttons.previousSet.label.reference=$("<div>"+options.containers.buttons.previousSet.label.label+"</div>"),$(options.containers.buttons.previousSet.container.reference).append(options.containers.buttons.previousSet.label.reference));$(options.containers.buttons.previousSet.label.reference).hasClass(options.containers.buttons.previousSet.label.css.identifier)||$(options.containers.buttons.previousSet.label.reference).addClass(options.containers.buttons.previousSet.label.css.identifier);options.containers.buttons.previousSet.overlay.reference||(options.containers.buttons.previousSet.overlay.reference=$("<div />"),$(options.containers.buttons.previousSet.container.reference).append(options.containers.buttons.previousSet.overlay.reference));$(options.containers.buttons.previousSet.overlay.reference).hasClass(options.containers.buttons.previousSet.overlay.css.identifier)||$(options.containers.buttons.previousSet.overlay.reference).addClass(options.containers.buttons.previousSet.overlay.css.identifier);options.containers.buttons.finish.container.reference||(options.containers.buttons.finish.container.reference=$("<div />"),$(options.containers.buttons.container.reference).append(options.containers.buttons.finish.container.reference));$(options.containers.buttons.finish.container.reference).hasClass(options.containers.buttons.finish.container.css.identifier)||$(options.containers.buttons.finish.container.reference).addClass(options.containers.buttons.finish.container.css.identifier);options.containers.buttons.finish.container.show||$(options.containers.buttons.finish.container.reference).hasClass(options.containers.buttons.finish.container.css.hidden)||$(options.containers.buttons.finish.container.reference).addClass(options.containers.buttons.finish.container.css.hidden);options.containers.buttons.finish.label.reference||(options.containers.buttons.finish.label.reference=$("<div>"+options.containers.buttons.finish.label.label+"</div>"),$(options.containers.buttons.finish.container.reference).append(options.containers.buttons.finish.label.reference));$(options.containers.buttons.finish.label.reference).hasClass(options.containers.buttons.finish.label.css.identifier)||$(options.containers.buttons.finish.label.reference).addClass(options.containers.buttons.finish.label.css.identifier);options.containers.buttons.finish.overlay.reference||(options.containers.buttons.finish.overlay.reference=$("<div />"),$(options.containers.buttons.finish.container.reference).append(options.containers.buttons.finish.overlay.reference));$(options.containers.buttons.finish.overlay.reference).hasClass(options.containers.buttons.finish.overlay.css.identifier)||$(options.containers.buttons.finish.overlay.reference).addClass(options.containers.buttons.finish.overlay.css.identifier);options.containers.buttons.reset.container.reference||(options.containers.buttons.reset.container.reference=$("<div />"),$(options.containers.buttons.container.reference).append(options.containers.buttons.reset.container.reference));$(options.containers.buttons.reset.container.reference).hasClass(options.containers.buttons.reset.container.css.identifier)||$(options.containers.buttons.reset.container.reference).addClass(options.containers.buttons.reset.container.css.identifier);options.containers.buttons.reset.container.show||$(options.containers.buttons.reset.container.reference).hasClass(options.containers.buttons.reset.container.css.hidden)||$(options.containers.buttons.reset.container.reference).addClass(options.containers.buttons.reset.container.css.hidden);options.containers.buttons.reset.label.reference||(options.containers.buttons.reset.label.reference=$("<div>"+options.containers.buttons.reset.label.label+"</div>"),$(options.containers.buttons.reset.container.reference).append(options.containers.buttons.reset.label.reference));$(options.containers.buttons.reset.label.reference).hasClass(options.containers.buttons.reset.label.css.identifier)||$(options.containers.buttons.reset.label.reference).addClass(options.containers.buttons.reset.label.css.identifier);options.containers.buttons.reset.overlay.reference||(options.containers.buttons.reset.overlay.reference=$("<div />"),$(options.containers.buttons.reset.container.reference).append(options.containers.buttons.reset.overlay.reference));$(options.containers.buttons.reset.overlay.reference).hasClass(options.containers.buttons.reset.overlay.css.identifier)||$(options.containers.buttons.reset.overlay.reference).addClass(options.containers.buttons.reset.overlay.css.identifier);options.containers.buttons.save.container.reference||(options.containers.buttons.save.container.reference=$("<div />"),$(options.containers.buttons.container.reference).append(options.containers.buttons.save.container.reference));$(options.containers.buttons.save.container.reference).hasClass(options.containers.buttons.save.container.css.identifier)||$(options.containers.buttons.save.container.reference).addClass(options.containers.buttons.save.container.css.identifier);options.containers.buttons.save.container.show||$(options.containers.buttons.save.container.reference).hasClass(options.containers.buttons.save.container.css.hidden)||$(options.containers.buttons.save.container.reference).addClass(options.containers.buttons.save.container.css.hidden);options.containers.buttons.save.label.reference||(options.containers.buttons.save.label.reference=$("<div>"+options.containers.buttons.save.label.label+"</div>"),$(options.containers.buttons.save.container.reference).append(options.containers.buttons.save.label.reference));$(options.containers.buttons.save.label.reference).hasClass(options.containers.buttons.save.label.css.identifier)||$(options.containers.buttons.save.label.reference).addClass(options.containers.buttons.save.label.css.identifier);options.containers.buttons.save.overlay.reference||(options.containers.buttons.save.overlay.reference=$("<div />"),$(options.containers.buttons.save.container.reference).append(options.containers.buttons.save.overlay.reference));$(options.containers.buttons.save.overlay.reference).hasClass(options.containers.buttons.save.overlay.css.identifier)||$(options.containers.buttons.save.overlay.reference).addClass(options.containers.buttons.save.overlay.css.identifier);options.containers.buttons.more.container.reference||(options.containers.buttons.more.container.reference=$("<div />"),$(options.containers.buttons.container.reference).append(options.containers.buttons.more.container.reference));$(options.containers.buttons.more.container.reference).hasClass(options.containers.buttons.more.container.css.identifier)||$(options.containers.buttons.more.container.reference).addClass(options.containers.buttons.more.container.css.identifier);options.containers.buttons.more.container.show||$(options.containers.buttons.more.container.reference).hasClass(options.containers.buttons.more.container.css.hidden)||$(options.containers.buttons.more.container.reference).addClass(options.containers.buttons.more.container.css.hidden);options.containers.buttons.more.label.reference||(options.containers.buttons.more.label.reference=$("<div>"+options.containers.buttons.more.label.label+"</div>"),$(options.containers.buttons.more.container.reference).append(options.containers.buttons.more.label.reference));$(options.containers.buttons.more.label.reference).hasClass(options.containers.buttons.more.label.css.identifier)||$(options.containers.buttons.more.label.reference).addClass(options.containers.buttons.more.label.css.identifier);options.containers.buttons.more.overlay.reference||(options.containers.buttons.more.overlay.reference=$("<div />"),$(options.containers.buttons.more.container.reference).append(options.containers.buttons.more.overlay.reference));$(options.containers.buttons.more.overlay.reference).hasClass(options.containers.buttons.more.overlay.css.identifier)||$(options.containers.buttons.more.overlay.reference).addClass(options.containers.buttons.more.overlay.css.identifier);options.containers.buttons.less.container.reference||(options.containers.buttons.less.container.reference=$("<div />"),$(options.containers.buttons.container.reference).append(options.containers.buttons.less.container.reference));$(options.containers.buttons.less.container.reference).hasClass(options.containers.buttons.less.container.css.identifier)||$(options.containers.buttons.less.container.reference).addClass(options.containers.buttons.less.container.css.identifier);options.containers.buttons.less.container.show||$(options.containers.buttons.less.container.reference).hasClass(options.containers.buttons.less.container.css.hidden)||$(options.containers.buttons.less.container.reference).addClass(options.containers.buttons.less.container.css.hidden);options.containers.buttons.less.label.reference||(options.containers.buttons.less.label.reference=$("<div>"+options.containers.buttons.less.label.label+"</div>"),$(options.containers.buttons.less.container.reference).append(options.containers.buttons.less.label.reference));$(options.containers.buttons.less.label.reference).hasClass(options.containers.buttons.less.label.css.identifier)||$(options.containers.buttons.less.label.reference).addClass(options.containers.buttons.less.label.css.identifier);options.containers.buttons.less.overlay.reference||(options.containers.buttons.less.overlay.reference=$("<div />"),$(options.containers.buttons.less.container.reference).append(options.containers.buttons.less.overlay.reference));$(options.containers.buttons.less.overlay.reference).hasClass(options.containers.buttons.less.overlay.css.identifier)||$(options.containers.buttons.less.overlay.reference).addClass(options.containers.buttons.less.overlay.css.identifier);options.containers.buttons.nextSet.container.reference||(options.containers.buttons.nextSet.container.reference=$("<div />"),$(options.containers.buttons.container.reference).append(options.containers.buttons.nextSet.container.reference));$(options.containers.buttons.nextSet.container.reference).hasClass(options.containers.buttons.nextSet.container.css.identifier)||$(options.containers.buttons.nextSet.container.reference).addClass(options.containers.buttons.nextSet.container.css.identifier);options.containers.buttons.nextSet.container.show||$(options.containers.buttons.nextSet.container.reference).hasClass(options.containers.buttons.nextSet.container.css.hidden)||$(options.containers.buttons.nextSet.container.reference).addClass(options.containers.buttons.nextSet.container.css.hidden);options.containers.buttons.nextSet.label.reference||(options.containers.buttons.nextSet.label.reference=$("<div>"+options.containers.buttons.nextSet.label.label+"</div>"),$(options.containers.buttons.nextSet.container.reference).append(options.containers.buttons.nextSet.label.reference));$(options.containers.buttons.nextSet.label.reference).hasClass(options.containers.buttons.nextSet.label.css.identifier)||$(options.containers.buttons.nextSet.label.reference).addClass(options.containers.buttons.nextSet.label.css.identifier);options.containers.buttons.nextSet.overlay.reference||(options.containers.buttons.nextSet.overlay.reference=$("<div />"),$(options.containers.buttons.nextSet.container.reference).append(options.containers.buttons.nextSet.overlay.reference));$(options.containers.buttons.nextSet.overlay.reference).hasClass(options.containers.buttons.nextSet.overlay.css.identifier)||$(options.containers.buttons.nextSet.overlay.reference).addClass(options.containers.buttons.nextSet.overlay.css.identifier);$(options.containers.buttons.finish.container.reference).bind("click",function(){$(this).attr("disabled")||$(target).trigger("finish.activityControls")}),$(options.containers.buttons.reset.container.reference).bind("click",function(){$(this).attr("disabled")||$(target).trigger("reset.activityControls")}),$(options.containers.buttons.more.container.reference).bind("click",function(){$(this).attr("disabled")||$(target).trigger("more.activityControls")}),$(options.containers.buttons.less.container.reference).bind("click",function(){$(this).attr("disabled")||$(target).trigger("less.activityControls")}),$(options.containers.buttons.nextSet.container.reference).bind("click",function(){$(this).attr("disabled")||$(target).trigger("nextSet.activityControls")}),$(options.containers.buttons.previousSet.container.reference).bind("click",function(){$(this).attr("disabled")||$(target).trigger("previousSet.activityControls")}),$(options.containers.buttons.save.container.reference).bind("click",function(){$(this).attr("disabled")||$(target).trigger("save.activityControls")}),$(target).data("activityControls:options",options),handleResize(target,options)}(this,optionsReference);break;case"setStatus":!function(target,options,status){$(options.containers.status.reference).html(status),alignToParent(target,options,options.containers.status.horizontalAlign,options.containers.status.verticalAlign,options.containers.status.reference)}(this,options=$(this).data("activityControls:options"),params);break;case"getStatus":var options=$(this).data("activityControls:options");shouldReturnResults=!0,results.push({target:this,result:function(target,options){return $(options.containers.status.reference).html()}(0,options)});break;case"setPositionIndicator":!function(target,options,numberOfSets,position){var currentIndicators=$(options.containers.positionIndicator.container.reference).find("."+options.containers.positionIndicator.indicator.css.identifier);if(currentIndicators.length>numberOfSets){var delta=currentIndicators.length-numberOfSets;$(currentIndicators.splice(currentIndicators.length-delta-1,delta)).remove()}else if(currentIndicators.length<numberOfSets)for(var delta=numberOfSets-currentIndicators.length,indicator=null,i=0;i<delta;i++)indicator=$("<li />"),$(indicator).addClass(options.containers.positionIndicator.indicator.css.identifier),$(options.containers.positionIndicator.container.reference).append(indicator),currentIndicators.push(indicator);$(currentIndicators).removeClass(options.containers.positionIndicator.indicator.css.active),$(currentIndicators).removeClass(options.containers.positionIndicator.indicator.css.inactive),$(currentIndicators).addClass(options.containers.positionIndicator.indicator.css.inactive),$(currentIndicators[position]).removeClass(options.containers.positionIndicator.indicator.css.inactive),$(currentIndicators[position]).addClass(options.containers.positionIndicator.indicator.css.active),alignToParent(target,options,options.containers.positionIndicator.container.horizontalAlign,options.containers.positionIndicator.container.verticalAlign,options.containers.positionIndicator.container.reference,options.containers.positionIndicator.container.horizontalOffset,options.containers.positionIndicator.container.verticalOffset)}(this,options=$(this).data("activityControls:options"),params.numberOfSets,params.position);break;case"updateControlsBasedOnSetPosition":!function(target,options,numberOfSets,position){0==position||0==numberOfSets?($(options.containers.buttons.previousSet.container.reference).attr("disabled","disabled"),$(options.containers.buttons.previousSet.container.reference).addClass(options.containers.buttons.previousSet.container.css.disabled)):($(options.containers.buttons.previousSet.container.reference).removeAttr("disabled"),$(options.containers.buttons.previousSet.container.reference).removeClass(options.containers.buttons.previousSet.container.css.disabled));position==numberOfSets-1||0==numberOfSets?($(options.containers.buttons.nextSet.container.reference).attr("disabled","disabled"),$(options.containers.buttons.nextSet.container.reference).addClass(options.containers.buttons.nextSet.container.css.disabled)):($(options.containers.buttons.nextSet.container.reference).removeAttr("disabled"),$(options.containers.buttons.nextSet.container.reference).removeClass(options.containers.buttons.nextSet.container.css.disabled))}(0,options=$(this).data("activityControls:options"),params.numberOfSets,params.position);break;case"showOrHideControls":showOrHideControls(this,options=$(this).data("activityControls:options"),params.previousSetButton,params.finishButton,params.resetButton,params.moreButton,params.lessButton,params.nextSetButton,params.positionIndicator,params.saveButton);break;case"showOrHideMoreAndLess":!function(target,options,moreButton,lessButton){moreButton||$(options.containers.buttons.more.container.reference).hasClass(options.containers.buttons.more.container.css.hidden)?moreButton&&$(options.containers.buttons.more.container.reference).hasClass(options.containers.buttons.more.container.css.hidden)&&$(options.containers.buttons.more.container.reference).removeClass(options.containers.buttons.more.container.css.hidden):$(options.containers.buttons.more.container.reference).addClass(options.containers.buttons.more.container.css.hidden);lessButton||$(options.containers.buttons.less.container.reference).hasClass(options.containers.buttons.less.container.css.hidden)?lessButton&&$(options.containers.buttons.less.container.reference).hasClass(options.containers.buttons.less.container.css.hidden)&&$(options.containers.buttons.less.container.reference).removeClass(options.containers.buttons.less.container.css.hidden):$(options.containers.buttons.less.container.reference).addClass(options.containers.buttons.less.container.css.hidden);options.containers.buttons.more.container.show=moreButton,options.containers.buttons.less.container.show=lessButton,$(target).data("activityControls:options"),handleResize(target,options)}(this,options=$(this).data("activityControls:options"),params.moreButton,params.lessButton);break;case"enableOrDisableFinishAndReset":!function(target,options,enableFinish,enableReset){enableFinish?($(options.containers.buttons.finish.container.reference).removeAttr("disabled"),$(options.containers.buttons.finish.container.reference).removeClass(options.containers.buttons.finish.container.css.disabled)):($(options.containers.buttons.finish.container.reference).attr("disabled","disabled"),$(options.containers.buttons.finish.container.reference).addClass(options.containers.buttons.finish.container.css.disabled));enableReset?($(options.containers.buttons.reset.container.reference).removeAttr("disabled"),$(options.containers.buttons.reset.container.reference).removeClass(options.containers.buttons.reset.container.css.disabled)):($(options.containers.buttons.reset.container.reference).attr("disabled","disabled"),$(options.containers.buttons.reset.container.reference).addClass(options.containers.buttons.reset.container.css.disabled))}(0,options=$(this).data("activityControls:options"),params.enableFinish,params.enableReset);break;case"enableOrDisableMoreAndLess":!function(target,options,enableMore,enableLess){enableMore?($(options.containers.buttons.more.container.reference).removeAttr("disabled"),$(options.containers.buttons.more.container.reference).removeClass(options.containers.buttons.more.container.css.disabled)):($(options.containers.buttons.more.container.reference).attr("disabled","disabled"),$(options.containers.buttons.more.container.reference).addClass(options.containers.buttons.more.container.css.disabled));enableLess?($(options.containers.buttons.less.container.reference).removeAttr("disabled"),$(options.containers.buttons.less.container.reference).removeClass(options.containers.buttons.less.container.css.disabled)):($(options.containers.buttons.less.container.reference).attr("disabled","disabled"),$(options.containers.buttons.less.container.reference).addClass(options.containers.buttons.less.container.css.disabled))}(0,options=$(this).data("activityControls:options"),params.enableMore,params.enableLess);break;case"enableOrDisableSave":!function(target,options,enableSave){enableSave?($(options.containers.buttons.save.container.reference).removeAttr("disabled"),$(options.containers.buttons.save.container.reference).removeClass(options.containers.buttons.save.container.css.disabled)):($(options.containers.buttons.save.container.reference).attr("disabled","disabled"),$(options.containers.buttons.save.container.reference).addClass(options.containers.buttons.save.container.css.disabled))}(0,options=$(this).data("activityControls:options"),params.enableSave);break;case"setAllowSaveButton":(options=$(this).data("activityControls:options")).data.allowSaveButton=params,showOrHideControls(this,options,options.containers.buttons.previousSet.container.show,options.containers.buttons.finish.container.show,options.containers.buttons.reset.container.show,options.containers.buttons.more.container.show,options.containers.buttons.less.container.show,options.containers.buttons.nextSet.container.show,options.containers.top.show,options.containers.buttons.save.container.show);break;case"getAllowSaveButton":options=$(this).data("activityControls:options");shouldReturnResults=!0,results.push({target:this,result:options.data.allowSaveButton});break;case"resize":log(this,options=$(this).data("activityControls:options"),"Action:Resizing the controls","info"),handleResize(this,options)}}),1==shouldReturnResults)return results;function log(target,options,data,level){level=level||"debug",level=$.trim(level).toLowerCase();var log_prefix="[ActivityControls]["+target,log_suffix="]"+data;options.data.enableLogging&&window.console&&("info"==level&&window.console.info&&options.logging.info?$(target).attr("id")?window.console.info(log_prefix+", id="+$(target).attr("id")+log_suffix):$(target).attr("name")?window.console.info(log_prefix+", name="+$(target).attr("name")+log_suffix):window.console.info(log_prefix+log_suffix):"warn"==level&&window.console.warn&&options.logging.warn?$(target).attr("id")?window.console.warn(log_prefix+", id="+$(target).attr("id")+log_suffix):$(target).attr("name")?window.console.warn(log_prefix+", name="+$(target).attr("name")+log_suffix):window.console.warn(log_prefix+log_suffix):"error"==level&&window.console.error&&options.logging.error?$(target).attr("id")?window.console.error(log_prefix+", id="+$(target).attr("id")+log_suffix):$(target).attr("name")?window.console.error(log_prefix+", name="+$(target).attr("name")+log_suffix):window.console.error(log_prefix+log_suffix):window.console.log&&options.logging.debug&&($(target).attr("id")?window.console.log(log_prefix+", id="+$(target).attr("id")+log_suffix):$(target).attr("name")?window.console.log(log_prefix+", name="+$(target).attr("name")+log_suffix):window.console.log(log_prefix+log_suffix)))}function showOrHideControls(target,options,previousSetButton,finishButton,resetButton,moreButton,lessButton,nextSetButton,positionIndicator,saveButton){previousSetButton||$(options.containers.buttons.previousSet.container.reference).hasClass(options.containers.buttons.previousSet.container.css.hidden)?previousSetButton&&$(options.containers.buttons.previousSet.container.reference).hasClass(options.containers.buttons.previousSet.container.css.hidden)&&$(options.containers.buttons.previousSet.container.reference).removeClass(options.containers.buttons.previousSet.container.css.hidden):$(options.containers.buttons.previousSet.container.reference).addClass(options.containers.buttons.previousSet.container.css.hidden),finishButton||$(options.containers.buttons.finish.container.reference).hasClass(options.containers.buttons.finish.container.css.hidden)?finishButton&&$(options.containers.buttons.finish.container.reference).hasClass(options.containers.buttons.finish.container.css.hidden)&&$(options.containers.buttons.finish.container.reference).removeClass(options.containers.buttons.finish.container.css.hidden):$(options.containers.buttons.finish.container.reference).addClass(options.containers.buttons.finish.container.css.hidden),resetButton||$(options.containers.buttons.reset.container.reference).hasClass(options.containers.buttons.reset.container.css.hidden)?resetButton&&$(options.containers.buttons.reset.container.reference).hasClass(options.containers.buttons.reset.container.css.hidden)&&$(options.containers.buttons.reset.container.reference).removeClass(options.containers.buttons.reset.container.css.hidden):$(options.containers.buttons.reset.container.reference).addClass(options.containers.buttons.reset.container.css.hidden),moreButton||$(options.containers.buttons.more.container.reference).hasClass(options.containers.buttons.more.container.css.hidden)?moreButton&&$(options.containers.buttons.more.container.reference).hasClass(options.containers.buttons.more.container.css.hidden)&&$(options.containers.buttons.more.container.reference).removeClass(options.containers.buttons.more.container.css.hidden):$(options.containers.buttons.more.container.reference).addClass(options.containers.buttons.more.container.css.hidden),lessButton||$(options.containers.buttons.less.container.reference).hasClass(options.containers.buttons.less.container.css.hidden)?lessButton&&$(options.containers.buttons.less.container.reference).hasClass(options.containers.buttons.less.container.css.hidden)&&$(options.containers.buttons.less.container.reference).removeClass(options.containers.buttons.less.container.css.hidden):$(options.containers.buttons.less.container.reference).addClass(options.containers.buttons.less.container.css.hidden),nextSetButton||$(options.containers.buttons.nextSet.container.reference).hasClass(options.containers.buttons.nextSet.container.css.hidden)?nextSetButton&&$(options.containers.buttons.nextSet.container.reference).hasClass(options.containers.buttons.nextSet.container.css.hidden)&&$(options.containers.buttons.nextSet.container.reference).removeClass(options.containers.buttons.nextSet.container.css.hidden):$(options.containers.buttons.nextSet.container.reference).addClass(options.containers.buttons.nextSet.container.css.hidden),positionIndicator||$(options.containers.top.reference).hasClass(options.containers.top.css.hidden)?positionIndicator&&$(options.containers.top.reference).hasClass(options.containers.top.css.hidden)&&$(options.containers.top.reference).removeClass(options.containers.top.css.hidden):$(options.containers.top.reference).addClass(options.containers.top.css.hidden),options.data.allowSaveButton?saveButton||$(options.containers.buttons.save.container.reference).hasClass(options.containers.buttons.save.container.css.hidden)?saveButton&&$(options.containers.buttons.save.container.reference).hasClass(options.containers.buttons.save.container.css.hidden)&&$(options.containers.buttons.save.container.reference).removeClass(options.containers.buttons.save.container.css.hidden):$(options.containers.buttons.save.container.reference).addClass(options.containers.buttons.save.container.css.hidden):$(options.containers.buttons.save.container.reference).hasClass(options.containers.buttons.save.container.css.hidden)||$(options.containers.buttons.save.container.reference).addClass(options.containers.buttons.save.container.css.hidden),options.containers.buttons.previousSet.container.show=previousSetButton,options.containers.buttons.finish.container.show=finishButton,options.containers.buttons.reset.container.show=resetButton,options.containers.buttons.more.container.show=moreButton,options.containers.buttons.less.container.show=lessButton,options.containers.buttons.nextSet.container.show=nextSetButton,options.containers.buttons.save.container.show=saveButton,options.containers.top.show=positionIndicator,$(target).data("activityControls:options"),handleResize(target,options)}function alignToParent(target,options,horizontalAlign,verticalAlign,container,horizontalOffset,verticalOffset){if(horizontalOffset=horizontalOffset||0,verticalOffset=verticalOffset||0,$(container).css("position","absolute"),horizontalAlign)switch(horizontalAlign.toLowerCase()){case"left":$(container).css("right",null).css("left",horizontalOffset+"px");break;case"right":$(container).css("left",null).css("right",horizontalOffset+"px");break;case"center":$(container).css("right",null).css("left",$(container).parent().innerWidth()/2-$(container).outerWidth()/2+horizontalOffset+"px")}if(verticalAlign)switch(verticalAlign.toLowerCase()){case"top":$(container).css("bottom",null).css("top",verticalOffset+"px");break;case"bottom":$(container).css("top",null).css("bottom",verticalOffset+"px");break;case"middle":$(container).css("bottom",null).css("top",$(container).parent().innerHeight()/2-$(container).outerHeight()/2+verticalOffset+"px")}}function handleResize(target,options){var controlsContainerPadding=function(target,options,container){var paddingTestDiv=$('<div style="padding:0px 0px 0px 0px;"/>');paddingTestDiv.css("padding-top",$(container).css("padding-top"));var paddingTop=$(paddingTestDiv).height();paddingTestDiv.css("padding-top","0px"),paddingTestDiv.css("padding-right",$(container).css("padding-right"));var paddingRight=$(paddingTestDiv).width();paddingTestDiv.css("padding-right","0px"),paddingTestDiv.css("padding-bottom",$(container).css("padding-bottom"));var paddingBottom=$(paddingTestDiv).height();paddingTestDiv.css("padding-bottom","0px"),paddingTestDiv.css("padding-left",$(container).css("padding-left"));var paddingLeft=$(paddingTestDiv).width();return paddingTestDiv.css("padding-left","0px"),{top:paddingTop,right:paddingRight,bottom:paddingBottom,left:paddingLeft}}(0,0,options.containers.controls.reference);$(options.containers.bottom.reference).height($(options.containers.controls.reference).innerHeight()-$(options.containers.top.reference).outerHeight()-controlsContainerPadding.top-controlsContainerPadding.bottom),alignToParent(0,0,options.containers.positionIndicator.container.horizontalAlign,options.containers.positionIndicator.container.verticalAlign,options.containers.positionIndicator.container.reference,options.containers.positionIndicator.container.horizontalOffset,options.containers.positionIndicator.container.verticalOffset),alignToParent(0,0,options.containers.status.horizontalAlign,options.containers.status.verticalAlign,options.containers.status.reference),alignToParent(0,0,options.containers.buttons.container.horizontalAlign,options.containers.buttons.container.verticalAlign,options.containers.buttons.container.reference),alignToParent(0,0,options.containers.buttons.previousSet.label.horizontalAlign,options.containers.buttons.previousSet.label.verticalAlign,options.containers.buttons.previousSet.label.reference),alignToParent(0,0,options.containers.buttons.finish.label.horizontalAlign,options.containers.buttons.finish.label.verticalAlign,options.containers.buttons.finish.label.reference),alignToParent(0,0,options.containers.buttons.reset.label.horizontalAlign,options.containers.buttons.reset.label.verticalAlign,options.containers.buttons.reset.label.reference),alignToParent(0,0,options.containers.buttons.more.label.horizontalAlign,options.containers.buttons.more.label.verticalAlign,options.containers.buttons.more.label.reference),alignToParent(0,0,options.containers.buttons.less.label.horizontalAlign,options.containers.buttons.less.label.verticalAlign,options.containers.buttons.less.label.reference),alignToParent(0,0,options.containers.buttons.nextSet.label.horizontalAlign,options.containers.buttons.nextSet.label.verticalAlign,options.containers.buttons.nextSet.label.reference),alignToParent(0,0,options.containers.buttons.save.label.horizontalAlign,options.containers.buttons.save.label.verticalAlign,options.containers.buttons.save.label.reference)}return this},$.fn.activityControls.defaults={},$.fn.activityControls.defaults.containers={controls:{reference:null,css:{identifier:"softchalk-activity-controls"}},top:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-top",hidden:"hidden"}},bottom:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-bottom",hidden:"hidden"}},status:{reference:null,horizontalAlign:"left",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-status"}},positionIndicator:{container:{reference:null,horizontalAlign:"center",horizontalOffset:0,verticalAlign:"middle",verticalOffset:2,css:{identifier:"softchalk-activity-controls-position-indicator-container",hidden:"hidden"}},indicator:{references:[],css:{identifier:"softchalk-activity-controls-position-indicator",active:"active",inactive:"inactive"}}},buttons:{container:{reference:null,horizontalAlign:"right",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-button-container"}},finish:{container:{reference:null,show:!1,css:{identifier:"softchalk-activity-controls-finish-button",hidden:"hidden",disabled:"disabled"}},overlay:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-finish-overlay"}},label:{reference:null,label:"",horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-finish-label"}}},reset:{container:{reference:null,show:!1,css:{identifier:"softchalk-activity-controls-reset-button",hidden:"hidden",disabled:"disabled"}},overlay:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-reset-overlay"}},label:{reference:null,label:"",horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-reset-label"}}},more:{container:{reference:null,show:!1,css:{identifier:"softchalk-activity-controls-more-button",hidden:"hidden",disabled:"disabled"}},overlay:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-more-overlay"}},label:{reference:null,label:"",horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-more-label"}}},less:{container:{reference:null,show:!1,css:{identifier:"softchalk-activity-controls-less-button",hidden:"hidden",disabled:"disabled"}},overlay:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-less-overlay"}},label:{reference:null,label:"",horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-less-label"}}},nextSet:{container:{reference:null,show:!1,css:{identifier:"softchalk-activity-controls-next-set-button",hidden:"hidden",disabled:"disabled"}},overlay:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-next-set-overlay"}},label:{reference:null,label:"",horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-next-set-label"}}},previousSet:{container:{reference:null,show:!1,css:{identifier:"softchalk-activity-controls-previous-set-button",hidden:"hidden",disabled:"disabled"}},overlay:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-previous-set-overlay"}},label:{reference:null,label:"",horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-previous-set-label"}}},save:{container:{reference:null,show:!1,css:{identifier:"softchalk-activity-controls-save-button",hidden:"hidden",disabled:"disabled"}},overlay:{reference:null,show:!0,css:{identifier:"softchalk-activity-controls-save-overlay"}},label:{reference:null,label:"",horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-activity-controls-save-label"}}}}},$.fn.activityControls.defaults.data={allowSaveButton:!1,enableLogging:!1},$.fn.activityControls.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery),function($){$.fn.activityEmbed=function(action,options,params){var data=$.fn.activityEmbed.defaults.data;if("object"==typeof(action=action||"initialize")&&(params?(params=options,options=action):(params=action,options=null),action="initialize"),"initialize"==action){if(!$.fn.activityEmbed.defaults.data.browserChecksPerformed)try{document.createElement("canvas")&&($.fn.activityEmbed.defaults.data.hasCanvas=!0),document.createElement("audio")&&($.fn.activityEmbed.defaults.data.hasAudio=!0),data.hasCanvas||($.fn.activityEmbed.defaults.data.useFlashAsDefault=!0)}catch(e){}finally{$.fn.activityEmbed.defaults.data.browserChecksPerformed=!0}options=options?$.extend(!0,{},$.fn.activityEmbed.defaults,options):$.fn.activityEmbed.defaults}var optionsReference=options;function log(target,options,data,level){if(level=level||"debug",level=$.trim(level).toLowerCase(),options.data.enableLogging&&window.console){function logger_available(ltype){return level==ltype&&window.console[ltype]&&options.logging[ltype]}function dolog(ltype){var lstr="[ActivityWrapper]["+target,$targ=$(target);function add_attr(attr_type){var attr=$targ.attr(attr_type);attr&&(lstr+=", "+attr_type+"= "+attr)}add_attr("id"),add_attr("name"),window.console[ltype](lstr+"]"+data)}if(logger_available("info"))return void dolog("info");if(logger_available("warn"))return void dolog("warn");if(logger_available("error"))return void dolog("error");if(window.console.log&&options.logging.debug)return void dolog("log")}}function embedFlash(target,options,params,swf,flashVars){var id=$(target).attr("id"),swfName=swf.replace(".swf",""),serializedFlashVars="";$.each(flashVars,function(key,value){null!=value&&void 0!=value&&(""!=serializedFlashVars&&(serializedFlashVars+="&"),serializedFlashVars+=key+"="+value)}),""!=serializedFlashVars&&(serializedFlashVars="?"+serializedFlashVars);var fo=new FlashObject(swf+serializedFlashVars,swfName,params.width,params.height,options.data.minimumFlashVersion,params.color);fo.addParam("allowScriptAccess","sameDomain"),fo.addParam("quality","high"),fo.addParam("scale","noscale"),fo.addParam("redirectUrl","http://get.adobe.com/flashplayer"),fo.addParam("wmode","transparent"),fo.write(id),$(target).data("activityEmbed:type","flash")}function setTargetDimensions(target,options,params){params.width&&params.height&&$(target).css({width:params.width,height:params.height})}return $(this).each(function(){switch(action){case"initialize":!function(target,options,params){log(target,options,"Initializing Activity Embed","info"),options=$.extend(!0,{},options);var type=(""+params.type).toLowerCase();try{switch(type){case"2":case"flashcard":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var width=params.width?params.width:550,height=params.height?params.height:400;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"flashcard",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,backgroundColor:"#"+params.color.replace("#","").replace("0x","")})}else{var swf=options.swf.flashCard,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"3":case"seekaword":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='SEEK_A_WORD_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","SEEK_A_WORD_EJS_SCRIPT"),$(templateScript).text(SEEK_A_WORD_EJS),$("head").append(templateScript));var width=params.width?params.width:638,height=params.height?params.height:500;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"seekaword",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,sqrsize:parseInt(params.flashVars.sqrsize),instructions:params.flashVars.instructions,hint:params.flashVars.hint,backgroundColor:"#"+params.color.replace("#","").replace("0x","")});var handleScoring=function(jsonObj){window.cookit&&jsonObj.maxScore>0&&window.cookit(jsonObj.id+"score",jsonObj.curScore/jsonObj.maxScore*100,jsonObj.id+"attempts",jsonObj.attempts)};$(target).bind("sc.seekaword.complete",function(event,jsonObj){log(target,options,"SeekAWord Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)}).bind("sc.seekaword.reset",function(event,jsonObj){log(target,options,"SeekAWord Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)})}else{var swf=options.swf.seekAWord,flashVars=$.extend({},{datafile:params.dataFile,bgcolor:params.color,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"4":case"dragndrop":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='DRAG_N_DROP_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","DRAG_N_DROP_EJS_SCRIPT"),$(templateScript).text(DRAG_N_DROP_EJS),$("head").append(templateScript));var width=params.width?params.width:550,height=params.height?params.height:500;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"dragndrop",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,backgroundColor:"#"+params.color.replace("#","").replace("0x","")});var handleScoring=function(jsonObj){if(window.cookit&&jsonObj.maxScore>0){var pts=jsonObj.curScore*(jsonObj.maxScore/jsonObj.innerState.length),percent=(pts=Math.round(10*pts)/10)/jsonObj.maxScore*100;window.cookit(jsonObj.id+"score",percent,jsonObj.id+"attempts",jsonObj.attempts)}};$(target).bind("sc.dragndrop.complete",function(event,jsonObj){log(target,options,"DragNDrop Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)}).bind("sc.dragndrop.reset",function(event,jsonObj){log(target,options,"DragNDrop Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)})}else{var swf=options.swf.dragNDrop,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"5":case"ordering":case"oldordering":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='ORDERING_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","ORDERING_EJS_SCRIPT"),$(templateScript).text(ORDERING_EJS),$("head").append(templateScript));var width=params.width?params.width:550,height=params.height?params.height:500;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"ordering",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,backgroundColor:"#"+params.color.replace("#","").replace("0x","")});var handleScoring=function(jsonObj){if(console.log("handle scoring..."),window.cookit&&jsonObj.maxScore>0){var pts=jsonObj.curScore*(jsonObj.maxScore/jsonObj.innerState.length),percent=(pts=Math.round(10*pts)/10)/jsonObj.maxScore*100;window.cookit(jsonObj.id+"score",percent,jsonObj.id+"attempts",jsonObj.attempts)}};$(target).bind("sc.ordering.complete",function(event,jsonObj){log(target,options,"Ordering Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)}).bind("sc.ordering.reset",function(event,jsonObj){log(target,options,"Ordering Puzzle Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)})}else{var swf=options.swf.ordering,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"6":case"crossword":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='CROSSWORD_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","CROSSWORD_EJS_SCRIPT"),$(templateScript).text(CROSSWORD_EJS),$("head").append(templateScript));var width=params.width?params.width:640,height=params.height?params.height:500;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"crossword",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,solve:params.flashVars.solve,sclb_version:params.flashVars.sclb_version,backgroundColor:"#"+params.color.replace("#","").replace("0x","")});var handleScoring=function(jsonObj){if(window.cookit&&jsonObj.maxScore>0){var pts=jsonObj.curScore*(jsonObj.maxScore/jsonObj.pointsArr.length),percent=(pts=Math.round(10*pts)/10)/jsonObj.maxScore*100;window.cookit(jsonObj.id+"score",percent,jsonObj.id+"attempts",jsonObj.attempts)}};$(target).bind("sc.crossword.complete",function(event,jsonObj){log(target,options,"Crossword Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)}).bind("sc.crossword.reset",function(event,jsonObj){log(target,options,"Crossword Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)})}else{var swf=options.swf.crossword,flashVars=$.extend({},{datafile:params.dataFile,bgcolor:params.color,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"7":case"labeling":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='LABELING_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","LABELING_EJS_SCRIPT"),$(templateScript).text(LABELING_EJS),$("head").append(templateScript));var width=params.width?params.width:600,height=params.height?params.height:500;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"labeling",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,backgroundColor:"#"+params.color.replace("#","").replace("0x","")});var handleScoring=function(jsonObj){if(window.cookit&&jsonObj.maxScore>0){var pts=jsonObj.curScore*(jsonObj.maxScore/jsonObj.innerState.length),percent=(pts=Math.round(10*pts)/10)/jsonObj.maxScore*100;window.cookit(jsonObj.id+"score",percent,jsonObj.id+"attempts",jsonObj.attempts)}};$(target).bind("sc.labeling.complete",function(event,jsonObj){log(target,options,"Labeling Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)}).bind("sc.labeling.reset",function(event,jsonObj){log(target,options,"Labeling Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)})}else{var swf=options.swf.labeling,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"8":case"sorting":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='SORTING_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","SORTING_EJS_SCRIPT"),$(templateScript).text(SORTING_EJS),$("head").append(templateScript));var width=params.width?params.width:550,height=params.height?params.height:450;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"sorting",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,backgroundColor:"#"+params.color.replace("#","").replace("0x","")});var handleScoring=function(jsonObj){if(window.cookit&&jsonObj.maxScore>0){var pts=jsonObj.curScore*(jsonObj.maxScore/jsonObj.innerState.length),percent=(pts=Math.round(10*pts)/10)/jsonObj.maxScore*100;window.cookit(jsonObj.id+"score",percent,jsonObj.id+"attempts",jsonObj.attempts)}};$(target).bind("sc.sorting.complete",function(event,jsonObj){log(target,options,"Sorting Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)}).bind("sc.sorting.reset",function(event,jsonObj){log(target,options,"Sorting Score Reset ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)})}else{var swf=options.swf.sorting,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"9":case"hotspot":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='HOTSPOT_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","HOTSPOT_EJS_SCRIPT"),$(templateScript).text(HOTSPOT_EJS),$("head").append(templateScript));var width=params.width?params.width:550,height=params.height?params.height:500;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"hotspot",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,backgroundColor:"#"+params.color.replace("#","").replace("0x","")});var handleScoring=function(jsonObj){if(window.cookit&&jsonObj.maxScore>0){var pts=jsonObj.curScore*(jsonObj.maxScore/jsonObj.innerState.length),percent=(pts=Math.round(10*pts)/10)/jsonObj.maxScore*100;window.cookit(jsonObj.id+"score",percent,jsonObj.id+"attempts",jsonObj.attempts)}};$(target).bind("sc.hotspot.complete",function(event,jsonObj){log(target,options,"HotSpot Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)}).bind("sc.hotspot.reset",function(event,jsonObj){log(target,options,"HotSpot Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)})}else{var swf=options.swf.hotSpot,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"10":case"timeline":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='TIMELINE_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","TIMELINE_EJS_SCRIPT"),$(templateScript).text(TIMELINE_EJS),$("head").append(templateScript));var width=params.width?params.width:540,height=params.height?params.height:410;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"timeline",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,backgroundColor:"#"+params.color.replace("#","").replace("0x","")})}else{var swf=options.swf.timeline,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"11":case"slideshow":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var width=params.width?params.width:640,height=params.height?params.height:580;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"slideshow",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,backgroundColor:"#"+params.color.replace("#","").replace("0x","")})}else{var swf=options.swf.slideshow,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"12":case"photoalbum":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var width=params.width?params.width:800,height=params.height?params.height:560;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"photoalbum",xmlPath:params.dataFile,id:params.actNum,textAlign:params.textAlign||"left",width:width,height:height,backgroundColor:"#"+params.color.replace("#","").replace("0x","")})}else{var swf=options.swf.photoAlbum,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"13":case"sectionedshape":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var width=params.width?params.width:720,height=params.height?params.height:450;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"sectionedshape",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,backgroundColor:"#"+params.color.replace("#","").replace("0x","")})}else{var swf=options.swf.sectionedShape,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;case"14":case"tabbedpane":!function(target,options,params){setTargetDimensions(target,options,params);var width=params.width?params.width:800,height=params.height?params.height:200;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"tabbedpane",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,backgroundColor:"#"+params.color.replace("#","").replace("0x","")})}(target,options,params);break;case"15":case"didyouknow":!function(target,options,params){setTargetDimensions(target,options,params);var width=params.width?params.width:800,height=params.height?params.height:200;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"didyouknow",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,backgroundColor:"#"+params.color.replace("#","").replace("0x","")})}(target,options,params);break;case"16":case"jigsawpuzzle":case"puzzle":!function(target,options,params){if(setTargetDimensions(target,options,params),!options.data.useFlashAsDefault&&options.data.hasCanvas&&options.data.hasAudio){var templateScript=$("script[id='PUZZLE_EJS_SCRIPT']");0==templateScript.length&&(templateScript=document.createElement("script"),$(templateScript).attr("type","text/ejs"),$(templateScript).attr("id","PUZZLE_EJS_SCRIPT"),$(templateScript).text(PUZZLE_EJS),$("head").append(templateScript));var width=params.width?params.width:720,height=params.height?params.height:450;params.id&&"#"==params.id[0]&&(params.id=params.id.substr(1)),$(target).data("activityEmbed:type","html"),$(target).html(""),$(target).plugin("initialize",{containerId:params.id,type:"jigsawpuzzle",xmlPath:params.dataFile,id:params.actNum,width:width,height:height,showRestart:params.restart,backgroundColor:"#"+params.color.replace("#","").replace("0x","")});var handleScoring=function(jsonObj){console.log("handlescoring"),window.cookit&&jsonObj.maxScore>0&&window.cookit(jsonObj.id+"score",jsonObj.curScore/jsonObj.maxScore*100,jsonObj.id+"attempts",jsonObj.attempts)};$(target).bind("sc.jigsawpuzzle.complete",function(event,jsonObj){log(target,options,"Jigsaw Puzzle Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)}).bind("sc.jigsawpuzzle.reset",function(event,jsonObj){log(target,options,"Jigsaw Puzzle Score Changed ["+jsonObj.id+"]:"+jsonObj.curScore+"/"+jsonObj.maxScore,"debug"),handleScoring(jsonObj)})}else{var swf=options.swf.jigsawPuzzle,flashVars=$.extend({},{xmlfile:params.dataFile,restart:params.restart,actNum:params.actNum},params.flashVars);embedFlash(target,options,params,swf,flashVars)}}(target,options,params);break;default:!function(target,options,params){log(target,options,"Initializing Activity Wrapper for activityid:"+params.id+", type:"+params.type+", dataFile:"+params.dataFile,"info"),$(target).data("activityEmbed:type","html"),$(target).activityWrapper({data:{activityIdentifier:params.actNum,activityType:params.type,activityData:{xmlFile:params.dataFile,allowRetry:params.restart}}})}(target,options,params)}}catch(error){log(target,options,error,"error")}}(this,optionsReference,params)}}),this},$.fn.activityEmbed.defaults={},$.fn.activityEmbed.defaults.data={enableLogging:!0,browserChecksPerformed:!1,browserMajorVersion:0,hasCanvas:!1,hasAudio:!1,minimumFlashVersion:"10",useFlashAsDefault:!1},$.fn.activityEmbed.defaults.swf={flashCard:"flashcard.swf",seekAWord:"seekaword.swf",dragNDrop:"dragndrop.swf",ordering:"ordering.swf",crossword:"crossword.swf",labeling:"labeling.swf",sorting:"sorting.swf",hotSpot:"hotspot.swf",timeline:"timeline.swf",slideshow:"slideshow.swf",photoAlbum:"photoalbum.swf",sectionedShape:"sectionedshape.swf",tabbedPane:"tabbedpane.swf",didYouKnow:"didyouknow.swf",jigsawPuzzle:"jigsawpuzzle.swf"},$.fn.activityEmbed.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery),function($){$.fn.activityWrapper=function(action,options){var shouldReturnResults=!1,results=[],params=null;"object"==typeof(action=action||"initialize")&&(options=action,action="initialize"),"initialize"==action?options=options?$.extend(!0,{},$.fn.activityWrapper.defaults,options):$.fn.activityWrapper.defaults:params=options;var optionsReference=options;if($(this).each(function(){switch(action){case"initialize":!function(target,options){console.log("**initilizing..."),log(target,options,"Initializing Activity Wrapper","info"),(options=$.extend(!0,{},options)).containers.activity.reference=target,options.data.clearContainerContent&&$(options.containers.activity.reference).html("");$(options.containers.activity.reference).hasClass(options.containers.activity.css.identifier)||$(options.containers.activity.reference).addClass(options.containers.activity.css.identifier);null==options.containers.wrapper.reference&&(options.containers.wrapper.reference=$("<div />"),$(target).append(options.containers.wrapper.reference));options.containers.wrapper.reference.addClass(options.containers.wrapper.css.identifier),null==options.containers.header.container.reference&&(options.containers.header.container.reference=$("<div />"),$(options.containers.wrapper.reference).append(options.containers.header.container.reference));options.containers.header.container.reference&&options.containers.header.container.reference.addClass(options.containers.header.container.css.identifier);null==options.containers.header.content.reference&&(options.containers.header.content.reference=$("<div />"),$(options.containers.header.container.reference).append(options.containers.header.content.reference));options.containers.header.content.reference&&options.containers.header.content.reference.addClass(options.containers.header.content.css.identifier);null==options.containers.content.reference&&(options.containers.content.reference=$("<div />"),$(options.containers.wrapper.reference).append(options.containers.content.reference));options.containers.content.reference&&options.containers.content.reference.addClass(options.containers.content.css.identifier);null==options.containers.footer.container.reference&&(options.containers.footer.container.reference=$("<div />"),$(target).append(options.containers.footer.container.reference));options.containers.footer.container.reference&&(options.containers.footer.container.reference.addClass(options.containers.footer.container.css.identifier),$(options.containers.footer.container.reference).activityControls());function resize_event_handler(event){var options=$(target).data("activityWrapper:options");event.target!=options.containers.header.container.reference&&event.target!=options.containers.footer.container.reference&&event.target!=options.containers.content.reference&&handleResize(target,options)}if($(target).data("activityWrapper:options",options),$(target).bind("resize",resize_event_handler),$(target).parents(get_greymatter_class_name()).bind("isVisible",resize_event_handler),function(target,options){$(options.containers.footer.container.reference).bind("finish.activityControls",function(){if(options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&$(options.containers.content.reference).selectAllActivity("finish");break;case"orderingActivity":$.fn.orderingActivity&&$(options.containers.content.reference).orderingActivity("finish");break;case"matchingActivity":$.fn.matchingActivity&&$(options.containers.content.reference).matchingActivity("finish");break;case"slideSlotActivity":$.fn.slideSlotActivity&&$(options.containers.content.reference).slideSlotActivity("finish");break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&$(options.containers.content.reference).slideIdentificationActivity("finish");break;case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("finish")}}),$(options.containers.footer.container.reference).bind("reset.activityControls",function(){if(options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&$(options.containers.content.reference).selectAllActivity("reset");break;case"orderingActivity":$.fn.orderingActivity&&$(options.containers.content.reference).orderingActivity("reset");break;case"matchingActivity":$.fn.matchingActivity&&$(options.containers.content.reference).matchingActivity("reset");break;case"slideSlotActivity":$.fn.slideSlotActivity&&$(options.containers.content.reference).slideSlotActivity("reset");break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&$(options.containers.content.reference).slideIdentificationActivity("reset");break;case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("reset")}}),$(options.containers.footer.container.reference).bind("more.activityControls",function(){if(options.data.activityType)switch(options.data.activityType){case"slideShow":case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("toggleSetContent")}}),$(options.containers.footer.container.reference).bind("less.activityControls",function(){if(options.data.activityType)switch(options.data.activityType){case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("toggleSetContent")}}),$(options.containers.footer.container.reference).bind("nextSet.activityControls",function(){if(options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&$(options.containers.content.reference).selectAllActivity("showNextSet");break;case"orderingActivity":$.fn.orderingActivity&&$(options.containers.content.reference).orderingActivity("showNextSet");break;case"matchingActivity":$.fn.matchingActivity&&$(options.containers.content.reference).matchingActivity("showNextSet");break;case"slideSlotActivity":$.fn.slideSlotActivity&&$(options.containers.content.reference).slideSlotActivity("showNextSet");break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&$(options.containers.content.reference).slideIdentificationActivity("showNextSet");break;case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("showNextSet")}}),$(options.containers.footer.container.reference).bind("previousSet.activityControls",function(){if(options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&$(options.containers.content.reference).selectAllActivity("showPreviousSet");break;case"orderingActivity":$.fn.orderingActivity&&$(options.containers.content.reference).orderingActivity("showPreviousSet");break;case"matchingActivity":$.fn.matchingActivity&&$(options.containers.content.reference).matchingActivity("showPreviousSet");break;case"slideSlotActivity":$.fn.slideSlotActivity&&$(options.containers.content.reference).slideSlotActivity("showPreviousSet");break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&$(options.containers.content.reference).slideIdentificationActivity("showPreviousSet");break;case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("showPreviousSet")}}),$(options.containers.footer.container.reference).bind("save.activityControls",function(){options.data.activityType&&window.cookit&&window.cookit(options.data.activityIdentifier+"score",0,options.data.activityIdentifier+"attempts",0)})}(0,options),options.data.activityType)switch(options.data.activityType){case 203:case"203":case"selection":case"selectAll":case"selectAllActivity":options.data.activityType="selectAllActivity",$(target).data("activityWrapper:options",options),function(target,options){$.fn.selectAllActivity&&($(options.containers.content.reference).selectAllActivity(options.data.activityData),$(options.containers.content.reference).bind("activityLoaded.selectAllActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!0,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:allowRetry};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0}),options.data.enabled||setTimeout(function(){options.data.activityData.state&&null!=options.data.activityData.completed&&void 0!=options.data.activityData.completed&&$(options.containers.content.reference).selectAllActivity("setState",{state:options.data.activityData.state,completed:options.data.activityData.completed}),setEnabled(target,options)},1e3)}),$(options.containers.content.reference).bind("disabled.selectAllActivity",function(event,numberOfSets){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",{enableFinish:!1,enableReset:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1})}),$(options.containers.content.reference).bind("activityScoreChanged.selectAllActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,activeSetCompleted,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options");if(calculatedScore=Math.round(10*calculatedScore)/10,(calculatedPossible=Math.round(10*calculatedPossible)/10)>0?$(options.containers.footer.container.reference).activityControls("setStatus",calculatedScore+"/"+calculatedPossible):$(options.containers.footer.container.reference).activityControls("setStatus",""),gradeSetsIndividually){var controlVisibility={finishButton:!activeSetCompleted,resetButton:activeSetCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!activeSetCompleted,enableReset:allowRetry},saveEnabled={enableSave:!activeSetCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!options.data.onlyCallCookitOnCompleteEvents&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",0)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("activityComplete.selectAllActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!0,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!1,enableReset:allowRetry};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1}),options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",1)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("reset.selectAllActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!0,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:!1};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0})}),$(options.containers.content.reference).bind("titleChanged.selectAllActivity",function(event,headerContent){var options=$(target).data("activityWrapper:options");setHeaderContent(target,options,headerContent)}),$(options.containers.content.reference).bind("setChanged.selectAllActivity",function(event,numberOfSets,position,gradeSetsIndividually,allowReset,setCompleted,enabled){var options=$(target).data("activityWrapper:options");if($(options.containers.footer.container.reference).activityControls("setPositionIndicator",{numberOfSets:numberOfSets,position:position}),$(options.containers.footer.container.reference).activityControls("updateControlsBasedOnSetPosition",{numberOfSets:numberOfSets,position:position}),options.data.enabled||enabled){if(gradeSetsIndividually){var controlVisibility={finishButton:!setCompleted,resetButton:setCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!setCompleted,enableReset:allowReset},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!setCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}else if(options.data.requireAllSetsShownForFinish){var finishAndResetEnabled={enableFinish:!0,enableReset:allowReset},found=!1;$.each(options.data.setsShown,function(i,setId){setId==position&&(found=!0)}),found||(options.data.setsShown.push(position),$(target).data("activityWrapper:options",options)),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled)}}else{var controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1},finishAndResetEnabled={enableFinish:!1,enableReset:!1},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}}),options.data.activityData.xmlData?(options.data.activityData.xmlDataEncoding&&(options.data.activityData.xmlData=unescape(options.data.activityData.xmlData.replace(/\+/g," "))),$(options.containers.content.reference).selectAllActivity("parseXMLAndBuildActivity",options.data.activityData.xmlData)):options.data.activityData.xmlFile&&$(options.containers.content.reference).selectAllActivity("loadXMLAndBuildActivity",options.data.activityData.xmlFile))}(target,options);break;case 204:case"204":case"sequence":case"ordering":case"orderingActivity":options.data.activityType="orderingActivity",$(target).data("activityWrapper:options",options),function(target,options){$.fn.orderingActivity&&($(options.containers.content.reference).orderingActivity(options.data.activityData),$(options.containers.content.reference).bind("activityLoaded.orderingActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!0,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:allowRetry};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0}),options.data.enabled||setTimeout(function(){options.data.activityData.state&&null!=options.data.activityData.completed&&void 0!=options.data.activityData.completed&&$(options.containers.content.reference).orderingActivity("setState",{state:options.data.activityData.state,completed:options.data.activityData.completed}),setEnabled(target,options)},1e3)}),$(options.containers.content.reference).bind("disabled.orderingActivity",function(event,numberOfSets){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",{enableFinish:!1,enableReset:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1})}),$(options.containers.content.reference).bind("activityScoreChanged.orderingActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,activeSetCompleted,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options");if(calculatedScore=Math.round(10*calculatedScore)/10,(calculatedPossible=Math.round(10*calculatedPossible)/10)>0?$(options.containers.footer.container.reference).activityControls("setStatus",calculatedScore+"/"+calculatedPossible):$(options.containers.footer.container.reference).activityControls("setStatus",""),gradeSetsIndividually){var controlVisibility={finishButton:!activeSetCompleted,resetButton:activeSetCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!activeSetCompleted,enableReset:allowRetry},saveEnabled={enableSave:!activeSetCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!options.data.onlyCallCookitOnCompleteEvents&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",0)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("activityComplete.orderingActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!0,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!1,enableReset:allowRetry};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1}),options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",1)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("reset.orderingActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!0,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:!1};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0})}),$(options.containers.content.reference).bind("titleChanged.orderingActivity",function(event,headerContent){var options=$(target).data("activityWrapper:options");setHeaderContent(target,options,headerContent)}),$(options.containers.content.reference).bind("setChanged.orderingActivity",function(event,numberOfSets,position,gradeSetsIndividually,allowReset,setCompleted,enabled){var options=$(target).data("activityWrapper:options");if($(options.containers.footer.container.reference).activityControls("setPositionIndicator",{numberOfSets:numberOfSets,position:position}),$(options.containers.footer.container.reference).activityControls("updateControlsBasedOnSetPosition",{numberOfSets:numberOfSets,position:position}),options.data.enabled||enabled){if(gradeSetsIndividually){var controlVisibility={finishButton:!setCompleted,resetButton:setCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!setCompleted,enableReset:allowReset},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!setCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}else if(options.data.requireAllSetsShownForFinish){var finishAndResetEnabled={enableFinish:!0,enableReset:allowReset},found=!1;$.each(options.data.setsShown,function(i,setId){setId==position&&(found=!0)}),found||(options.data.setsShown.push(position),$(target).data("activityWrapper:options",options)),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled)}}else{var controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1},finishAndResetEnabled={enableFinish:!1,enableReset:!1},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}}),options.data.activityData.xmlData?(options.data.activityData.xmlDataEncoding&&(options.data.activityData.xmlData=unescape(options.data.activityData.xmlData.replace(/\+/g," "))),$(options.containers.content.reference).orderingActivity("parseXMLAndBuildActivity",options.data.activityData.xmlData)):options.data.activityData.xmlFile&&$(options.containers.content.reference).orderingActivity("loadXMLAndBuildActivity",options.data.activityData.xmlFile))}(target,options);break;case 205:case"205":case"sets":case"pairs":case"matching":case"matchingActivity":options.data.activityType="matchingActivity",$(target).data("activityWrapper:options",options),function(target,options){$.fn.matchingActivity&&($(options.containers.content.reference).matchingActivity(options.data.activityData),$(options.containers.content.reference).bind("activityLoaded.matchingActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:allowRetry,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:!1};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0}),options.data.enabled||setTimeout(function(){options.data.activityData.state&&null!=options.data.activityData.completed&&void 0!=options.data.activityData.completed&&$(options.containers.content.reference).matchingActivity("setState",{state:options.data.activityData.state,completed:options.data.activityData.completed}),setEnabled(target,options)},1e3)}),$(options.containers.content.reference).bind("disabled.matchingActivity",function(event,numberOfSets){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",{enableFinish:!1,enableReset:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1})}),$(options.containers.content.reference).bind("activityScoreChanged.matchingActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,activeSetCompleted,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options");if(calculatedScore=Math.round(10*calculatedScore)/10,(calculatedPossible=Math.round(10*calculatedPossible)/10)>0?$(options.containers.footer.container.reference).activityControls("setStatus",calculatedScore+"/"+calculatedPossible):$(options.containers.footer.container.reference).activityControls("setStatus",""),gradeSetsIndividually){var controlVisibility={finishButton:!1,resetButton:activeSetCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!activeSetCompleted,enableReset:allowRetry},saveEnabled={enableSave:!activeSetCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!options.data.onlyCallCookitOnCompleteEvents&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",0)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("activityComplete.matchingActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!0,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!1,enableReset:allowRetry};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1}),options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",1)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("reset.matchingActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:allowRetry,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:!1};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0})}),$(options.containers.content.reference).bind("titleChanged.matchingActivity",function(event,headerContent){var options=$(target).data("activityWrapper:options");setHeaderContent(target,options,headerContent)}),$(options.containers.content.reference).bind("setChanged.matchingActivity",function(event,numberOfSets,position,gradeSetsIndividually,allowReset,setCompleted,enabled){var options=$(target).data("activityWrapper:options");if($(options.containers.footer.container.reference).activityControls("setPositionIndicator",{numberOfSets:numberOfSets,position:position}),$(options.containers.footer.container.reference).activityControls("updateControlsBasedOnSetPosition",{numberOfSets:numberOfSets,position:position}),options.data.enabled||enabled){if(gradeSetsIndividually){var controlVisibility={finishButton:!1,resetButton:setCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!setCompleted,enableReset:allowReset},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!setCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}}else{var controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1},finishAndResetEnabled={enableFinish:!1,enableReset:!1},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}}),options.data.activityData.xmlData?(options.data.activityData.xmlDataEncoding&&(options.data.activityData.xmlData=unescape(options.data.activityData.xmlData.replace(/\+/g," "))),$(options.containers.content.reference).matchingActivity("parseXMLAndBuildActivity",options.data.activityData.xmlData)):options.data.activityData.xmlFile&&$(options.containers.content.reference).matchingActivity("loadXMLAndBuildActivity",options.data.activityData.xmlFile))}(target,options);break;case 200:case"200":case"align":case"slideSlot":case"slideSlotActivity":options.data.activityType="slideSlotActivity",$(target).data("activityWrapper:options",options),function(target,options){$.fn.slideSlotActivity&&($(options.containers.content.reference).slideSlotActivity(options.data.activityData),$(options.containers.content.reference).bind("activityLoaded.slideSlotActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!0,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:allowRetry};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0}),options.data.enabled||setTimeout(function(){options.data.activityData.state&&null!=options.data.activityData.completed&&void 0!=options.data.activityData.completed&&$(options.containers.content.reference).slideSlotActivity("setState",{state:options.data.activityData.state,completed:options.data.activityData.completed}),setEnabled(target,options)},1e3)}),$(options.containers.content.reference).bind("disabled.slideSlotActivity",function(event,numberOfSets){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",{enableFinish:!1,enableReset:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1})}),$(options.containers.content.reference).bind("activityScoreChanged.slideSlotActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,activeSetCompleted,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options");if(calculatedScore=Math.round(10*calculatedScore)/10,(calculatedPossible=Math.round(10*calculatedPossible)/10)>0?$(options.containers.footer.container.reference).activityControls("setStatus",calculatedScore+"/"+calculatedPossible):$(options.containers.footer.container.reference).activityControls("setStatus",""),gradeSetsIndividually){var controlVisibility={finishButton:!activeSetCompleted,resetButton:activeSetCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!activeSetCompleted,enableReset:allowRetry},saveEnabled={enableSave:!activeSetCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!options.data.onlyCallCookitOnCompleteEvents&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",0)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("activityComplete.slideSlotActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!0,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!1,enableReset:allowRetry};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1}),options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",1)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("reset.slideSlotActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!0,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:!1};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0})}),$(options.containers.content.reference).bind("titleChanged.slideSlotActivity",function(event,headerContent){var options=$(target).data("activityWrapper:options");setHeaderContent(target,options,headerContent)}),$(options.containers.content.reference).bind("setChanged.slideSlotActivity",function(event,numberOfSets,position,gradeSetsIndividually,allowReset,setCompleted,enabled){var options=$(target).data("activityWrapper:options");if($(options.containers.footer.container.reference).activityControls("setPositionIndicator",{numberOfSets:numberOfSets,position:position}),$(options.containers.footer.container.reference).activityControls("updateControlsBasedOnSetPosition",{numberOfSets:numberOfSets,position:position}),options.data.enabled||enabled){if(gradeSetsIndividually){var controlVisibility={finishButton:!setCompleted,resetButton:setCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!setCompleted,enableReset:allowReset},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!setCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}else if(options.data.requireAllSetsShownForFinish){var finishAndResetEnabled={enableFinish:!0,enableReset:allowReset},found=!1;$.each(options.data.setsShown,function(i,setId){setId==position&&(found=!0)}),found||(options.data.setsShown.push(position),$(target).data("activityWrapper:options",options)),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled)}}else{var controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1},finishAndResetEnabled={enableFinish:!1,enableReset:!1},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}}),options.data.activityData.xmlData?(options.data.activityData.xmlDataEncoding&&(options.data.activityData.xmlData=unescape(options.data.activityData.xmlData.replace(/\+/g," "))),$(options.containers.content.reference).slideSlotActivity("parseXMLAndBuildActivity",options.data.activityData.xmlData)):options.data.activityData.xmlFile&&$(options.containers.content.reference).slideSlotActivity("loadXMLAndBuildActivity",options.data.activityData.xmlFile))}(target,options);break;case 201:case"201":case"identify":case"slideIdentification":case"slideIdentificationActivity":options.data.activityType="slideIdentificationActivity",$(target).data("activityWrapper:options",options),function(target,options){$.fn.slideIdentificationActivity&&($(options.containers.content.reference).slideIdentificationActivity(options.data.activityData),$(options.containers.content.reference).bind("activityLoaded.slideIdentificationActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!0,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:allowRetry};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0}),options.data.enabled||setTimeout(function(){options.data.activityData.state&&null!=options.data.activityData.completed&&void 0!=options.data.activityData.completed&&$(options.containers.content.reference).slideIdentificationActivity("setState",{state:options.data.activityData.state,completed:options.data.activityData.completed}),setEnabled(target,options)},1e3)}),$(options.containers.content.reference).bind("disabled.slideIdentificationActivity",function(event,numberOfSets){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",{enableFinish:!1,enableReset:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1})}),$(options.containers.content.reference).bind("activityScoreChanged.slideIdentificationActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,activeSetCompleted,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options");if(calculatedScore=Math.round(10*calculatedScore)/10,(calculatedPossible=Math.round(10*calculatedPossible)/10)>0?$(options.containers.footer.container.reference).activityControls("setStatus",calculatedScore+"/"+calculatedPossible):$(options.containers.footer.container.reference).activityControls("setStatus",""),gradeSetsIndividually){var controlVisibility={finishButton:!activeSetCompleted,resetButton:activeSetCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!activeSetCompleted,enableReset:allowRetry},saveEnabled={enableSave:!activeSetCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!options.data.onlyCallCookitOnCompleteEvents&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",1)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("activityComplete.slideIdentificationActivity",function(event,numberOfSets,position,allowRetry,gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!0,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!1,enableReset:allowRetry};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1}),options.data.activityIdentifier&&calculatedPossible>0&&(options.data.initialUpdateGradeCalled&&!doNotUpdateExternalScore&&window.cookit&&(log(target,options,"Calling Cookit:"),window.cookit(options.data.activityIdentifier+"score",calculatedScore/calculatedPossible*100,options.data.activityIdentifier+"attempts",0)),options.data.initialUpdateGradeCalled||(options.data.initialUpdateGradeCalled=!0,$(target).data("activityWrapper:options",options)))}),$(options.containers.content.reference).bind("reset.slideIdentificationActivity",function(event,numberOfSets,setShown,allowRetry,gradeSetsIndividually){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!0,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!0,enableReset:!1};if(!gradeSetsIndividually&&options.data.requireAllSetsShownForFinish){options.data.setsShown=[],options.data.setsShown.push(setShown),$(target).data("activityWrapper:options",options),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1)}$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!0})}),$(options.containers.content.reference).bind("titleChanged.slideIdentificationActivity",function(event,headerContent){var options=$(target).data("activityWrapper:options");setHeaderContent(target,options,headerContent)}),$(options.containers.content.reference).bind("setChanged.slideIdentificationActivity",function(event,numberOfSets,position,gradeSetsIndividually,allowReset,setCompleted,enabled){var options=$(target).data("activityWrapper:options");if($(options.containers.footer.container.reference).activityControls("setPositionIndicator",{numberOfSets:numberOfSets,position:position}),$(options.containers.footer.container.reference).activityControls("updateControlsBasedOnSetPosition",{numberOfSets:numberOfSets,position:position}),options.data.enabled||enabled){if(gradeSetsIndividually){var controlVisibility={finishButton:!setCompleted,resetButton:setCompleted,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!0},finishAndResetEnabled={enableFinish:!setCompleted,enableReset:allowReset},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!setCompleted};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}else if(options.data.requireAllSetsShownForFinish){var finishAndResetEnabled={enableFinish:!0,enableReset:allowReset},found=!1;$.each(options.data.setsShown,function(i,setId){setId==position&&(found=!0)}),found||(options.data.setsShown.push(position),$(target).data("activityWrapper:options",options)),finishAndResetEnabled.enableFinish&&options.data.setsShown.length<numberOfSets&&(finishAndResetEnabled.enableFinish=!1),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled)}}else{var controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1},finishAndResetEnabled={enableFinish:!1,enableReset:!1},moreAndLessEnabled={enableMore:!1,enableLess:!1},saveEnabled={enableSave:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",finishAndResetEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",saveEnabled)}}),options.data.activityData.xmlData?(options.data.activityData.xmlDataEncoding&&(options.data.activityData.xmlData=unescape(options.data.activityData.xmlData.replace(/\+/g," "))),$(options.containers.content.reference).slideIdentificationActivity("parseXMLAndBuildActivity",options.data.activityData.xmlData)):options.data.activityData.xmlFile&&$(options.containers.content.reference).slideIdentificationActivity("loadXMLAndBuildActivity",options.data.activityData.xmlFile))}(target,options);break;case 202:case"202":case"presenter":case"slideShow":case"slideShowActivity":options.data.activityType="slideShowActivity",$(target).data("activityWrapper:options",options),function(target,options){$.fn.slideShowActivity&&($(options.containers.content.reference).slideShowActivity(options.data.activityData),$(options.containers.content.reference).bind("activityLoaded.slideShowActivity",function(event,numberOfSets,position){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),options.data.enabled||setTimeout(function(){setEnabled(target,options)},1e3)}),$(options.containers.content.reference).bind("disabled.slideShowActivity",function(event,numberOfSets){var options=$(target).data("activityWrapper:options"),controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!1,lessButton:!1,saveButton:!1};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableFinishAndReset",{enableFinish:!1,enableReset:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableSave",{enableSave:!1})}),$(options.containers.content.reference).bind("titleChanged.slideShowActivity",function(event,headerContent){var options=$(target).data("activityWrapper:options");setHeaderContent(target,options,headerContent)}),$(options.containers.content.reference).bind("contentShown.slideShowActivity",function(event,headerContent){var options=$(target).data("activityWrapper:options");$(options.containers.footer.container.reference).activityControls("showOrHideMoreAndLess",{moreButton:!1,lessButton:!0}),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!1,enableLess:!0})}),$(options.containers.content.reference).bind("contentHidden.slideShowActivity",function(event,headerContent){var options=$(target).data("activityWrapper:options");$(options.containers.footer.container.reference).activityControls("showOrHideMoreAndLess",{moreButton:!0,lessButton:!1}),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",{enableMore:!0,enableLess:!1})}),$(options.containers.content.reference).bind("setChanged.slideShowActivity",function(event,numberOfSets,position,hasDetails,contentShown,enabled){var options=$(target).data("activityWrapper:options");$(options.containers.footer.container.reference).activityControls("setStatus",position+1+"/"+numberOfSets),$(options.containers.footer.container.reference).activityControls("setPositionIndicator",{numberOfSets:numberOfSets,position:position}),$(options.containers.footer.container.reference).activityControls("updateControlsBasedOnSetPosition",{numberOfSets:numberOfSets,position:position});var controlVisibility={finishButton:!1,resetButton:!1,nextSetButton:numberOfSets>1,previousSetButton:numberOfSets>1,positionIndicator:numberOfSets>1,moreButton:!contentShown,lessButton:!(!hasDetails||!contentShown),saveButton:!1},moreAndLessEnabled={enableMore:!(!hasDetails||contentShown),enableLess:contentShown};$(options.containers.footer.container.reference).activityControls("showOrHideControls",controlVisibility),$(options.containers.footer.container.reference).activityControls("enableOrDisableMoreAndLess",moreAndLessEnabled)}),options.data.activityData.xmlData?(options.data.activityData.xmlDataEncoding&&(options.data.activityData.xmlData=unescape(options.data.activityData.xmlData.replace(/\+/g," "))),$(options.containers.content.reference).slideShowActivity("parseXMLAndBuildActivity",options.data.activityData.xmlData)):options.data.activityData.xmlFile&&$(options.containers.content.reference).slideShowActivity("loadXMLAndBuildActivity",options.data.activityData.xmlFile),options.data.activityData.state&&$(options.containers.content.reference).slideShowActivity("setState",options.data.activityData.state))}(target,options)}handleResize(target,options)}(this,optionsReference);break;case"getContentContainer":var options=$(this).data("activityWrapper:options");shouldReturnResults=!0,results.push({target:this,result:options.containers.content.reference});break;case"getHeaderContainer":options=$(this).data("activityWrapper:options");shouldReturnResults=!0,results.push({target:this,result:options.containers.header.reference});break;case"getFooterContainer":options=$(this).data("activityWrapper:options");shouldReturnResults=!0,results.push({target:this,result:options.containers.footer.reference});break;case"getState":options=$(this).data("activityWrapper:options");shouldReturnResults=!0,results.push({target:this,result:function(target,options){var state=null;if(options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&(state=$(options.containers.content.reference).selectAllActivity("getState")[0].result);break;case"orderingActivity":$.fn.orderingActivity&&(state=$(options.containers.content.reference).orderingActivity("getState")[0].result);break;case"matchingActivity":$.fn.matchingActivity&&(state=$(options.containers.content.reference).matchingActivity("getState")[0].result);break;case"slideSlotActivity":$.fn.slideSlotActivity&&(state=$(options.containers.content.reference).slideSlotActivity("getState")[0].result);break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&(state=$(options.containers.content.reference).slideIdentificationActivity("getState")[0].result);break;case"slideShowActivity":$.fn.slideShowActivity&&(state=$(options.containers.content.reference).slideShowActivity("getState")[0].result)}return state}(0,options)});break;case"setState":options=$(this).data("activityWrapper:options");shouldReturnResults=!0,results.push({target:this,result:function(target,options,state,completed){if(options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&$(options.containers.content.reference).selectAllActivity("setState",{state:state,completed:completed});break;case"orderingActivity":$.fn.orderingActivity&&$(options.containers.content.reference).orderingActivity("setState",{state:state,completed:completed});break;case"matchingActivity":$.fn.matchingActivity&&$(options.containers.content.reference).matchingActivity("setState",{state:state,completed:completed});break;case"slideSlotActivity":$.fn.slideSlotActivity&&$(options.containers.content.reference).slideSlotActivity("setState",{state:state,completed:completed});break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&$(options.containers.content.reference).slideIdentificationActivity("setState",{state:state,completed:completed});break;case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("setState",{state:state,completed:completed})}}(0,options,params.state,params.completed)});break;case"getType":options=$(this).data("activityWrapper:options");shouldReturnResults=!0,results.push({target:this,result:function(target,options,getLessonBuilderType){getLessonBuilderType=getLessonBuilderType||!1;var type=null;if(options.data.activityType)if(getLessonBuilderType)switch(options.data.activityType){case"selectAllActivity":type=203;break;case"orderingActivity":type=204;break;case"matchingActivity":type=205;break;case"slideSlotActivity":type=200;break;case"slideIdentificationActivity":type=201;break;case"slideShowActivity":type=202}else type=options.data.activityType;return type}(0,options,params)});break;case"setEnabled":(options=$(this).data("activityWrapper:options")).data.enabled=params,$(this).data("activityWrapper:options",options),setEnabled(this,options);break;case"finish":!function(target,options){if(log(target,options,"Finishing Activity:"+options.data.activityType,"info"),options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&$(options.containers.content.reference).selectAllActivity("finish");break;case"orderingActivity":$.fn.orderingActivity&&$(options.containers.content.reference).orderingActivity("finish");break;case"matchingActivity":$.fn.matchingActivity&&$(options.containers.content.reference).matchingActivity("finish");break;case"slideSlotActivity":$.fn.slideSlotActivity&&$(options.containers.content.reference).slideSlotActivity("finish");break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&$(options.containers.content.reference).slideIdentificationActivity("finish");break;case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("finish")}$(target).data("activityWrapper:options",options)}(this,options=$(this).data("activityWrapper:options"))}}),1==shouldReturnResults)return results;function log(target,options,data,level){level=level||"info",level=$.trim(level).toLowerCase(),options.data.enableLogging&&window.console&&("info"==level&&window.console.info&&options.logging.info?$(target).attr("id")?window.console.info("[ActivityWrapper]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.info("[ActivityWrapper]["+target+", name="+$(target).attr("name")+"]"+data):window.console.info("[ActivityWrapper]["+target+"]"+data):"warn"==level&&window.console.warn&&options.logging.warn?$(target).attr("id")?window.console.warn("[ActivityWrapper]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.warn("[ActivityWrapper]["+target+", name="+$(target).attr("name")+"]"+data):window.console.warn("[ActivityWrapper]["+target+"]"+data):"error"==level&&window.console.error&&options.logging.error?$(target).attr("id")?window.console.error("[ActivityWrapper]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.error("[ActivityWrapper]["+target+", name="+$(target).attr("name")+"]"+data):window.console.error("[ActivityWrapper]["+target+"]"+data):window.console.log&&options.logging.debug&&($(target).attr("id")?window.console.log("[ActivityWrapper]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.log("[ActivityWrapper]["+target+", name="+$(target).attr("name")+"]"+data):window.console.log("[ActivityWrapper]["+target+"]"+data)))}function setEnabled(target,options){if(options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&$(options.containers.content.reference).selectAllActivity("setEnabled",options.data.enabled);break;case"orderingActivity":$.fn.orderingActivity&&$(options.containers.content.reference).orderingActivity("setEnabled",options.data.enabled);break;case"matchingActivity":$.fn.matchingActivity&&$(options.containers.content.reference).matchingActivity("setEnabled",options.data.enabled);break;case"slideSlotActivity":$.fn.slideSlotActivity&&$(options.containers.content.reference).slideSlotActivity("setEnabled",options.data.enabled);break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&$(options.containers.content.reference).slideIdentificationActivity("setEnabled",options.data.enabled);break;case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("setEnabled",options.data.enabled)}$(target).data("activityWrapper:options",options)}function setHeaderContent(target,options,content){$(options.containers.header.content.reference).css("left",0),$(options.containers.header.content.reference).css("top",0),$(options.containers.header.content.reference).html(content),alignToParent(target,options,options.containers.header.content.horizontalAlign,options.containers.header.content.verticalAlign,options.containers.header.content.reference)}function alignToParent(target,options,horizontalAlign,verticalAlign,container){if($(container).css("position","absolute"),horizontalAlign)switch(horizontalAlign.toLowerCase()){case"left":$(container).css("right",null).css("left","0px");break;case"right":$(container).css("left",null).css("right","0px");break;case"center":$(container).css("right",null).css("left",$(container).parent().innerWidth()/2-$(container).outerWidth()/2+"px")}if(verticalAlign)switch(verticalAlign.toLowerCase()){case"top":$(container).css("bottom",null).css("top","0px");break;case"bottom":$(container).css("top",null).css("bottom","0px");break;case"middle":$(container).css("bottom",null).css("top",$(container).parent().innerHeight()/2-$(container).outerHeight()/2+"px")}}function handleResize(target,options){alignToParent(0,0,options.containers.header.content.horizontalAlign,options.containers.header.content.verticalAlign,options.containers.header.content.reference),$(options.containers.footer.container.reference).activityControls("resize");var width=$(options.containers.content.reference).parent().width(),height=$(options.containers.content.reference).parent().height();if(height-=$(options.containers.header.container.reference).outerHeight(),height-=$(options.containers.footer.container.reference).outerHeight(),$(options.containers.content.reference).width(width),$(options.containers.content.reference).height(height),options.data.activityType)switch(options.data.activityType){case"selectAllActivity":$.fn.selectAllActivity&&$(options.containers.content.reference).selectAllActivity("resize");break;case"orderingActivity":$.fn.orderingActivity&&$(options.containers.content.reference).orderingActivity("resize");break;case"matchingActivity":$.fn.matchingActivity&&$(options.containers.content.reference).matchingActivity("resize");break;case"slideSlotActivity":$.fn.slideSlotActivity&&$(options.containers.content.reference).slideSlotActivity("resize");break;case"slideIdentificationActivity":$.fn.slideIdentificationActivity&&$(options.containers.content.reference).slideIdentificationActivity("resize");break;case"slideShowActivity":$.fn.slideShowActivity&&$(options.containers.content.reference).slideShowActivity("resize")}}return this},$.fn.activityWrapper.defaults={},$.fn.activityWrapper.defaults.containers={activity:{reference:null,css:{identifier:"softchalk-activity-wrapper"}},wrapper:{reference:null,css:{identifier:"softchalk-activity-wrapper-container"}},header:{container:{reference:null,css:{identifier:"softchalk-activity-wrapper-header-container"}},content:{reference:null,horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-activity-wrapper-header-content"}}},content:{reference:null,css:{identifier:"softchalk-activity-wrapper-content-container"}},footer:{container:{reference:null,css:{identifier:"softchalk-activity-wrapper-footer-container"}}}},$.fn.activityWrapper.defaults.data={activityIdentifier:null,initialUpdateGradeCalled:!1,clearContainerContent:!0,enableLogging:!1,activityType:null,activityData:null,onlyCallCookitOnCompleteEvents:!0,enabled:!0,requireAllSetsShownForFinish:!0,setsShown:[]},$.fn.activityWrapper.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery),function($){$.fn.matchingActivity=function(action,options){var shouldReturnResults=!1,results=[],params=null;"object"==typeof(action=action||"initialize")&&(options=action,action="initialize"),"initialize"==action?options=options?$.extend(!0,{},$.fn.matchingActivity.defaults,options):$.fn.matchingActivity.defaults:params=options;var optionsReference=options;if($(this).each(function(){switch(action){case"initialize":log(this,optionsReference,"Action:Initializing Activity","info"),function(target,options){(options=$.extend(!0,{},options)).containers.activity.reference=target,$(options.containers.activity.reference).addClass(options.containers.activity.css.identifier),options.containers.content.reference=target,$(options.containers.content.reference).addClass(options.containers.content.css.identifier),null==options.containers.matchset.reference&&(options.containers.matchset.reference=$("<div />"),$(options.containers.content.reference).append(options.containers.matchset.reference));options.containers.matchset.reference.addClass(options.containers.matchset.css.identifier),$(target).data("matchingActivity:options",options)}(this,optionsReference);break;case"loadXMLAndBuildActivity":log(this,options=$(this).data("matchingActivity:options"),"Action:Loading XML","info"),function(target,options,url){log(target,options,"Loading XML","info");var id=$(options.containers.activity.reference).parents(".softchalk-activity-wrapper").attr("id"),data=window[id.replace("-","")+"XML"],options=$(target).data("matchingActivity:options");parseXMLAndBuildActivity(target,options,data)}(this,options);break;case"parseXMLAndBuildActivity":log(this,options=$(this).data("matchingActivity:options"),"Action:Parsing XML","info"),parseXMLAndBuildActivity(this,options,params);break;case"calculateScore":log(this,options=$(this).data("matchingActivity:options"),"Action:Calculating Score","info"),calculateScore(this,options);break;case"finish":log(this,options=$(this).data("matchingActivity:options"),"Action:Finishing Activity","info"),calculateActivityScore(this,options,!0,!0);break;case"reset":log(this,options=$(this).data("matchingActivity:options"),"Action:Resetting Activity","info"),function(target,options){if(options.data.allowRetry){log(target,options,"Resetting Activity","info");var setContainers=getSetContainers(target,options),activeSet=getActiveSetContainer(target,options),activeSetPosition=0,setContainer=null,setContainerData=null,matches=null,setScore=null;options.data.enabled=!0;for(var i=0;i<setContainers.length;i++)if(setContainer=setContainers[i],setContainerData=$(setContainer).data("matchingActivity:set"),setContainer==activeSet&&(activeSetPosition=i),options.data.gradeSetsIndividually&&setContainer==activeSet||!options.data.gradeSetsIndividually){setContainerData.attempts=0,setContainerData.currentMatchIndicator=0,setContainerData.focusedmatchsetId=null,setContainerData.focusedmatchsetRow=-1,setContainerData.focusedmatchsetColumn=-1,$(setContainer).data("matchingActivity:set",setContainerData),matches=getMatchesInSet(target,options,setContainer),clearMatchesHover(target,options,matches),clearCorrectAndIncorrectInSet(target,options,setContainer),clearSelectedMatches(target,options,matches),clearIndicators(target,options,matches),setScore=calculateSetScore(target,options,setContainer),setScore.calculatedScore,setScore.calculatedPossible;for(var j=0;j<setContainerData.matches.length;j++)matchset=setContainerData.matches[j],match=$(matchset).data("matchingActivity:matchset"),match.correct=!1,match.matchIndicator=null,$(matchset).data("matchingActivity:matchset",match);options.data.randomizeOnRetry&&(randomizeMatchSetPositionsInSet(target,options,setContainer),positionMatches(target,options,matches))}enableDisable(target,options);var setPosition=0;options.data.randomizeOnRetry&&(setPosition=Math.floor(Math.random()*setContainers.length)),setContainer=setContainers[setPosition],setContainerData=$(setContainer).data("matchingActivity:set"),showSet(target,options,setContainerData.id,setContainers,!1,!0),activeSet=getActiveSetContainer(target,options);for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("matchingActivity:set"),setContainer==activeSet&&(activeSetPosition=i);$(target).data("matchingActivity:options",options),$(target).trigger("reset.matchingActivity",[setContainers.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually]),calculateActivityScore(target,options,!1)}}(this,options);break;case"showNextSet":log(this,options=$(this).data("matchingActivity:options"),"Action:Showing Next Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i<setContainers.length-1){var width=$(options.containers.matchset.reference).outerWidth(),finalPosition=-width*[i+1];options.data.animate?$(options.containers.matchset.reference).stop(!0,!1).addClass(options.containers.matchset.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.matchset.css.animating)}):$(options.containers.matchset.reference).css("left",finalPosition+"px"),setData=$(setContainers[i+1]).data("matchingActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"showPreviousSet":log(this,options=$(this).data("matchingActivity:options"),"Action:Showing Previous Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if($(setContainers[i]).stop(!0,!0),setContainers[i]==currentSetContainer&&i>0){var width=$(options.containers.matchset.reference).outerWidth(),finalPosition=-width*[i-1];options.data.animate?$(options.containers.matchset.reference).stop(!0,!1).addClass(options.containers.matchset.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.matchset.css.animating)}):$(options.containers.matchset.reference).css("left",finalPosition+"px"),setData=$(setContainers[i-1]).data("matchingActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"getState":log(this,options=$(this).data("matchingActivity:options"),"Action:Getting Activity State","info"),shouldReturnResults=!0,results.push({target:this,result:function(target,options){for(var activityState={enabled:options.data.enabled,allowRetry:options.data.allowRetry,randomizeOnRetry:options.data.randomizeOnRetry,activeSetId:function(target,options){return $(getActiveSetContainer(target,options)).data("matchingActivity:set").id||null}(target,options),sets:[]},setContainers=getSetContainers(target,options),i=0;i<setContainers.length;i++)activityState.sets.push(getSetState(target,options,setContainers[i]));return activityState}(this,options)});break;case"setState":log(this,options=$(this).data("matchingActivity:options"),"Action:Setting Activity State","info"),function(target,options,activityState,completed){log(target,options,"Setting Activity State");var setData=null,setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,matches=null;showSet(target,options,activityState.activeSetId,!1,!0);for(var i=0;i<activityState.sets.length;i++){setData=activityState.sets[i];for(var j=0;j<setContainers.length;j++)setContainer=setContainers[j],setContainerData=$(setContainer).data("matchingActivity:set"),matches=getMatchesInSet(target,options,setContainer),setData.id==setContainerData.id&&setSetState(target,options,setContainer,setData),positionMatches(target,options,matches)}options.data.enabled=activityState.enabled,options.data.allowRetry=activityState.allowRetry,options.data.randomizeOnRetry=activityState.randomizeOnRetry,$(target).data("matchingActivity:options",options),enableDisable(target,options),calculateActivityScore(target,options,!1,completed,!0)}(this,options,params.state,params.completed);break;case"getEnabled":log(this,options=$(this).data("matchingActivity:options"),"Action:Getting Enabled","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.enabled});break;case"setEnabled":log(this,options=$(this).data("matchingActivity:options"),"Action:Setting Enabled","info"),options.data.enabled=params,$(this).data("matchingActivity:options",options),enableDisable(this,options);break;case"getSetIds":log(this,options=$(this).data("matchingActivity:options"),"Action:Getting Set Ids","info");for(var setContainers=getSetContainers(this,options),setContainer=null,setContainerData=null,setIds=[],i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("matchingActivity:set"),setIds.push(setContainerData.id);shouldReturnResults=!0,results.push({target:this,result:setIds});break;case"getNumberOfSets":log(this,options=$(this).data("matchingActivity:options"),"Action:Getting number of sets","info"),shouldReturnResults=!0,results.push({target:this,result:getSetContainers(this,options).length});break;case"showSet":log(this,options=$(this).data("matchingActivity:options"),"Action:Getting number of sets","info"),showSet(this,options,params);break;case"getAllowReset":log(this,options=$(this).data("matchingActivity:options"),"Action:Getting allow reset","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.allowRetry});break;case"resize":var options;log(this,options=$(this).data("matchingActivity:options"),"Action:Resizing the activity","info"),function(target,options){alignSets(target,options);for(var setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,matches=null,matchsetDimensions=null,i=(calculateContainerPadding(target,options,options.containers.matchset.reference),0);i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("matchingActivity:set"),matches=getMatchesInSet(target,options,setContainer),matchsetDimensions=calculateMatchSetDimensions(target,options,setContainerData.rows,setContainerData.columns),resizeMatches(target,options,matchsetDimensions.width,matchsetDimensions.height,matches),positionMatches(target,options,matches),alignMatches(target,options,matches);log(target,options,"Activity Container Resized","info")}(this,options)}}),1==shouldReturnResults)return results;function log(target,options,data,level){level=level||"debug",level=$.trim(level).toLowerCase(),options.data.enableLogging&&window.console&&("info"==level&&window.console.info&&options.logging.info?$(target).attr("id")?window.console.info("[matchingActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.info("[matchingActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.info("[matchingActivity]["+target+"]"+data):"warn"==level&&window.console.warn&&options.logging.warn?$(target).attr("id")?window.console.warn("[matchingActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.warn("[matchingActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.warn("[matchingActivity]["+target+"]"+data):"error"==level&&window.console.error&&options.logging.error?$(target).attr("id")?window.console.error("[matchingActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.error("[matchingActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.error("[matchingActivity]["+target+"]"+data):window.console.log&&options.logging.debug&&($(target).attr("id")?window.console.log("[matchingActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.log("[matchingActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.log("[matchingActivity]["+target+"]"+data)))}function registerAccessibilityEvents(target,options,matches){var handleMiceEvents=function(event){var options=$(this).data("matchingActivity:options");if(options.data.enabled&&event.pageX&&event.pageY){var offset=$(this).offset(),width=$(this).outerWidth(),height=$(this).outerHeight();!options.accessibility.hasFocus&&event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height?(options.accessibility.hasFocus=!0,$(this).data("matchingActivity:options",options)):options.accessibility.hasFocus&&(event.pageX<offset.left||event.pageX>offset.left+width||event.pageY<offset.top||event.pageY>offset.top+height)&&(options.accessibility.hasFocus=!1,$(this).data("matchingActivity:options",options))}};$(target).bind("mouseover",handleMiceEvents).bind("mouseout",handleMiceEvents).bind("mousemove",handleMiceEvents),$(target).bind("focusin",function(event){var options=$(this).data("matchingActivity:options");if(options.data.enabled&&!options.accessibility.hasFocus){log(target,options,"Giving Focus","info"),options.accessibility.hasFocus=!0,$(this).data("matchingActivity:options",options);var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("matchingActivity:set");(activeSetData.focusedmatchsetRow<0||activeSetData.focusedmatchsetColumn<0||!activeSetData.focusedmatchsetId)&&focusMatchSetInSet(target,options,activeSet,null,0,0,!1)}}),$(target).bind("focusout",function(event){var options=$(this).data("matchingActivity:options");options.data.enabled&&options.accessibility.hasFocus&&(options.accessibility.hasFocus=!1,$(this).data("matchingActivity:options",options))}),options.accessibility.keyboard.allow&&function(target,options,matches){$(document).keydown(function(event){var options=$(target).data("matchingActivity:options");if(options.data.enabled&&options.accessibility.keyboard.allow&&options.accessibility.hasFocus){var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("matchingActivity:set");switch(event.keyCode){case 38:activeSetData.focusedmatchsetRow-1>=0&&focusMatchSetInSet(target,options,activeSet,null,activeSetData.focusedmatchsetRow-1,activeSetData.focusedmatchsetColumn);break;case 40:activeSetData.focusedmatchsetRow+1<activeSetData.rows&&focusMatchSetInSet(target,options,activeSet,null,activeSetData.focusedmatchsetRow+1,activeSetData.focusedmatchsetColumn);break;case 37:activeSetData.focusedmatchsetColumn-1>=0&&focusMatchSetInSet(target,options,activeSet,null,activeSetData.focusedmatchsetRow,activeSetData.focusedmatchsetColumn-1);break;case 39:activeSetData.focusedmatchsetColumn+1<activeSetData.columns&&focusMatchSetInSet(target,options,activeSet,null,activeSetData.focusedmatchsetRow,activeSetData.focusedmatchsetColumn+1);break;case 32:focusMatchSetInSet(target,options,activeSet,null,activeSetData.focusedmatchsetRow,activeSetData.focusedmatchsetColumn,!0);break;case 13:calculateActivityScore(target,options)}}})}(target),options.accessibility.pseudoMouse.allow&&function(target,options,matches){for(var pseudoMice=options.accessibility.pseudoMouse.mice,mouse=null,offset=null,width=null,height=null,container=null,found=!1,i=0;i<pseudoMice.length;i++)mouse=pseudoMice[i],$(mouse).bind("mousemove",function(event){var options=$(target).data("matchingActivity:options");if(options.data.enabled){var event2=new $.Event("mousemove");event2.pageX=event.pageX,event2.pageY=event.pageY,$(target).trigger(event2)}if((options=$(target).data("matchingActivity:options")).data.enabled&&options.accessibility.hasFocus)for(var activeSet=getActiveSetContainer(target,options),matches=getMatchesInSet(target,options,activeSet),j=0;j<matches.length;j++)found=!1,container=$(matches[j]).children("."+options.containers.matches.overlay.css.identifier).first(),offset=$(container).offset(),$(container).hasClass(options.containers.matches.container.css.hover)?(event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&(found=!0)),found||$(container).trigger("mouseout")):event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&$(container).trigger("mouseover"))}),$(mouse).bind("mouseup",function(event){var options=$(target).data("matchingActivity:options");if(options.data.enabled&&options.accessibility.hasFocus){container=null;for(var j=0;j<matches.length;j++)container=$(matches[j]).children("."+options.containers.matches.overlay.css.identifier).first(),offset=$(container).offset(),width=$(container).width(),height=$(container).height(),event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height&&$(container).trigger("click")}})}(target,options,matches)}function calculateMatchSetDimensions(target,options,rows,columns){var containerWidth=$(options.containers.matchset.reference).width(),containerHeight=$(options.containers.matchset.reference).height(),borderTestDiv=$("<div />").css("display","none").addClass(options.containers.matches.container.css.identifier).width(100).height(100);$(target).append(borderTestDiv);var borderWidthOffset=($(borderTestDiv).outerWidth()-$(borderTestDiv).innerWidth())/2,borderHeightOffset=($(borderTestDiv).outerHeight()-$(borderTestDiv).innerHeight())/2;return $(borderTestDiv).remove(),{width:(containerWidth-=borderWidthOffset*(2*columns))/columns,height:(containerHeight-=borderHeightOffset*(2*rows))/rows}}function calculateContainerPadding(target,options,container){var paddingTestDiv=$('<div style="padding:0px 0px 0px 0px;"/>');paddingTestDiv.css("padding-top",$(container).css("padding-top"));var paddingTop=$(paddingTestDiv).height();paddingTestDiv.css("padding-top","0px"),paddingTestDiv.css("padding-right",$(container).css("padding-right"));var paddingRight=$(paddingTestDiv).width();paddingTestDiv.css("padding-right","0px"),paddingTestDiv.css("padding-bottom",$(container).css("padding-bottom"));var paddingBottom=$(paddingTestDiv).height();paddingTestDiv.css("padding-bottom","0px"),paddingTestDiv.css("padding-left",$(container).css("padding-left"));var paddingLeft=$(paddingTestDiv).width();return paddingTestDiv.css("padding-left","0px"),{top:paddingTop,right:paddingRight,bottom:paddingBottom,left:paddingLeft}}function createMatchSetContainer(target,options,contentHtml){var matchset=$("<div />").addClass(options.containers.matches.container.css.identifier).css("position","absolute"),contentDiv=$("<div />").addClass(options.containers.matches.content.css.identifier);$(matchset).append(contentDiv);var feedbackDiv=$("<div />").addClass(options.containers.matches.feedback.css.identifier);$(matchset).append(feedbackDiv);var feedbackIconDiv=$("<div />").addClass(options.containers.matches.feedbackIcon.css.identifier);$(matchset).append(feedbackIconDiv);var indicatorDiv=$("<div />").addClass(options.containers.matches.pairIndicator.css.identifier);$(matchset).append(indicatorDiv);var overlayDiv=$("<div />").addClass(options.containers.matches.overlay.css.identifier);return $(matchset).append(overlayDiv),contentHtml&&$(contentDiv).html(contentHtml),matchset}function enableDisable(target,options,matches){log(target,options,"Enabling/Disabling Activity:"+options.data.enabled,"info"),matches=matches||getMatches(target,options),options.data.enabled?($(options.containers.content.reference).removeClass(options.containers.content.css.disabled),$(options.containers.content.reference).addClass(options.containers.content.css.enabled),$(target).trigger("enabled.matchingActivity",[options.data.dataSets.length])):($(options.containers.content.reference).removeClass(options.containers.content.css.enabled),$(options.containers.content.reference).addClass(options.containers.content.css.disabled),clearMatchesHover(target,options,matches),$(target).trigger("disabled.matchingActivity",[options.data.dataSets.length]))}function resizeMatches(target,options,width,height,matches){matches=matches||getMatches(target,options);for(var matchset=null,i=0;i<matches.length;i++)matchset=matches[i],$(matchset).width(width),$(matchset).height(height)}function positionMatches(target,options,matches,containerPadding){matches=matches||getMatches(target,options),containerPadding=containerPadding||calculateContainerPadding(0,0,options.containers.matchset.reference);for(var matchsetData=null,matchset=null,i=0;i<matches.length;i++)matchset=matches[i],matchsetData=$(matchset).data("matchingActivity:matchset"),$(matchset).css("left",-containerPadding.left+$(matchset).outerWidth()*matchsetData.column+"px"),$(matchset).css("top",-containerPadding.top+$(matchset).outerHeight()*matchsetData.row+"px")}function randomizeMatchSetPositionsInSet(target,options,setContainer){setContainer=setContainer||getActiveSetContainer(target,options);for(var setData=$(setContainer).data("matchingActivity:set"),matches=getMatchesInSet(target,options,setContainer),matchset=null,matchsetData=null,unpositionedmatches=[],i=0;i<matches.length;i++)matchset=matches[i],(matchsetData=$(matchset).data("matchingActivity:matchset")).row=null,matchsetData.column=null,matchsetData.correct=!1,$(matchset).data("matchingActivity:matchset",matchsetData),unpositionedmatches.push(matchset);var matchsetMatrix=[],currentRow=0,currentColumn=0,currentRowArray=null;for(currentRow=0;currentRow<setData.rows;currentRow++){for(currentRowArray=[],currentColumn=0;currentColumn<setData.columns;currentColumn++)currentRowArray.push(null);matchsetMatrix.push(currentRowArray)}for(var randomSelector=null,found=!1;unpositionedmatches.length>0;){for(randomSelector=Math.floor(Math.random()*unpositionedmatches.length),matchset=unpositionedmatches.splice(randomSelector,1),matchsetData=$(matchset).data("matchingActivity:matchset"),found=!1,currentRow=0;currentRow<setData.rows;currentRow++)for(currentColumn=0;currentColumn<setData.columns;currentColumn++)matchsetMatrix[currentRow][currentColumn]||found||(found=!0,matchsetMatrix[currentRow][currentColumn]=matchset);matchset=null}for(currentRow=0;currentRow<setData.rows;currentRow++)for(currentColumn=0;currentColumn<setData.columns;currentColumn++)matchset=matchsetMatrix[currentRow][currentColumn],(matchsetData=$(matchset).data("matchingActivity:matchset")).row=currentRow,matchsetData.column=currentColumn,$(matchset).data("matchingActivity:matchset",matchsetData)}function registerMatchSetEvents(target,options,matchset){$(matchset).children("."+options.containers.matches.overlay.css.identifier).bind("mouseover",function(){var options=$(target).data("matchingActivity:options"),matchsetOptions=$(matchset).data("matchingActivity:matchset"),setOptions=$(matchset).parent().data("matchingActivity:set");options.data.enabled&&!matchsetOptions.completed&&($(this).parent().hasClass(options.containers.matches.container.css.correct)||$(this).parent().hasClass(options.containers.matches.container.css.incorrect)||$(this).parent().hasClass(options.containers.matches.container.css.hover)||(clearMatchesHover(target,options),$(this).parent().addClass(options.containers.matches.container.css.hover),setOptions.focusedmatchsetId=matchsetOptions.id,setOptions.focusedmatchsetRow=matchsetOptions.row,setOptions.focusedmatchsetColumn=matchsetOptions.column,$(matchset).parent().data("matchingActivity:set",setOptions),options.accessibility.hasFocus=!0,$(target).data("matchingActivity:options",options)))}),$(matchset).children("."+options.containers.matches.overlay.css.identifier).bind("mouseout",function(){var options=$(target).data("matchingActivity:options"),matchsetOptions=$(matchset).data("matchingActivity:matchset");$(matchset).parent().data("matchingActivity:set");options.data.enabled&&!matchsetOptions.completed&&($(this).parent().hasClass(options.containers.matches.container.css.correct)||$(this).parent().hasClass(options.containers.matches.container.css.incorrect)||$(this).parent().hasClass(options.containers.matches.container.css.hover)&&($(this).parent().removeClass(options.containers.matches.container.css.hover),options.accessibility.hasFocus=!0,$(target).data("matchingActivity:options",options)))}),$(matchset).children("."+options.containers.matches.overlay.css.identifier).bind("click",function(){var options=$(target).data("matchingActivity:options"),matchsetOptions=$(matchset).data("matchingActivity:matchset"),setOptions=$(matchset).parent().data("matchingActivity:set");if(options.data.enabled&&!matchsetOptions.completed){var shouldRecalculate=!1;setOptions.gradeIndividually?$(this).parent().hasClass(options.containers.matches.container.css.correct)||$(this).parent().hasClass(options.containers.matches.container.css.incorrect)||($(this).parent().hasClass(options.containers.matches.container.css.selected)?$(this).parent().hasClass(options.containers.matches.container.css.selected)&&setOptions.allowRetry&&$(this).parent().removeClass(options.containers.matches.container.css.selected):$(this).parent().addClass(options.containers.matches.container.css.selected),shouldRecalculate=!0):(setOptions.allowRetry||!setOptions.allowRetry&&0==setOptions.attempts)&&($(this).parent().hasClass(options.containers.matches.container.css.correct)||$(this).parent().hasClass(options.containers.matches.container.css.incorrect)||($(this).parent().hasClass(options.containers.matches.container.css.selected)?$(this).parent().hasClass(options.containers.matches.container.css.selected)&&$(this).parent().removeClass(options.containers.matches.container.css.selected):$(this).parent().addClass(options.containers.matches.container.css.selected),shouldRecalculate=!0)),options.accessibility.hasFocus=!0,$(target).data("matchingActivity:options",options),shouldRecalculate&&calculateActivityScore(target,options)}})}function getSetContainers(target,options){return $(options.containers.matchset.reference).children("."+options.containers.set.css.identifier)||[]}function getActiveSetContainer(target,options){return $(options.containers.matchset.reference).children("."+options.containers.set.css.identifier).filter("."+options.containers.set.css.selected)[0]||null}function getMatches(target,options){var activeSetContainer=getActiveSetContainer(0,options);return $(activeSetContainer).children("."+options.containers.matches.container.css.identifier)||[]}function getMatchesInSet(target,options,setContainer){return $(setContainer).children("."+options.containers.matches.container.css.identifier)||[]}function clearMatchesHover(target,options,matches){matches||(matches=getMatches(0,options));for(var matchset=null,i=0;i<matches.length;i++)matchset=matches[i],$(matchset).removeClass(options.containers.matches.container.css.hover)}function focusMatchSetInSet(target,options,setContainer,id,row,column,selectmatchset){log(target,options,"Focusing matchset:{id:"+id+",row:"+row+",column:"+column+"}","info");var matches=getMatchesInSet(0,options,setContainer),matchset=null,matchsetOptions=null;selectmatchset=selectmatchset||!1,clearMatchesHover(0,options,matches);for(var i=0;i<matches.length;i++)matchset=matches[i],id==(matchsetOptions=$(matchset).data("matchingActivity:matchset")).id?($(matchset).children("."+options.containers.matches.overlay.css.identifier).trigger("mouseover"),selectmatchset&&$(matchset).children("."+options.containers.matches.overlay.css.identifier).trigger("click")):row==matchsetOptions.row&&column==matchsetOptions.column?($(matchset).children("."+options.containers.matches.overlay.css.identifier).trigger("mouseover"),selectmatchset&&$(matchset).children("."+options.containers.matches.overlay.css.identifier).trigger("click")):$(matchset).children("."+options.containers.matches.overlay.css.identifier).trigger("mouseout")}function clearSelectedMatches(target,options,matches){matches=matches||getMatches(0,options);for(var matchset=null,i=0;i<matches.length;i++)matchset=matches[i],$(matchset).removeClass(options.containers.matches.container.css.selected)}function parseXMLAndBuildActivity(target,options,data){log(target,options,"Parsing Activity XML","info");try{if(window.ActiveXObject){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.loadXML(data),data=doc}else window.DOMParser&&(data=(new DOMParser).parseFromString(data,"text/xml"))}catch(error){data=null,log(target,options,"XML Parse Error:{error:"+error+"}","error")}if(data){var activityData={allowRetry:!0,randomizeOnRetry:!0,gradeSetsIndividually:!1,dataSets:[]},dataSet=null,matchset=null;$(data).children("matchingActivity").find("allowRetry").first()&&(activityData.allowRetry="true"==$(data).children("matchingActivity").find("allowRetry").first().text().toLowerCase()),$(data).children("matchingActivity").attr("randomizeOnRetry")&&(activityData.randomizeOnRetry="true"==$(data).children("matchingActivity").attr("randomizeOnRetry").toLowerCase()),$(data).children("matchingActivity").children("set").each(function(){dataSet={id:$(this).attr("id"),allowRetry:!1,showFeedback:!0,gradeIndividually:!0,autoComplete:!1,title:$(this).children("title:first").text(),rows:parseInt($(this).attr("rows")),columns:parseInt($(this).attr("columns")),matches:[]},$(this).children("title:first").attr("encoding")&&(dataSet.title=unescape(dataSet.title.replace(/\+/g," "))),$(this).children("matches").children("matchset").each(function(){matchset={id:$(this).attr("id"),left:$(this).children("left").text(),right:$(this).children("right").text(),value:parseFloat($(this).attr("value"))},$(this).children("left").attr("encoding")&&(matchset.left=unescape(matchset.left.replace(/\+/g," "))),$(this).children("right").attr("encoding")&&(matchset.right=unescape(matchset.right.replace(/\+/g," "))),dataSet.matches.push(matchset)}),activityData.dataSets.push(dataSet)}),function(target,options,activityData){var dataSet=null,matchsetDimensions=null,currentmatchset=(calculateContainerPadding(0,0,options.containers.matchset.reference),null),matches=[],currentRow=0,currentColumn=0,matchset=null,setContainer=null;if(options.data.allowRetry=activityData.allowRetry,options.data.randomizeOnRetry=activityData.randomizeOnRetry,options.data.gradeSetsIndividually=activityData.gradeSetsIndividually,options.data.overridePoints||0==options.data.overridePoints){var totalCorrectPoints=0;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.matches,function(j,matchSet){matchSet.value>0&&(totalCorrectPoints+=matchSet.value)})}),0!=totalCorrectPoints&&0!=options.data.overridePoints||(totalCorrectPoints=0,$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.matches,function(j,matchSet){options.data.overridePoints>0?(matchSet.value=1,totalCorrectPoints+=matchSet.value):matchSet.value=0})}));var factor=options.data.overridePoints/totalCorrectPoints;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.matches,function(j,matchSet){matchSet.value=matchSet.value*factor})})}for(var i=0;i<activityData.dataSets.length;i++){dataSet=$.extend({},activityData.dataSets[i],{matches:[],attempts:0,currentMatchIndicator:0,focusedmatchsetId:null,focusedmatchsetRow:-1,focusedmatchsetColumn:-1,completed:!1}),options.data.dataSets.push(dataSet),matchsetDimensions=calculateMatchSetDimensions(target,options,dataSet.rows,dataSet.columns),currentRow=0,currentColumn=0,matchset=null,num_of_matches=activityData.dataSets[i].matches.length;for(var j=0;j<num_of_matches;j++)matchset=activityData.dataSets[i].matches[j],currentmatchset=createMatchSetContainer(0,options,matchset.left),$(currentmatchset).data("matchingActivity:matchset",{id:parseInt(matchset.id),row:currentRow,column:currentColumn,value:matchset.value,pairID:matchset.id,matchIndicator:null,correct:!1}),registerMatchSetEvents(target,options,currentmatchset),dataSet.matches.push(currentmatchset),matches.push(currentmatchset),++currentColumn>=dataSet.columns&&(currentColumn=0,currentRow++),currentmatchset=createMatchSetContainer(0,options,matchset.right),newID=parseInt(matchset.id)+num_of_matches,$(currentmatchset).data("matchingActivity:matchset",{id:newID,row:currentRow,column:currentColumn,value:matchset.value,pairID:matchset.id}),registerMatchSetEvents(target,options,currentmatchset),dataSet.matches.push(currentmatchset),matches.push(currentmatchset),++currentColumn>=dataSet.columns&&(currentColumn=0,currentRow++);setContainer=createSetContainer(target,options),options.containers.set.references.push(setContainer),$(setContainer).data("matchingActivity:set",dataSet),$(options.containers.matchset.reference).append(setContainer);for(var j=0;j<dataSet.matches.length;j++)$(setContainer).append(dataSet.matches[j]);resizeMatches(target,options,matchsetDimensions.width,matchsetDimensions.height,dataSet.matches),randomizeMatchSetPositionsInSet(target,options,setContainer),positionMatches(target,options,dataSet.matches),alignMatches(target,options,dataSet.matches)}registerAccessibilityEvents(target,options,matches),enableDisable(target,options,matches),$(target).data("matchingActivity:options",options),alignSets(target,options),showSet(target,options,activityData.dataSets[0].id),calculateActivityScore(target,options,!1),$(target).trigger("activityLoaded.matchingActivity",[options.data.dataSets.length,0,options.data.allowRetry,options.data.gradeSetsIndividually])}(target,options,activityData)}else log(target,options,"XML Activity Build Error:{error:No data to build activity}","error")}function createSetContainer(target,options){return $("<div />").addClass(options.containers.set.css.identifier)}function showSet(target,options,id,setContainers,reset,resetPosition){setContainers=setContainers||getSetContainers(0,options),reset=reset||!1,resetPosition=resetPosition||!1;for(var setContainer=null,setContainerData=null,selectedSetContainerData=null,setPosition=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("matchingActivity:set"),$(setContainer).removeClass(options.containers.set.css.selected),setContainerData.id==id&&(setPosition=i,selectedSetContainerData=setContainerData,setContainer,$(setContainer).addClass(options.containers.set.css.selected));var matches=getMatches(0,options);if(positionMatches(target,options,matches),alignMatches(target,options,matches),reset&&selectedSetContainerData&&(options.data.enabled=!0,enableDisable(target,options,matches),$(target).data("matchingActivity:data",options)),resetPosition){var finalPosition=-$(options.containers.matchset.reference).outerWidth()*[id];$(options.containers.matchset.reference).css("left",finalPosition+"px")}$(target).trigger("titleChanged.matchingActivity",[selectedSetContainerData.title]),$(target).trigger("setChanged.matchingActivity",[setContainers.length,setPosition,options.data.gradeSetsIndividually,options.data.allowRetry,selectedSetContainerData.completed,options.data.enabled])}function getSetState(target,options,setContainer){for(var setContainerData=$(setContainer).data("matchingActivity:set"),setState={id:setContainerData.id,allowRetry:setContainerData.allowRetry,showFeedback:setContainerData.showFeedback,gradeIndividually:setContainerData.gradeIndividually,attempts:setContainerData.attempts,completed:setContainerData.completed,matches:[]},setmatches=getMatchesInSet(0,options,setContainer),matchset=null,matchsetOptions=null,normalizedmatchsetData=null,i=0;i<setmatches.length;i++)matchset=setmatches[i],normalizedmatchsetData={id:(matchsetOptions=$(matchset).data("matchingActivity:matchset")).id,row:matchsetOptions.row,column:matchsetOptions.column,correct:matchsetOptions.correct,value:matchsetOptions.value/2,pairID:matchsetOptions.pairID,matchIndicator:matchsetOptions.matchIndicator,selected:$(matchset).hasClass(options.containers.matches.container.css.selected),finished:$(matchset).hasClass(options.containers.matches.container.css.correct)||$(matchset).hasClass(options.containers.matches.container.css.incorrect)||!1},setState.matches.push(normalizedmatchsetData);return setState}function setSetState(target,options,setContainer,setState){log(target,options,"Setting Set State:"+setState.id);var setContainerData=$(setContainer).data("matchingActivity:set");setContainerData.allowRetry=setState.allowRetry,setContainerData.showFeedback=setState.showFeedback,setContainerData.gradeIndividually=setState.gradeIndividually,setContainerData.attempts=setState.attempts,setContainerData.completed=setState.completed,$(setContainer).data("matchingActivity:set",setContainerData),setContainerData.completed&&!$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).addClass(options.containers.set.css.completed);for(var setmatches=getMatchesInSet(0,options,setContainer),matchset=null,matchsetOptions=null,normalizedmatchsetData=null,i=0;i<setmatches.length;i++){matchset=setmatches[i],matchsetOptions=$(matchset).data("matchingActivity:matchset");for(var j=0;j<setState.matches.length;j++)(normalizedmatchsetData=setState.matches[j]).id==matchsetOptions.id&&(matchsetOptions.row=normalizedmatchsetData.row,matchsetOptions.column=normalizedmatchsetData.column,matchsetOptions.correct=normalizedmatchsetData.correct,matchsetOptions.value=2*normalizedmatchsetData.value,matchsetOptions.pairID=normalizedmatchsetData.pairID,matchsetOptions.matchIndicator=normalizedmatchsetData.matchIndicator,$(matchset).removeClass(options.containers.matches.container.css.selected),normalizedmatchsetData.selected&&$(matchset).addClass(options.containers.matches.container.css.selected),normalizedmatchsetData.finished&&(normalizedmatchsetData.correct?$(matchset).addClass(options.containers.matches.container.css.correct):$(matchset).addClass(options.containers.matches.container.css.incorrect),normalizedmatchsetData.matchIndicator&&$(matchset).find("."+options.containers.matches.pairIndicator.css.identifier).text(normalizedmatchsetData.matchIndicator)));$(matchset).data("matchingActivity:matchset",matchsetOptions)}}function calculateActivityScore(target,options,incrementAttempts,autoCompleteOverride,doNotUpdateExternalScore){incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1,doNotUpdateExternalScore=doNotUpdateExternalScore||!1;for(var matchesets=getSetContainers(0,options),activeSet=getActiveSetContainer(0,options),setScore=null,calculatedScore=0,calculatedPossible=0,totalCorrect=0,totalIncorrect=0,correctSelected=0,incorrectSelected=0,totalPossibleSelected=0,i=0;i<matchesets.length;i++)matchesets[i]==activeSet&&(activeSetPosition=i),log(target,options,"Set Score: "+(setScore=options.data.gradeSetsIndividually&&matchesets[i]==activeSet?calculateSetScore(target,options,matchesets[i],incrementAttempts,autoCompleteOverride):options.data.gradeSetsIndividually&&matchesets[i]!=activeSet?calculateSetScore(target,options,matchesets[i],!1,!1):calculateSetScore(target,options,matchesets[i],incrementAttempts,autoCompleteOverride)).calculatedScore+"/"+setScore.calculatedPossible),calculatedScore+=setScore.calculatedScore,calculatedPossible+=setScore.calculatedPossible,totalCorrect+=setScore.totalCorrect,totalIncorrect+=setScore.totalIncorrect,correctSelected+=setScore.correctSelected,incorrectSelected+=setScore.incorrectSelected,totalPossibleSelected+=setScore.totalPossibleSelected,$(target).trigger("setScoreChanged.matchingActivity",[options.data.dataSets.length,i,options.data.allowRetry,options.data.gradeSetsIndividually,setScore.calculatedScore,setScore.calculatedPossible,$(matchesets[i]).data("matchingActivity:set").completed,doNotUpdateExternalScore]);return log(target,options,"Score Recalculated:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityScoreChanged.matchingActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,$(activeSet).data("matchingActivity:set").completed,doNotUpdateExternalScore]),totalPossibleSelected==correctSelected+incorrectSelected&&(options.data.enabled=!1,$(target).data("matchingActivity:options",options),enableDisable(target,options),log(target,options,"Activity Completed:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityComplete.matchingActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore])),{calculatedScore:calculatedScore,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}}function calculateSetScore(target,options,setContainer,incrementAttempts,autoCompleteOverride){setContainer=setContainer||getActiveSetContainer(0,options),incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1;for(var setData=$(setContainer).data("matchingActivity:set"),itemsSelected=0,firstSelected=null,firstSelectedData=null,i=0;i<setData.matches.length;i++)matchset=setData.matches[i],matchsetData=$(matchset).data("matchingActivity:matchset"),$(matchset).hasClass(options.containers.matches.container.css.selected)&&(1==++itemsSelected&&(firstSelected=matchset,firstSelectedData=matchsetData),2==itemsSelected&&(itemsSelected=0,firstSelectedData.pairID==matchsetData.pairID?(setData.currentMatchIndicator++,firstSelectedData.correct=!0,matchsetData.correct=!0,firstSelectedData.matchIndicator=setData.currentMatchIndicator,matchsetData.matchIndicator=setData.currentMatchIndicator,$(matchset).data("matchingActivity:matchset",matchsetData),$(firstSelected).data("matchingActivity:matchset",firstSelectedData),$(matchset).find("."+options.containers.matches.pairIndicator.css.identifier).text(setData.currentMatchIndicator),$(firstSelected).find("."+options.containers.matches.pairIndicator.css.identifier).text(setData.currentMatchIndicator),$(matchset).hasClass(options.containers.matches.container.css.hover)&&$(matchset).removeClass(options.containers.matches.container.css.hover),$(firstSelected).hasClass(options.containers.matches.container.css.hover)&&$(firstSelected).removeClass(options.containers.matches.container.css.hover)):(setData.currentMatchIndicator++,firstSelectedData.correct=!1,matchsetData.correct=!1,firstSelectedData.matchIndicator=setData.currentMatchIndicator,matchsetData.matchIndicator=setData.currentMatchIndicator,$(matchset).data("matchingActivity:matchset",matchsetData),$(firstSelected).data("matchingActivity:matchset",firstSelectedData),$(matchset).find("."+options.containers.matches.pairIndicator.css.identifier).text(setData.currentMatchIndicator),$(firstSelected).find("."+options.containers.matches.pairIndicator.css.identifier).text(setData.currentMatchIndicator),$(matchset).hasClass(options.containers.matches.container.css.hover)&&$(matchset).removeClass(options.containers.matches.container.css.hover),$(firstSelected).hasClass(options.containers.matches.container.css.hover)&&$(firstSelected).removeClass(options.containers.matches.container.css.hover))));$(setContainer).data("matchingActivity:set",setData),setData.gradeIndividually?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!0):setData.autoComplete&&scoreResults.totalCorrect==scoreResults.correctSelected?(setData.completed=!0,setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1),incrementAttempts&&setData.attempts++):(clearCorrectAndIncorrectInSet(target,options,setContainer),setData.completed?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1):scoreResults.calculatedScore=0),$(setContainer).data("matchingActivity:set",setData);var setState=getSetState(0,options,setContainer),scoreResults=options.data.calculateScore(setState);return scoreResults}function showCorrectAndIncorrect(target,options,setContainer,showOnlySelected){setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0;$(setContainer).data("matchingActivity:set");if(options.data.enabled)for(var matches=getMatchesInSet(0,options,setContainer),matchset=null,matchsetOptions=null,itemsSelected=0,i=0;i<matches.length;i++)matchset=matches[i],matchsetOptions=$(matchset).data("matchingActivity:matchset"),!1,showOnlySelected&&$(matchset).hasClass(options.containers.matches.container.css.selected)?!0:showOnlySelected||!0,$(matchset).hasClass(options.containers.matches.container.css.selected)&&(1==++itemsSelected&&(firstSelectedContainer=$(matchset),firstSelected=matchsetOptions),2==itemsSelected&&(itemsSelected=0,firstSelected.pairID==matchsetOptions.pairID?(firstSelectedContainer.removeClass(options.containers.matches.container.css.selected),$(matchset).removeClass(options.containers.matches.container.css.selected),firstSelectedContainer.addClass(options.containers.matches.container.css.correct),$(matchset).addClass(options.containers.matches.container.css.correct)):(firstSelectedContainer.removeClass(options.containers.matches.container.css.selected),$(matchset).removeClass(options.containers.matches.container.css.selected),firstSelectedContainer.addClass(options.containers.matches.container.css.incorrect),$(matchset).addClass(options.containers.matches.container.css.incorrect))))}function clearIndicators(target,options,matches){if(matches=matches||getMatches(0,options),options.data.enabled)for(var matchset=null,i=0;i<matches.length;i++)matchset=matches[i],$(matchset).find("."+options.containers.matches.pairIndicator.css.identifier).text("")}function clearCorrectAndIncorrectInSet(target,options,setContainer,showOnlySelected){setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,matches=getMatchesInSet(0,options,setContainer);for(var matchset=null,i=0;i<matches.length;i++)matchset=matches[i],$(matchset).removeClass(options.containers.matches.container.css.incorrect),$(matchset).removeClass(options.containers.matches.container.css.correct)}function alignMatches(target,options,matches){if(matches=matches||getMatches(0,options))for(var matchset=null,matchsetContent=null,matchsetIndicator=null,i=0;i<matches.length;i++)matchset=matches[i],matchsetContent=$(matchset).children("."+options.containers.matches.content.css.identifier+":first"),matchsetIndicator=$(matchset).children("."+options.containers.matches.pairIndicator.css.identifier+":first"),alignToParent(target,options,options.containers.matches.content.horizontalAlign,options.containers.matches.content.verticalAlign,matchsetContent),alignToParent(target,options,options.containers.matches.pairIndicator.horizontalAlign,options.containers.matches.pairIndicator.verticalAlign,matchsetIndicator)}function alignSets(target,options,setContainers){setContainers=setContainers||getSetContainers(0,options);for(var setContainer=null,setContainerData=null,setWidth=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("matchingActivity:set"),setWidth=$(setContainer).width(),$(setContainer).css("left",setWidth*setContainerData.id+"px")}function alignToParent(target,options,horizontalAlign,verticalAlign,container){if($(container).css("position","absolute"),horizontalAlign)switch(horizontalAlign.toLowerCase()){case"left":$(container).css("right",null).css("left","0px");break;case"right":$(container).css("left",null).css("right","0px");break;case"center":$(container).css("right",null).css("left",$(container).parent().innerWidth()/2-$(container).outerWidth()/2+"px")}if(verticalAlign)switch(verticalAlign.toLowerCase()){case"top":$(container).css("bottom",null).css("top","0px");break;case"bottom":$(container).css("top",null).css("bottom","0px");break;case"middle":$(container).css("bottom",null).css("top",$(container).parent().innerHeight()/2-$(container).outerHeight()/2+"px")}}return this},$.fn.matchingActivity.defaults={},$.fn.matchingActivity.defaults.containers={activity:{reference:null,css:{identifier:"softchalk-matching-activity"}},content:{reference:null,css:{identifier:"softchalk-matching-activity-content",enabled:"enabled",disabled:"disabled"}},matchset:{reference:null,css:{identifier:"softchalk-matching-activity-sets",animating:"animating"}},set:{references:[],css:{identifier:"softchalk-matching-activity-set",selected:"selected",completed:"completed"}},matches:{references:[],container:{css:{identifier:"softchalk-matching-activity-choice",selected:"selected",correct:"correct",incorrect:"incorrect",hover:"hover"}},content:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-matching-activity-choice-content"}},pairIndicator:{horizontalAlign:"left",verticalAlign:"top",css:{identifier:"softchalk-matching-activity-choice-pair-indicator"}},feedback:{css:{identifier:"softchalk-matching-activity-choice-feedback"}},feedbackIcon:{css:{identifier:"softchalk-matching-activity-choice-feedback-icon"}},overlay:{css:{identifier:"softchalk-matching-activity-choice-overlay"}}}},$.fn.matchingActivity.defaults.data={dataSets:[],calculateScore:function(setState){for(var calculatedCorrect=0,calculatedPossible=0,matchsetData=null,correctSelected=0,incorrectSelected=0,totalCorrect=setState.matches.length,totalMatches=0,i=0;i<setState.matches.length;i++)totalMatches++,calculatedPossible+=(matchsetData=setState.matches[i]).value,matchsetData.finished&&(matchsetData.correct?(calculatedCorrect+=matchsetData.value,correctSelected++):(matchsetData.value,incorrectSelected++));return{calculatedScore:calculatedCorrect,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:0,correctSelected:correctSelected,incorrectSelected:incorrectSelected,totalPossibleSelected:totalMatches}},enabled:!0,enableLogging:!1,allowRetry:!0,randomizeOnRetry:!0,animate:!0,gradeSetsIndividually:!1,overridePoints:null},$.fn.matchingActivity.defaults.accessibility={pseudoMouse:{allow:!1,mice:[]},keyboard:{allow:!0},hasFocus:!1},$.fn.matchingActivity.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery),function($){$.fn.orderingActivity=function(action,options){var shouldReturnResults=!1,results=[],params=null;"object"==typeof(action=action||"initialize")&&(options=action,action="initialize"),"initialize"==action?options=options?$.extend(!0,{},$.fn.orderingActivity.defaults,options):$.fn.orderingActivity.defaults:params=options;var optionsReference=options;if($(this).each(function(){switch(action){case"initialize":log(this,optionsReference,"Action:Initializing Activity","info"),function(target,options){(options=$.extend(!0,{},options)).containers.activity.reference=target,$(options.containers.activity.reference).addClass(options.containers.activity.css.identifier),options.containers.content.reference=target,$(options.containers.content.reference).addClass(options.containers.content.css.identifier),null==options.containers.choice.reference&&(options.containers.choice.reference=$("<div />"),$(options.containers.content.reference).append(options.containers.choice.reference));options.containers.choice.reference.addClass(options.containers.choice.css.identifier),$(target).data("orderingActivity:options",options)}(this,optionsReference);break;case"loadXMLAndBuildActivity":log(this,options=$(this).data("orderingActivity:options"),"Action:Loading XML","info"),function(target,options,url){log(target,options,"Loading XML","info");var id=$(options.containers.activity.reference).parents(".softchalk-activity-wrapper").attr("id"),data=window[id.replace("-","")+"XML"],options=$(target).data("orderingActivity:options");parseXMLAndBuildActivity(target,options,data)}(this,options);break;case"parseXMLAndBuildActivity":log(this,options=$(this).data("orderingActivity:options"),"Action:Parsing XML","info"),parseXMLAndBuildActivity(this,options,params);break;case"calculateScore":log(this,options=$(this).data("orderingActivity:options"),"Action:Calculating Score","info"),calculateScore(this,options);break;case"reset":log(this,options=$(this).data("orderingActivity:options"),"Action:Resetting Activity","info"),function(target,options){if(options.data.allowRetry){log(target,options,"Resetting Activity","info");var setContainers=getSetContainers(target,options),activeSet=getActiveSetContainer(target,options),activeSetPosition=0,setContainer=null,setContainerData=null,choices=null,setScore=null;options.data.enabled=!0;for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("orderingActivity:set"),setContainer==activeSet&&(activeSetPosition=i),(options.data.gradeSetsIndividually&&setContainer==activeSet||!options.data.gradeSetsIndividually)&&(setContainerData.attempts=0,setContainerData.completed=!1,setContainerData.focusedChoiceId=null,setContainerData.focusedChoiceRow=-1,setContainerData.focusedChoiceColumn=-1,$(setContainer).data("orderingActivity:set",setContainerData),choices=getChoicesInSet(target,options,setContainer),clearChoicesHover(target,options,choices),clearCorrectAndIncorrectInSet(target,options,setContainer),clearSelectedChoices(target,options,choices),setScore=calculateSetScore(target,options,setContainer),setScore.calculatedScore,setScore.calculatedPossible,options.data.randomizeOnRetry&&(randomizeChoicePositionsInSet(target,options,setContainer),positionChoices(target,options,choices)),$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).removeClass(options.containers.set.css.completed));enableDisable(target,options);var setPosition=$(activeSet).data("orderingActivity:set").id;!options.data.gradeSetsIndividually&&options.data.randomizeOnRetry&&(setPosition=Math.floor(Math.random()*setContainers.length)),setContainer=setContainers[setPosition],setContainerData=$(setContainer).data("orderingActivity:set"),showSet(target,options,setContainerData.id,setContainers,!1,!0),activeSet=getActiveSetContainer(target,options);for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("orderingActivity:set"),setContainer==activeSet&&(activeSetPosition=i);$(target).data("orderingActivity:options",options),$(target).trigger("reset.orderingActivity",[setContainers.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually]),calculateActivityScore(target,options,!1)}}(this,options);break;case"finish":log(this,options=$(this).data("orderingActivity:options"),"Action:Finishing Activity","info"),calculateActivityScore(this,options,!0,!0);break;case"showNextSet":log(this,options=$(this).data("orderingActivity:options"),"Action:Showing Next Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i<setContainers.length-1){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i+1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i+1]).data("orderingActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"showPreviousSet":log(this,options=$(this).data("orderingActivity:options"),"Action:Showing Previous Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i>0){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i-1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i-1]).data("orderingActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"getState":log(this,options=$(this).data("orderingActivity:options"),"Action:Getting Activity State","info"),shouldReturnResults=!0,results.push({target:this,result:function(target,options){for(var activityState={enabled:options.data.enabled,allowRetry:options.data.allowRetry,randomizeOnRetry:options.data.randomizeOnRetry,activeSetId:function(target,options){return $(getActiveSetContainer(target,options)).data("orderingActivity:set").id||null}(target,options),sets:[]},setContainers=getSetContainers(target,options),i=0;i<setContainers.length;i++)activityState.sets.push(getSetState(target,options,setContainers[i]));return activityState}(this,options)});break;case"setState":log(this,options=$(this).data("orderingActivity:options"),"Action:Setting Activity State","info"),function(target,options,activityState,completed){log(target,options,"Setting Activity State for completed:"+completed);var setData=null,setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,choices=null;showSet(target,options,activityState.activeSetId,!1,!0);for(var i=0;i<activityState.sets.length;i++){setData=activityState.sets[i];for(var j=0;j<setContainers.length;j++)setContainer=setContainers[j],setContainerData=$(setContainer).data("orderingActivity:set"),choices=getChoicesInSet(target,options,setContainer),setData.id==setContainerData.id&&setSetState(target,options,setContainer,setData,setData.completed),positionChoices(target,options,choices)}options.data.enabled=activityState.enabled,options.data.allowRetry=activityState.allowRetry,options.data.randomizeOnRetry=activityState.randomizeOnRetry,$(target).data("orderingActivity:options",options),enableDisable(target,options),calculateActivityScore(target,options,!1,completed,!0)}(this,options,params.state,params.completed);break;case"getEnabled":log(this,options=$(this).data("orderingActivity:options"),"Action:Getting Enabled","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.enabled});break;case"setEnabled":log(this,options=$(this).data("orderingActivity:options"),"Action:Setting Enabled","info"),options.data.enabled=params,$(this).data("orderingActivity:options",options),enableDisable(this,options);break;case"getSetIds":log(this,options=$(this).data("orderingActivity:options"),"Action:Getting Set Ids","info");for(var setContainers=getSetContainers(this,options),setContainer=null,setContainerData=null,setIds=[],i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("orderingActivity:set"),setIds.push(setContainerData.id);shouldReturnResults=!0,results.push({target:this,result:setIds});break;case"getNumberOfSets":log(this,options=$(this).data("orderingActivity:options"),"Action:Getting number of sets","info"),shouldReturnResults=!0,results.push({target:this,result:getSetContainers(this,options).length});break;case"showSet":log(this,options=$(this).data("orderingActivity:options"),"Action:Getting number of sets","info"),showSet(this,options,params);break;case"getAllowReset":log(this,options=$(this).data("orderingActivity:options"),"Action:Getting allow reset","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.allowRetry});break;case"resize":var options;log(this,options=$(this).data("orderingActivity:options"),"Action:Resizing the activity","info"),function(target,options){alignSets(target,options);for(var setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,choices=null,choiceDimensions=null,i=(calculateContainerPadding(target,options,options.containers.choice.reference),0);i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("orderingActivity:set"),choices=getChoicesInSet(target,options,setContainer),choiceDimensions=calculateChoiceDimensions(target,options,setContainerData.rows,setContainerData.columns),resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,choices),positionChoices(target,options,choices),alignChoices(target,options,choices);log(target,options,"Activity Container Resized","info")}(this,options)}}),1==shouldReturnResults)return results;function log(target,options,data,level){level=level||"debug",level=$.trim(level).toLowerCase(),options.data.enableLogging&&window.console&&("info"==level&&window.console.info&&options.logging.info?$(target).attr("id")?window.console.info("[orderingActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.info("[orderingActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.info("[orderingActivity]["+target+"]"+data):"warn"==level&&window.console.warn&&options.logging.warn?$(target).attr("id")?window.console.warn("[orderingActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.warn("[orderingActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.warn("[orderingActivity]["+target+"]"+data):"error"==level&&window.console.error&&options.logging.error?$(target).attr("id")?window.console.error("[orderingActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.error("[orderingActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.error("[orderingActivity]["+target+"]"+data):window.console.log&&options.logging.debug&&($(target).attr("id")?window.console.log("[orderingActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.log("[orderingActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.log("[orderingActivity]["+target+"]"+data)))}function registerAccessibilityEvents(target,options,choices){var handleMiceEvents=function(event){var options=$(this).data("orderingActivity:options");if(options.data.enabled&&event.pageX&&event.pageY){var offset=$(this).offset(),width=$(this).outerWidth(),height=$(this).outerHeight();!options.accessibility.hasFocus&&event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height?(options.accessibility.hasFocus=!0,$(this).data("orderingActivity:options",options)):options.accessibility.hasFocus&&(event.pageX<offset.left||event.pageX>offset.left+width||event.pageY<offset.top||event.pageY>offset.top+height)&&(options.accessibility.hasFocus=!1,$(this).data("orderingActivity:options",options))}};$(target).bind("mouseover",handleMiceEvents).bind("mouseout",handleMiceEvents).bind("mousemove",handleMiceEvents),$(target).bind("focusin",function(event){var options=$(this).data("orderingActivity:options");if(options.data.enabled&&!options.accessibility.hasFocus){log(target,options,"Giving Focus","info"),options.accessibility.hasFocus=!0,$(this).data("orderingActivity:options",options);var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("orderingActivity:set");(activeSetData.focusedChoiceRow<0||activeSetData.focusedChoiceColumn<0||!activeSetData.focusedChoiceId)&&focusChoiceInSet(target,options,activeSet,null,0,0,!1)}}),$(target).bind("focusout",function(event){var options=$(this).data("orderingActivity:options");options.data.enabled&&options.accessibility.hasFocus&&(options.accessibility.hasFocus=!1,$(this).data("orderingActivity:options",options))}),options.accessibility.keyboard.allow&&function(target,options,choices){$(document).keydown(function(event){var options=$(target).data("orderingActivity:options");if(options.data.enabled&&options.accessibility.keyboard.allow&&options.accessibility.hasFocus){var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("orderingActivity:set");switch(event.keyCode){case 38:activeSetData.focusedChoiceRow-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow-1,activeSetData.focusedChoiceColumn);break;case 40:activeSetData.focusedChoiceRow+1<activeSetData.rows&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow+1,activeSetData.focusedChoiceColumn);break;case 37:activeSetData.focusedChoiceColumn-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn-1);break;case 39:activeSetData.focusedChoiceColumn+1<activeSetData.columns&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn+1);break;case 32:focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn,!0);break;case 13:calculateActivityScore(target,options)}}})}(target),options.accessibility.pseudoMouse.allow&&function(target,options,choices){for(var pseudoMice=options.accessibility.pseudoMouse.mice,mouse=null,offset=null,width=null,height=null,container=null,found=!1,i=0;i<pseudoMice.length;i++)mouse=pseudoMice[i],$(mouse).bind("mousemove",function(event){var options=$(target).data("orderingActivity:options");if(options.data.enabled){var event2=new $.Event("mousemove");event2.pageX=event.pageX,event2.pageY=event.pageY,$(target).trigger(event2)}if((options=$(target).data("orderingActivity:options")).data.enabled&&options.accessibility.hasFocus)for(var activeSet=getActiveSetContainer(target,options),choices=getChoicesInSet(target,options,activeSet),j=0;j<choices.length;j++)found=!1,container=$(choices[j]).children("."+options.containers.choices.downarrow.css.identifier).first(),offset=$(container).offset(),$(container).hasClass(options.containers.choices.container.css.hover)?(event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&(found=!0)),found||$(container).trigger("mouseout")):event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&$(container).trigger("mouseover"))}),$(mouse).bind("mouseup",function(event){var options=$(target).data("orderingActivity:options");if(options.data.enabled&&options.accessibility.hasFocus){container=null;for(var j=0;j<choices.length;j++)container=$(choices[j]).children("."+options.containers.choices.downarrow.css.identifier).first(),offset=$(container).offset(),width=$(container).width(),height=$(container).height(),event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height&&$(container).trigger("click")}})}(target,options,choices)}function calculateChoiceDimensions(target,options,rows,columns){var containerWidth=$(options.containers.choice.reference).width(),containerHeight=$(options.containers.choice.reference).height(),borderTestDiv=$("<div />").css("display","none").addClass(options.containers.choices.container.css.identifier).width(100).height(100);$(target).append(borderTestDiv);var borderWidthOffset=($(borderTestDiv).outerWidth()-$(borderTestDiv).innerWidth())/2,borderHeightOffset=($(borderTestDiv).outerHeight()-$(borderTestDiv).innerHeight())/2;return $(borderTestDiv).remove(),{width:(containerWidth-=borderWidthOffset+2)/columns,height:(containerHeight-=borderHeightOffset*(2*rows))/rows}}function calculateContainerPadding(target,options,container){var paddingTestDiv=$('<div style="padding:0px 0px 0px 0px;"/>');paddingTestDiv.css("padding-top",$(container).css("padding-top"));var paddingTop=$(paddingTestDiv).height();paddingTestDiv.css("padding-top","0px"),paddingTestDiv.css("padding-right",$(container).css("padding-right"));var paddingRight=$(paddingTestDiv).width();paddingTestDiv.css("padding-right","0px"),paddingTestDiv.css("padding-bottom",$(container).css("padding-bottom"));var paddingBottom=$(paddingTestDiv).height();paddingTestDiv.css("padding-bottom","0px"),paddingTestDiv.css("padding-left",$(container).css("padding-left"));var paddingLeft=$(paddingTestDiv).width();return paddingTestDiv.css("padding-left","0px"),{top:paddingTop,right:paddingRight,bottom:paddingBottom,left:paddingLeft}}function createChoiceContainer(target,options,contentHtml){var choice=$("<div />").addClass(options.containers.choices.container.css.identifier).css("position","absolute"),contentDiv=$("<div />").addClass(options.containers.choices.content.css.identifier);$(choice).append(contentDiv);var feedbackDiv=$("<div />").addClass(options.containers.choices.feedback.css.identifier);$(choice).append(feedbackDiv);var feedbackIconDiv=$("<div />").addClass(options.containers.choices.feedbackIcon.css.identifier);$(choice).append(feedbackIconDiv);var overlayDiv=$("<div />").addClass(options.containers.choices.overlay.css.identifier);$(choice).append(overlayDiv);var leftButtonDiv=$("<div />").addClass(options.containers.choices.leftButton.container.css.identifier);$(choice).append(leftButtonDiv);var leftButton=$("<div />").addClass(options.containers.choices.leftButton.button.css.identifier);$(leftButtonDiv).append(leftButton);var rightButtonDiv=$("<div />").addClass(options.containers.choices.rightButton.container.css.identifier);$(choice).append(rightButtonDiv);var rightButton=$("<div />").addClass(options.containers.choices.rightButton.button.css.identifier);return $(rightButtonDiv).append(rightButton),contentHtml&&$(contentDiv).html(contentHtml),choice}function enableDisable(target,options,choices){log(target,options,"Enabling/Disabling Activity:"+options.data.enabled,"info"),choices=choices||getChoices(target,options),options.data.enabled?($(options.containers.content.reference).removeClass(options.containers.content.css.disabled),$(options.containers.content.reference).addClass(options.containers.content.css.enabled),$(target).trigger("enabled.orderingActivity",[options.data.dataSets.length])):($(options.containers.content.reference).removeClass(options.containers.content.css.enabled),$(options.containers.content.reference).addClass(options.containers.content.css.disabled),clearChoicesHover(target,options,choices),$(target).trigger("disabled.orderingActivity",[options.data.dataSets.length]))}function resizeChoices(target,options,width,height,choices){choices=choices||getChoices(target,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).width(width),$(choice).height(height)}function positionChoices(target,options,choices,containerPadding){choices=choices||getChoices(target,options),containerPadding=containerPadding||calculateContainerPadding(0,0,options.containers.choice.reference);for(var choiceData=null,choice=null,i=0;i<choices.length;i++)choice=choices[i],choiceData=$(choice).data("orderingActivity:choice"),$(choice).css("left",-containerPadding.left+$(choice).outerWidth()*choiceData.column+"px"),$(choice).css("top",-containerPadding.top+$(choice).outerHeight()*choiceData.row+"px")}function randomizeChoicePositionsInSet(target,options,setContainer){setContainer=setContainer||getActiveSetContainer(target,options);for(var setData=$(setContainer).data("orderingActivity:set"),choices=getChoicesInSet(target,options,setContainer),choice=null,choiceData=null,unpositionedChoices=[],i=0;i<choices.length;i++)choice=choices[i],(choiceData=$(choice).data("orderingActivity:choice")).row=null,choiceData.column=null,$(choice).data("orderingActivity:choice",choiceData),unpositionedChoices.push(choice);var choiceMatrix=[],currentRow=0,currentColumn=0,currentRowArray=null;for(currentRow=0;currentRow<setData.rows;currentRow++){for(currentRowArray=[],currentColumn=0;currentColumn<setData.columns;currentColumn++)currentRowArray.push(null);choiceMatrix.push(currentRowArray)}for(var randomSelector=null,found=!1;unpositionedChoices.length>0;){for(randomSelector=Math.floor(Math.random()*unpositionedChoices.length),choice=unpositionedChoices.splice(randomSelector,1),choiceData=$(choice).data("orderingActivity:choice"),found=!1,currentRow=0;currentRow<setData.rows;currentRow++)for(currentColumn=0;currentColumn<setData.columns;currentColumn++)choiceMatrix[currentRow][currentColumn]||found||(found=!0,choiceMatrix[currentRow][currentColumn]=choice);choice=null}for(currentRow=0;currentRow<setData.rows;currentRow++)for(currentColumn=0;currentColumn<setData.columns;currentColumn++)choice=choiceMatrix[currentRow][currentColumn],(choiceData=$(choice).data("orderingActivity:choice")).row=currentRow,choiceData.column=currentColumn,$(choice).data("orderingActivity:choice",choiceData)}function registerChoiceEvents(target,options,choice){$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("mouseover",function(){var options=$(target).data("orderingActivity:options"),choiceOptions=$(choice).data("orderingActivity:choice"),setOptions=$(choice).parent().data("orderingActivity:set");options.data.enabled&&!setOptions.completed&&($(this).hasClass(options.containers.choices.rightButton.container.css.hover)||(clearChoicesHover(target,options),$(this).addClass(options.containers.choices.rightButton.container.css.hover),setOptions.focusedChoiceId=choiceOptions.id,setOptions.focusedChoiceRow=choiceOptions.row,setOptions.focusedChoiceColumn=choiceOptions.column,$(choice).parent().data("orderingActivity:set",setOptions),options.accessibility.hasFocus=!0,$(target).data("orderingActivity:options",options)))}),$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("mouseout",function(){var options=$(target).data("orderingActivity:options"),setOptions=($(choice).data("orderingActivity:choice"),$(choice).parent().data("orderingActivity:set"));options.data.enabled&&!setOptions.completed&&$(this).hasClass(options.containers.choices.rightButton.container.css.hover)&&($(this).removeClass(options.containers.choices.rightButton.container.css.hover),options.accessibility.hasFocus=!0,$(target).data("orderingActivity:options",options))}),$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("click",function(event){var options=$(target).data("orderingActivity:options"),setOptions=($(choice).data("orderingActivity:choice"),$(choice).parent().data("orderingActivity:set"));if(options.data.enabled&&!setOptions.completed&&!$(choice).hasClass(options.containers.choices.container.css.animating)){var shouldRecalculate=!1;moveChoice(target,options,null,$(this).parent(),0,-1),setOptions.gradeIndividually?shouldRecalculate=!0:(setOptions.allowRetry||!setOptions.allowRetry&&0==setOptions.attempts)&&(shouldRecalculate=!0),options.accessibility.hasFocus=!0,$(target).data("orderingActivity:options",options),shouldRecalculate&&calculateActivityScore(target,options)}}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("mouseover",function(){var options=$(target).data("orderingActivity:options"),choiceOptions=$(choice).data("orderingActivity:choice"),setOptions=$(choice).parent().data("orderingActivity:set");options.data.enabled&&!setOptions.completed&&($(this).hasClass(options.containers.choices.leftButton.container.css.hover)||(clearChoicesHover(target,options),$(this).addClass(options.containers.choices.leftButton.container.css.hover),setOptions.focusedChoiceId=choiceOptions.id,setOptions.focusedChoiceRow=choiceOptions.row,setOptions.focusedChoiceColumn=choiceOptions.column,$(choice).parent().data("orderingActivity:set",setOptions),options.accessibility.hasFocus=!0,$(target).data("orderingActivity:options",options)))}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("mouseout",function(){var options=$(target).data("orderingActivity:options"),setOptions=($(choice).data("orderingActivity:choice"),$(choice).parent().data("orderingActivity:set"));options.data.enabled&&!setOptions.completed&&$(this).hasClass(options.containers.choices.leftButton.container.css.hover)&&($(this).removeClass(options.containers.choices.leftButton.container.css.hover),options.accessibility.hasFocus=!0,$(target).data("orderingActivity:options",options))}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("click",function(event){var options=$(target).data("orderingActivity:options"),setOptions=($(choice).data("orderingActivity:choice"),$(choice).parent().data("orderingActivity:set"));if(options.data.enabled&&!setOptions.completed&&!$(choice).hasClass(options.containers.choices.container.css.animating)){var shouldRecalculate=!1;moveChoice(target,options,null,$(this).parent(),0,1),setOptions.gradeIndividually?shouldRecalculate=!0:(setOptions.allowRetry||!setOptions.allowRetry&&0==setOptions.attempts)&&(shouldRecalculate=!0),options.accessibility.hasFocus=!0,$(target).data("orderingActivity:options",options),shouldRecalculate&&calculateActivityScore(target,options)}})}function moveChoice(target,options,setContainer,choice,columnDelta,rowDelta){log(target,options,choice,"info"),setContainer=setContainer||getActiveSetContainer(target,options),columnDelta=columnDelta||0,rowDelta=rowDelta||0;var containerPadding=calculateContainerPadding(0,0,options.containers.choice.reference),choiceOptions=$(choice).data("orderingActivity:choice"),setOptions=$(setContainer).data("orderingActivity:set"),allChoicesInSet=getChoicesInSet(target,options,setContainer),workingChoice=null,workingChoiceData=null,targetColumn=choiceOptions.column+columnDelta,targetRow=choiceOptions.row+rowDelta;if(targetColumn=Math.min(Math.max(targetColumn,0),setOptions.columns-1),targetRow=Math.min(Math.max(targetRow,0),setOptions.rows-1),choiceOptions.row!=targetRow||choiceOptions.column!=targetColumn)for(var i=0;i<allChoicesInSet.length;i++)if(workingChoice=allChoicesInSet[i],(workingChoiceData=$(workingChoice).data("orderingActivity:choice")).column==targetColumn&&workingChoiceData.row==targetRow){var movingChoiceColumn=choiceOptions.column,movingChoiceRow=choiceOptions.row;if(choiceOptions.column=workingChoiceData.column,choiceOptions.row=workingChoiceData.row,workingChoiceData.column=movingChoiceColumn,workingChoiceData.row=movingChoiceRow,$(workingChoice).data("orderingActivity:choice",workingChoiceData),$(choice).data("orderingActivity:choice",choiceOptions),options.data.animate){var workingZIndex=$(workingChoice).css("z-index");$(workingChoice).addClass(options.containers.choices.container.css.animating),$(workingChoice).css("z-index",0).animate({left:-containerPadding.left+$(workingChoice).outerWidth()*workingChoiceData.column,top:-containerPadding.top+$(workingChoice).outerHeight()*workingChoiceData.row},"slow",null,function(){var reference=this;setTimeout(function(){$(reference).removeClass(options.containers.choices.container.css.animating),$(reference).css("z-index",workingZIndex)},50)});var choiceZIndex=$(choice).css("z-index");$(choice).addClass(options.containers.choices.container.css.animating),$(choice).css("z-index",1).animate({left:-containerPadding.left+$(choice).outerWidth()*choiceOptions.column,top:-containerPadding.top+$(choice).outerHeight()*choiceOptions.row},"slow",null,function(){var reference=this;setTimeout(function(){$(reference).removeClass(options.containers.choices.container.css.animating),$(reference).css("z-index",choiceZIndex)},50)})}else positionChoices(target,options);break}}function getSetContainers(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier)||[]}function getActiveSetContainer(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier).filter("."+options.containers.set.css.selected)[0]||null}function getChoices(target,options){var activeSetContainer=getActiveSetContainer(0,options);return $(activeSetContainer).children("."+options.containers.choices.container.css.identifier)||[]}function getChoicesInSet(target,options,setContainer){return $(setContainer).children("."+options.containers.choices.container.css.identifier)||[]}function clearChoicesHover(target,options,choices){choices||(choices=getChoices(0,options));for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.hover)}function focusChoiceInSet(target,options,setContainer,id,row,column,selectChoice){log(target,options,"Focusing Choice:{id:"+id+",row:"+row+",column:"+column+"}","info");var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null;selectChoice=selectChoice||!1,clearChoicesHover(0,options,choices);for(var i=0;i<choices.length;i++)choice=choices[i],id==(choiceOptions=$(choice).data("orderingActivity:choice")).id?($(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("click")):row==choiceOptions.row&&column==choiceOptions.column?($(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("click")):$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseout")}function clearSelectedChoices(target,options,choices){choices=choices||getChoices(0,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.selected)}function parseXMLAndBuildActivity(target,options,data){log(target,options,"Parsing Activity XML","info");try{if(window.ActiveXObject){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.loadXML(data),data=doc}else window.DOMParser&&(data=(new DOMParser).parseFromString(data,"text/xml"))}catch(error){data=null,log(target,options,"XML Parse Error:{error:"+error+"}","error")}if(data){var activityData={allowRetry:!0,randomizeOnRetry:!0,gradeSetsIndividually:!1,dataSets:[]},dataSet=null,choice=null;$(data).children("orderingActivity").find("allowRetry").first()&&(activityData.allowRetry="true"==$(data).children("orderingActivity").find("allowRetry").first().text().toLowerCase()),$(data).children("orderingActivity").attr("randomizeOnRetry")&&(activityData.randomizeOnRetry="true"==$(data).children("orderingActivity").attr("randomizeOnRetry").toLowerCase()),$(data).children("orderingActivity").attr("gradeSetsIndividually")&&(activityData.gradeSetsIndividually="true"==$(data).children("orderingActivity").attr("gradeSetsIndividually").toLowerCase()),$(data).children("orderingActivity").children("set").each(function(){dataSet={id:$(this).attr("id"),allowRetry:!1,showFeedback:!0,gradeIndividually:!1,autoComplete:!1,title:$(this).children("title:first").text(),rows:parseInt($(this).attr("rows")),columns:parseInt($(this).attr("columns")),choices:[]},$(this).children("title:first").attr("encoding")&&(dataSet.title=unescape(dataSet.title.replace(/\+/g," "))),$(this).children("choices").children("choice").each(function(){choice={id:$(this).attr("id"),content:$(this).text(),value:parseFloat($(this).attr("value")),selectOnce:!1},$(this).attr("encoding")&&(choice.content=unescape(choice.content.replace(/\+/g," "))),$(this).attr("selectOnce")&&(choice.selectOnce="true"==$(this).attr("selectOnce").toLowerCase()),dataSet.choices.push(choice)}),activityData.dataSets.push(dataSet)}),function(target,options,activityData){var dataSet=null,choiceDimensions=null,currentChoice=(calculateContainerPadding(0,0,options.containers.choice.reference),null),choices=[],currentRow=0,currentColumn=0,choice=null,setContainer=null;if(options.data.allowRetry=activityData.allowRetry,options.data.randomizeOnRetry=activityData.randomizeOnRetry,options.data.gradeSetsIndividually=activityData.gradeSetsIndividually,options.data.overridePoints||0==options.data.overridePoints){var totalCorrectPoints=0;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.value>0&&(totalCorrectPoints+=choice.value)})}),0!=totalCorrectPoints&&0!=options.data.overridePoints||(totalCorrectPoints=0,$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){options.data.overridePoints>0?(choice.value=1,totalCorrectPoints++):choice.value=0})}));var factor=options.data.overridePoints/totalCorrectPoints;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.value=choice.value*factor})})}for(var i=0;i<activityData.dataSets.length;i++){dataSet=$.extend({},activityData.dataSets[i],{choices:[],attempts:0,focusedChoiceId:null,focusedChoiceRow:-1,focusedChoiceColumn:-1,completed:!1}),activityData.dataSets[i].choices.length%dataSet.columns?dataSet.rows=parseInt(activityData.dataSets[i].choices.length/dataSet.columns)+1:dataSet.rows=parseInt(activityData.dataSets[i].choices.length/dataSet.columns),options.data.dataSets.push(dataSet),choiceDimensions=calculateChoiceDimensions(target,options,dataSet.rows,dataSet.columns),currentRow=0,currentColumn=0,choice=null;for(var j=0;j<activityData.dataSets[i].choices.length;j++)choice=activityData.dataSets[i].choices[j],currentChoice=createChoiceContainer(0,options,choice.content),$(currentChoice).data("orderingActivity:choice",{id:choice.id,row:currentRow,column:currentColumn,value:choice.value,correct:choice.correct,selectOnce:choice.selectOnce}),registerChoiceEvents(target,options,currentChoice),dataSet.choices.push(currentChoice),choices.push(currentChoice),++currentColumn>=dataSet.columns&&(currentColumn=0,currentRow++);setContainer=createSetContainer(target,options),options.containers.set.references.push(setContainer),$(setContainer).data("orderingActivity:set",dataSet),$(options.containers.choice.reference).append(setContainer);for(var j=0;j<dataSet.choices.length;j++)$(setContainer).append(dataSet.choices[j]);resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,dataSet.choices),randomizeChoicePositionsInSet(target,options,setContainer),positionChoices(target,options,dataSet.choices),alignChoices(target,options,dataSet.choices)}registerAccessibilityEvents(target,options,choices),enableDisable(target,options,choices),$(target).data("orderingActivity:options",options),alignSets(target,options),showSet(target,options,activityData.dataSets[0].id),calculateActivityScore(target,options,!1),$(target).trigger("activityLoaded.orderingActivity",[options.data.dataSets.length,0,options.data.allowRetry,options.data.gradeSetsIndividually])}(target,options,activityData)}else log(target,options,"XML Activity Build Error:{error:No data to build activity}","error")}function createSetContainer(target,options){return $("<div />").addClass(options.containers.set.css.identifier)}function showSet(target,options,id,setContainers,reset,resetPosition){setContainers=setContainers||getSetContainers(0,options),reset=reset||!1,resetPosition=resetPosition||!1;for(var setContainer=null,setContainerData=null,selectedSetContainerData=null,setPosition=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("orderingActivity:set"),$(setContainer).removeClass(options.containers.set.css.selected),setContainerData.id==id&&(setPosition=i,selectedSetContainerData=setContainerData,setContainer,$(setContainer).addClass(options.containers.set.css.selected));var choices=getChoices(0,options);if(positionChoices(target,options,choices),alignChoices(target,options,choices),reset&&selectedSetContainerData&&(options.data.enabled=!0,enableDisable(target,options,choices),$(target).data("orderingActivity:data",options)),resetPosition){var finalPosition=-$(options.containers.choice.reference).outerWidth()*[id];$(options.containers.choice.reference).css("left",finalPosition+"px")}$(target).trigger("titleChanged.orderingActivity",[selectedSetContainerData.title]),$(target).trigger("setChanged.orderingActivity",[setContainers.length,setPosition,options.data.gradeSetsIndividually,options.data.allowRetry,selectedSetContainerData.completed,options.data.enabled])}function getSetState(target,options,setContainer){for(var setContainerData=$(setContainer).data("orderingActivity:set"),setState={id:setContainerData.id,allowRetry:setContainerData.allowRetry,showFeedback:setContainerData.showFeedback,gradeIndividually:setContainerData.gradeIndividually,attempts:setContainerData.attempts,completed:setContainerData.completed,choices:[]},setChoices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,normalizedChoiceData=null,i=0;i<setChoices.length;i++)choice=setChoices[i],normalizedChoiceData={id:(choiceOptions=$(choice).data("orderingActivity:choice")).id,row:choiceOptions.row,column:choiceOptions.column,correct:choiceOptions.id==choiceOptions.row,value:choiceOptions.value,selected:$(choice).hasClass(options.containers.choices.container.css.selected)},setState.choices.push(normalizedChoiceData);return setState}function setSetState(target,options,setContainer,setState){log(target,options,"Setting Set State:"+setState.id);var setContainerData=$(setContainer).data("orderingActivity:set");setContainerData.allowRetry=setState.allowRetry,setContainerData.showFeedback=setState.showFeedback,setContainerData.gradeIndividually=setState.gradeIndividually,setContainerData.attempts=setState.attempts,setContainerData.completed=setState.completed,$(setContainer).data("orderingActivity:set",setContainerData),setContainerData.completed&&!$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).addClass(options.containers.set.css.completed);for(var setChoices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,normalizedChoiceData=null,i=0;i<setChoices.length;i++){choice=setChoices[i],choiceOptions=$(choice).data("orderingActivity:choice");for(var j=0;j<setState.choices.length;j++)(normalizedChoiceData=setState.choices[j]).id==choiceOptions.id&&(choiceOptions.row=normalizedChoiceData.row,choiceOptions.column=normalizedChoiceData.column,choiceOptions.correct=normalizedChoiceData.correct,choiceOptions.value=normalizedChoiceData.value,$(choice).removeClass(options.containers.choices.container.css.selected),normalizedChoiceData.selected&&$(choice).addClass(options.containers.choices.container.css.selected),setContainerData.completed&&(choiceOptions.correct?$(choice).addClass(options.containers.choices.container.css.correct):$(choice).addClass(options.containers.choices.container.css.incorrect)));$(choice).data("orderingActivity:choice",choiceOptions)}}function calculateActivityScore(target,options,incrementAttempts,autoCompleteOverride,doNotUpdateExternalScore){incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1,doNotUpdateExternalScore=doNotUpdateExternalScore||!1;for(var choiceSets=getSetContainers(0,options),activeSet=getActiveSetContainer(0,options),activeSetPosition=0,setScore=null,calculatedScore=0,calculatedPossible=0,totalCorrect=0,totalIncorrect=0,correctSelected=0,incorrectSelected=0,i=0;i<choiceSets.length;i++)choiceSets[i]==activeSet&&(activeSetPosition=i),calculatedScore+=(setScore=options.data.gradeSetsIndividually&&choiceSets[i]==activeSet?calculateSetScore(target,options,choiceSets[i],incrementAttempts,autoCompleteOverride):options.data.gradeSetsIndividually&&choiceSets[i]!=activeSet?calculateSetScore(target,options,choiceSets[i],!1,!1):calculateSetScore(target,options,choiceSets[i],incrementAttempts,autoCompleteOverride)).calculatedScore,calculatedPossible+=setScore.calculatedPossible,totalCorrect+=setScore.totalCorrect,totalIncorrect+=setScore.totalIncorrect,correctSelected+=setScore.correctSelected,incorrectSelected+=setScore.incorrectSelected,$(target).trigger("setScoreChanged.orderingActivity",[options.data.dataSets.length,i,options.data.allowRetry,options.data.gradeSetsIndividually,setScore.calculatedScore,setScore.calculatedPossible,$(choiceSets[i]).data("orderingActivity:set").completed,doNotUpdateExternalScore]);return log(target,options,"Score Recalculated:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityScoreChanged.orderingActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,$(activeSet).data("orderingActivity:set").completed,doNotUpdateExternalScore]),!options.data.gradeSetsIndividually&&autoCompleteOverride&&(options.data.enabled=!1,$(target).data("orderingActivity:options",options),enableDisable(target,options),log(target,options,"Activity Completed:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityComplete.orderingActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore])),{calculatedScore:calculatedScore,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}}function calculateSetScore(target,options,setContainer,incrementAttempts,autoCompleteOverride){setContainer=setContainer||getActiveSetContainer(0,options),incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1;var setData=$(setContainer).data("orderingActivity:set"),setState=getSetState(0,options,setContainer),scoreResults=options.data.calculateScore(setState);return setData.gradeIndividually?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!0):setData.autoComplete&&scoreResults.totalCorrect==scoreResults.correctSelected||1==autoCompleteOverride?(setData.completed=!0,$(setContainer).hasClass(options.containers.set.css.completed)||$(setContainer).addClass(options.containers.set.css.completed),setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1),incrementAttempts&&setData.attempts++):(clearCorrectAndIncorrectInSet(target,options,setContainer),setData.completed?setData.showFeedback&&showCorrectAndIncorrectInSet(target,options,setContainer,!1):scoreResults.calculatedScore=0),$(setContainer).data("orderingActivity:set",setData),scoreResults}function showCorrectAndIncorrect(target,options,setContainer,showOnlySelected){if(setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,options.data.enabled)for(var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,i=0;i<choices.length;i++)choice=choices[i],choiceOptions=$(choice).data("orderingActivity:choice"),!0?choiceOptions.row==choiceOptions.id?($(choice).removeClass(options.containers.choices.container.css.incorrect),$(choice).hasClass(options.containers.choices.container.css.correct)||$(choice).addClass(options.containers.choices.container.css.correct)):($(choice).removeClass(options.containers.choices.container.css.correct),$(choice).hasClass(options.containers.choices.container.css.incorrect)||$(choice).addClass(options.containers.choices.container.css.incorrect)):($(choice).removeClass(options.containers.choices.container.css.correct),$(choice).removeClass(options.containers.choices.container.css.incorrect))}function clearCorrectAndIncorrectInSet(target,options,setContainer,showOnlySelected){setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,choices=getChoicesInSet(0,options,setContainer);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.incorrect),$(choice).removeClass(options.containers.choices.container.css.correct)}function alignChoices(target,options,choices){if(choices=choices||getChoices(0,options))for(var choice=null,choiceContent=null,leftContent=null,rightContent=null,feedbackIconContent=null,i=0;i<choices.length;i++)choice=choices[i],choiceContent=$(choice).children("."+options.containers.choices.content.css.identifier+":first"),leftContent=$(choice).find("."+options.containers.choices.leftButton.button.css.identifier+":first"),rightContent=$(choice).find("."+options.containers.choices.rightButton.button.css.identifier+":first"),feedbackIconContent=$(choice).find("."+options.containers.choices.feedbackIcon.css.identifier+":first"),alignToParent(target,options,options.containers.choices.content.horizontalAlign,options.containers.choices.content.verticalAlign,choiceContent),alignToParent(target,options,"left","middle",leftContent),alignToParent(target,options,"right","middle",rightContent),alignToParent(target,options,options.containers.choices.feedbackIcon.horizontalAlign,options.containers.choices.feedbackIcon.verticalAlign,feedbackIconContent)}function alignSets(target,options,setContainers){setContainers=setContainers||getSetContainers(0,options);for(var setContainer=null,setContainerData=null,setWidth=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("orderingActivity:set"),setWidth=$(setContainer).width(),$(setContainer).css("left",setWidth*setContainerData.id+"px")}function alignToParent(target,options,horizontalAlign,verticalAlign,container){if($(container).css("position","absolute"),horizontalAlign)switch(horizontalAlign.toLowerCase()){case"left":$(container).css("right",null).css("left","0px");break;case"right":$(container).css("left",null).css("right","0px");break;case"center":$(container).css("right",null).css("left",$(container).parent().innerWidth()/2-$(container).outerWidth()/2+"px")}if(verticalAlign)switch(verticalAlign.toLowerCase()){case"top":$(container).css("bottom",null).css("top","0px");break;case"bottom":$(container).css("top",null).css("bottom","0px");break;case"middle":$(container).css("bottom",null).css("top",$(container).parent().innerHeight()/2-$(container).outerHeight()/2+"px")}}return this},$.fn.orderingActivity.defaults={},$.fn.orderingActivity.defaults.containers={activity:{reference:null,css:{identifier:"softchalk-ordering-activity"}},content:{reference:null,css:{identifier:"softchalk-ordering-activity-content",enabled:"enabled",disabled:"disabled"}},choice:{reference:null,css:{identifier:"softchalk-ordering-activity-sets",animating:"animating"}},set:{references:[],css:{identifier:"softchalk-ordering-activity-set",selected:"selected",completed:"completed"}},choices:{references:[],container:{css:{identifier:"softchalk-ordering-activity-choice",selected:"selected",correct:"correct",incorrect:"incorrect",hover:"hover",animating:"animating"}},content:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-ordering-activity-choice-content"}},leftButton:{container:{css:{identifier:"softchalk-ordering-activity-choice-left-button-container",hover:"hover"}},button:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-ordering-activity-choice-left-button",hover:"hover"}}},rightButton:{container:{css:{identifier:"softchalk-ordering-activity-choice-right-button-container",hover:"hover"}},button:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-ordering-activity-choice-right-button",hover:"hover"}}},feedback:{css:{identifier:"softchalk-ordering-activity-choice-feedback"}},feedbackIcon:{horizontalAlign:"right",verticalAlign:"middle",css:{identifier:"softchalk-ordering-activity-choice-feedback-icon"}},overlay:{css:{identifier:"softchalk-ordering-activity-choice-overlay"}}}},$.fn.orderingActivity.defaults.data={dataSets:[],calculateScore:function(setState){for(var calculatedCorrect=0,calculatedIncorrect=0,calculatedPossible=0,choiceData=null,correctSelected=0,incorrectSelected=0,totalCorrect=0,totalIncorrect=0,i=0;i<setState.choices.length;i++)calculatedPossible+=(choiceData=setState.choices[i]).value,choiceData.row==choiceData.id?(totalCorrect++,calculatedCorrect+=choiceData.value,correctSelected++):(totalIncorrect++,calculatedIncorrect+=choiceData.value,incorrectSelected++);Math.max(0,calculatedCorrect-calculatedIncorrect);return{calculatedScore:calculatedCorrect,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}},enabled:!0,enableLogging:!1,allowRetry:!0,randomizeOnRetry:!0,animate:!0,gradeSetsIndividually:!1,overridePoints:null},$.fn.orderingActivity.defaults.accessibility={pseudoMouse:{allow:!0,mice:[]},keyboard:{allow:!0},hasFocus:!1},$.fn.orderingActivity.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery),function($){$.fn.selectAllActivity=function(action,options){var shouldReturnResults=!1,results=[],params=null;"object"==typeof(action=action||"initialize")&&(options=action,action="initialize"),"initialize"==action?options=options?$.extend(!0,{},$.fn.selectAllActivity.defaults,options):$.fn.selectAllActivity.defaults:params=options;var optionsReference=options;if($(this).each(function(){switch(action){case"initialize":log(this,optionsReference,"Action:Initializing Activity","info"),function(target,options){(options=$.extend(!0,{},options)).containers.activity.reference=target,$(options.containers.activity.reference).addClass(options.containers.activity.css.identifier),options.containers.content.reference=target,$(options.containers.content.reference).addClass(options.containers.content.css.identifier),null==options.containers.choice.reference&&(options.containers.choice.reference=$("<div />"),$(options.containers.content.reference).append(options.containers.choice.reference));options.containers.choice.reference.addClass(options.containers.choice.css.identifier),$(target).data("selectAllActivity:options",options)}(this,optionsReference);break;case"loadXMLAndBuildActivity":log(this,options=$(this).data("selectAllActivity:options"),"Action:Loading XML","info"),loadXMLAndBuildActivity(this,options,params);break;case"parseXMLAndBuildActivity":log(this,options=$(this).data("selectAllActivity:options"),"Action:Parsing XML","info"),parseXMLAndBuildActivity(this,options,params);break;case"calculateScore":log(this,options=$(this).data("selectAllActivity:options"),"Action:Calculating Score","info"),calculateActivityScore(this,options);break;case"finish":log(this,options=$(this).data("selectAllActivity:options"),"Action:Finishing Activity","info"),calculateActivityScore(this,options,!0,!0);break;case"reset":log(this,options=$(this).data("selectAllActivity:options"),"Action:Resetting Activity","info"),function(target,options){if(options.data.allowRetry){log(target,options,"Resetting Activity","info");var setContainers=getSetContainers(target,options),activeSet=getActiveSetContainer(target,options),activeSetPosition=0,setContainer=null,setContainerData=null,choices=null,setScore=null;options.data.enabled=!0;for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("selectAllActivity:set"),setContainer==activeSet&&(activeSetPosition=i),(options.data.gradeSetsIndividually&&setContainer==activeSet||!options.data.gradeSetsIndividually)&&(setContainerData.attempts=0,setContainerData.completed=!1,setContainerData.focusedChoiceId=null,setContainerData.focusedChoiceRow=-1,setContainerData.focusedChoiceColumn=-1,$(setContainer).data("selectAllActivity:set",setContainerData),choices=getChoicesInSet(target,options,setContainer),clearChoicesHover(target,options,choices),clearCorrectAndIncorrectInSet(target,options,setContainer),clearSelectedChoices(target,options,choices),setScore=calculateSetScore(target,options,setContainer),setScore.calculatedScore,setScore.calculatedPossible,options.data.randomizeOnRetry&&(randomizeChoicePositionsInSet(target,options,setContainer),positionChoices(target,options,choices)),$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).removeClass(options.containers.set.css.completed));enableDisable(target,options);var setPosition=$(activeSet).data("selectAllActivity:set").id;!options.data.gradeSetsIndividually&&options.data.randomizeOnRetry&&(setPosition=Math.floor(Math.random()*setContainers.length)),setContainer=setContainers[setPosition],setContainerData=$(setContainer).data("selectAllActivity:set"),showSet(target,options,setContainerData.id,setContainers,!1,!0),activeSet=getActiveSetContainer(target,options);for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("selectAllActivity:set"),setContainer==activeSet&&(activeSetPosition=i);$(target).data("selectAllActivity:options",options),$(target).trigger("reset.selectAllActivity",[setContainers.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually]),calculateActivityScore(target,options,!1)}}(this,options);break;case"showNextSet":log(this,options=$(this).data("selectAllActivity:options"),"Action:Showing Next Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i<setContainers.length-1){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i+1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i+1]).data("selectAllActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"showPreviousSet":log(this,options=$(this).data("selectAllActivity:options"),"Action:Showing Previous Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if($(setContainers[i]).stop(!0,!0),setContainers[i]==currentSetContainer&&i>0){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i-1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i-1]).data("selectAllActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"getState":log(this,options=$(this).data("selectAllActivity:options"),"Action:Getting Activity State","info"),shouldReturnResults=!0,results.push({target:this,result:function(target,options){for(var activityState={completed:options.data.completed,enabled:options.data.enabled,allowRetry:options.data.allowRetry,randomizeOnRetry:options.data.randomizeOnRetry,activeSetId:function(target,options){return $(getActiveSetContainer(target,options)).data("selectAllActivity:set").id||null}(target,options),sets:[]},setContainers=getSetContainers(target,options),i=0;i<setContainers.length;i++)activityState.sets.push(getSetState(target,options,setContainers[i]));return activityState}(this,options)});break;case"setState":log(this,options=$(this).data("selectAllActivity:options"),"Action:Setting Activity State","info"),function(target,options,activityState,completed){log(target,options,"Setting Activity State");var setData=null,setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,choices=null;showSet(target,options,activityState.activeSetId,!1,!0);for(var i=0;i<activityState.sets.length;i++){setData=activityState.sets[i];for(var j=0;j<setContainers.length;j++)setContainer=setContainers[j],setContainerData=$(setContainer).data("selectAllActivity:set"),choices=getChoicesInSet(target,options,setContainer),setData.id==setContainerData.id&&setSetState(target,options,setContainer,setData),positionChoices(target,options,choices)}options.data.completed=activityState.completed,options.data.enabled=activityState.enabled,options.data.allowRetry=activityState.allowRetry,options.data.randomizeOnRetry=activityState.randomizeOnRetry,$(target).data("selectAllActivity:options",options),enableDisable(target,options),calculateActivityScore(target,options,!1,completed,!0)}(this,options,params.state,params.completed);break;case"getEnabled":log(this,options=$(this).data("selectAllActivity:options"),"Action:Getting Enabled","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.enabled});break;case"setEnabled":log(this,options=$(this).data("selectAllActivity:options"),"Action:Setting Enabled","info"),options.data.enabled=params,$(this).data("selectAllActivity:options",options),enableDisable(this,options);break;case"getSetIds":log(this,options=$(this).data("selectAllActivity:options"),"Action:Getting Set Ids","info");for(var setContainers=getSetContainers(this,options),setContainer=null,setContainerData=null,setIds=[],i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("selectAllActivity:set"),setIds.push(setContainerData.id);shouldReturnResults=!0,results.push({target:this,result:setIds});break;case"getNumberOfSets":log(this,options=$(this).data("selectAllActivity:options"),"Action:Getting number of sets","info"),shouldReturnResults=!0,results.push({target:this,result:getSetContainers(this,options).length});break;case"showSet":log(this,options=$(this).data("selectAllActivity:options"),"Action:Showing set","info"),showSet(this,options,params);break;case"getAllowReset":log(this,options=$(this).data("selectAllActivity:options"),"Action:Getting allow reset","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.allowRetry});break;case"resize":var options;log(this,options=$(this).data("selectAllActivity:options"),"Action:Resizing the activity","info"),function(target,options){alignSets(target,options);for(var setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,choices=null,choiceDimensions=null,i=(calculateContainerPadding(target,options,options.containers.choice.reference),0);i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("selectAllActivity:set"),choices=getChoicesInSet(target,options,setContainer),choiceDimensions=calculateChoiceDimensions(target,options,setContainerData.rows,setContainerData.columns),resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,choices),positionChoices(target,options,choices),alignChoices(target,options,choices);log(target,options,"Activity Container Resized","info")}(this,options)}}),1==shouldReturnResults)return results;function log(target,options,data,level){level=level||"debug",level=$.trim(level).toLowerCase(),options.data.enableLogging&&window.console&&("info"==level&&window.console.info&&options.logging.info?$(target).attr("id")?window.console.info("[SelectAllActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.info("[SelectAllActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.info("[SelectAllActivity]["+target+"]"+data):"warn"==level&&window.console.warn&&options.logging.warn?$(target).attr("id")?window.console.warn("[SelectAllActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.warn("[SelectAllActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.warn("[SelectAllActivity]["+target+"]"+data):"error"==level&&window.console.error&&options.logging.error?$(target).attr("id")?window.console.error("[SelectAllActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.error("[SelectAllActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.error("[SelectAllActivity]["+target+"]"+data):window.console.log&&options.logging.debug&&($(target).attr("id")?window.console.log("[SelectAllActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.log("[SelectAllActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.log("[SelectAllActivity]["+target+"]"+data)))}function registerAccessibilityEvents(target,options,choices){var handleMiceEvents=function(event){var options=$(this).data("selectAllActivity:options");if(options.data.enabled&&event.pageX&&event.pageY){var offset=$(this).offset(),width=$(this).outerWidth(),height=$(this).outerHeight();!options.accessibility.hasFocus&&event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height?(options.accessibility.hasFocus=!0,$(this).data("selectAllActivity:options",options)):options.accessibility.hasFocus&&(event.pageX<offset.left||event.pageX>offset.left+width||event.pageY<offset.top||event.pageY>offset.top+height)&&(options.accessibility.hasFocus=!1,$(this).data("selectAllActivity:options",options))}};$(target).bind("mouseover",handleMiceEvents).bind("mouseout",handleMiceEvents).bind("mousemove",handleMiceEvents),$(target).bind("focusin",function(event){var options=$(this).data("selectAllActivity:options");if(options.data.enabled&&!options.accessibility.hasFocus){log(target,options,"Giving Focus","info"),options.accessibility.hasFocus=!0,$(this).data("selectAllActivity:options",options);var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("selectAllActivity:set");(activeSetData.focusedChoiceRow<0||activeSetData.focusedChoiceColumn<0||!activeSetData.focusedChoiceId)&&focusChoiceInSet(target,options,activeSet,null,0,0,!1)}}),$(target).bind("focusout",function(event){var options=$(this).data("selectAllActivity:options");options.data.enabled&&options.accessibility.hasFocus&&(options.accessibility.hasFocus=!1,$(this).data("selectAllActivity:options",options))}),options.accessibility.keyboard.allow&&function(target,options,choices){$(document).keydown(function(event){var options=$(target).data("selectAllActivity:options");if(options.data.enabled&&options.accessibility.keyboard.allow&&options.accessibility.hasFocus){var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("selectAllActivity:set");switch(event.keyCode){case 38:activeSetData.focusedChoiceRow-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow-1,activeSetData.focusedChoiceColumn);break;case 40:activeSetData.focusedChoiceRow+1<activeSetData.rows&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow+1,activeSetData.focusedChoiceColumn);break;case 37:activeSetData.focusedChoiceColumn-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn-1);break;case 39:activeSetData.focusedChoiceColumn+1<activeSetData.columns&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn+1);break;case 32:focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn,!0);break;case 13:calculateActivityScore(target,options)}}})}(target),options.accessibility.pseudoMouse.allow&&function(target,options,choices){for(var pseudoMice=options.accessibility.pseudoMouse.mice,mouse=null,offset=null,width=null,height=null,container=null,found=!1,i=0;i<pseudoMice.length;i++)mouse=pseudoMice[i],$(mouse).bind("mousemove",function(event){var options=$(target).data("selectAllActivity:options");if(options.data.enabled){var event2=new $.Event("mousemove");event2.pageX=event.pageX,event2.pageY=event.pageY,$(target).trigger(event2)}if((options=$(target).data("selectAllActivity:options")).data.enabled&&options.accessibility.hasFocus)for(var activeSet=getActiveSetContainer(target,options),choices=getChoicesInSet(target,options,activeSet),j=0;j<choices.length;j++)found=!1,container=$(choices[j]).children("."+options.containers.choices.overlay.css.identifier).first(),offset=$(container).offset(),$(container).hasClass(options.containers.choices.container.css.hover)?(event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&(found=!0)),found||$(container).trigger("mouseout")):event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&$(container).trigger("mouseover"))}),$(mouse).bind("mouseup",function(event){var options=$(target).data("selectAllActivity:options");if(options.data.enabled&&options.accessibility.hasFocus){container=null;for(var j=0;j<choices.length;j++)container=$(choices[j]).children("."+options.containers.choices.overlay.css.identifier).first(),offset=$(container).offset(),width=$(container).width(),height=$(container).height(),event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height&&$(container).trigger("click")}})}(target,options,choices),options.data.xmlFile&&loadXMLAndBuildActivity(target,options,options.data.xmlFile)}function calculateChoiceDimensions(target,options,rows,columns){var containerWidth=$(options.containers.choice.reference).width(),containerHeight=$(options.containers.choice.reference).height(),borderTestDiv=$("<div />").css("display","none").addClass(options.containers.choices.container.css.identifier).width(100).height(100);$(target).append(borderTestDiv);var borderWidthOffset=($(borderTestDiv).outerWidth()-$(borderTestDiv).innerWidth())/2,borderHeightOffset=($(borderTestDiv).outerHeight()-$(borderTestDiv).innerHeight())/2;return $(borderTestDiv).remove(),{width:(containerWidth-=borderWidthOffset*(2*columns))/columns,height:(containerHeight-=borderHeightOffset*(2*rows))/rows}}function calculateContainerPadding(target,options,container){var paddingTestDiv=$('<div style="padding:0px 0px 0px 0px;"/>');paddingTestDiv.css("padding-top",$(container).css("padding-top"));var paddingTop=$(paddingTestDiv).height();paddingTestDiv.css("padding-top","0px"),paddingTestDiv.css("padding-right",$(container).css("padding-right"));var paddingRight=$(paddingTestDiv).width();paddingTestDiv.css("padding-right","0px"),paddingTestDiv.css("padding-bottom",$(container).css("padding-bottom"));var paddingBottom=$(paddingTestDiv).height();paddingTestDiv.css("padding-bottom","0px"),paddingTestDiv.css("padding-left",$(container).css("padding-left"));var paddingLeft=$(paddingTestDiv).width();return paddingTestDiv.css("padding-left","0px"),{top:paddingTop,right:paddingRight,bottom:paddingBottom,left:paddingLeft}}function createChoiceContainer(target,options,contentHtml){var choice=$("<div />").addClass(options.containers.choices.container.css.identifier).css("position","absolute"),contentDiv=$("<div />").addClass(options.containers.choices.content.css.identifier);$(choice).append(contentDiv);var feedbackDiv=$("<div />").addClass(options.containers.choices.feedback.css.identifier);$(choice).append(feedbackDiv);var feedbackIconDiv=$("<div />").addClass(options.containers.choices.feedbackIcon.css.identifier);$(choice).append(feedbackIconDiv);var overlayDiv=$("<div />").addClass(options.containers.choices.overlay.css.identifier);return $(choice).append(overlayDiv),contentHtml&&$(contentDiv).html(contentHtml),choice}function enableDisable(target,options,choices){log(target,options,"Enabling/Disabling Activity:"+options.data.enabled,"info"),choices=choices||getChoices(target,options),options.data.enabled?($(options.containers.content.reference).removeClass(options.containers.content.css.disabled),$(options.containers.content.reference).addClass(options.containers.content.css.enabled),$(target).trigger("enabled.selectAllActivity",[options.data.dataSets.length])):($(options.containers.content.reference).removeClass(options.containers.content.css.enabled),$(options.containers.content.reference).addClass(options.containers.content.css.disabled),clearChoicesHover(target,options,choices),$(target).trigger("disabled.selectAllActivity",[options.data.dataSets.length]))}function resizeChoices(target,options,width,height,choices){choices=choices||getChoices(target,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).width(width),$(choice).height(height)}function positionChoices(target,options,choices,containerPadding){choices=choices||getChoices(target,options),containerPadding=containerPadding||calculateContainerPadding(0,0,options.containers.choice.reference);for(var choiceData=null,choice=null,i=0;i<choices.length;i++)choice=choices[i],choiceData=$(choice).data("selectAllActivity:choice"),$(choice).css("left",-containerPadding.left+$(choice).outerWidth()*choiceData.column+"px"),$(choice).css("top",-containerPadding.top+$(choice).outerHeight()*choiceData.row+"px")}function randomizeChoicePositionsInSet(target,options,setContainer){setContainer=setContainer||getActiveSetContainer(target,options);for(var setData=$(setContainer).data("selectAllActivity:set"),choices=getChoicesInSet(target,options,setContainer),choice=null,choiceData=null,unpositionedChoices=[],i=0;i<choices.length;i++)choice=choices[i],(choiceData=$(choice).data("selectAllActivity:choice")).row=null,choiceData.column=null,$(choice).data("selectAllActivity:choice",choiceData),unpositionedChoices.push(choice);var choiceMatrix=[],currentRow=0,currentColumn=0,currentRowArray=null;for(currentRow=0;currentRow<setData.rows;currentRow++){for(currentRowArray=[],currentColumn=0;currentColumn<setData.columns;currentColumn++)currentRowArray.push(null);choiceMatrix.push(currentRowArray)}for(var randomSelector=null,found=!1;unpositionedChoices.length>0;){for(randomSelector=Math.floor(Math.random()*unpositionedChoices.length),choice=unpositionedChoices.splice(randomSelector,1),choiceData=$(choice).data("selectAllActivity:choice"),found=!1,currentRow=0;currentRow<setData.rows;currentRow++)for(currentColumn=0;currentColumn<setData.columns;currentColumn++)choiceMatrix[currentRow][currentColumn]||found||(found=!0,choiceMatrix[currentRow][currentColumn]=choice);choice=null}for(currentRow=0;currentRow<setData.rows;currentRow++)for(currentColumn=0;currentColumn<setData.columns;currentColumn++)choice=choiceMatrix[currentRow][currentColumn],(choiceData=$(choice).data("selectAllActivity:choice")).row=currentRow,choiceData.column=currentColumn,$(choice).data("selectAllActivity:choice",choiceData)}function registerChoiceEvents(target,options,choice){$(choice).children("."+options.containers.choices.overlay.css.identifier).bind("mouseover",function(){var options=$(target).data("selectAllActivity:options"),choiceOptions=$(choice).data("selectAllActivity:choice"),setOptions=$(choice).parent().data("selectAllActivity:set");options.data.enabled&&!setOptions.completed&&($(this).parent().hasClass(options.containers.choices.container.css.hover)||(clearChoicesHover(target,options),$(this).parent().addClass(options.containers.choices.container.css.hover),setOptions.focusedChoiceId=choiceOptions.id,setOptions.focusedChoiceRow=choiceOptions.row,setOptions.focusedChoiceColumn=choiceOptions.column,$(choice).parent().data("selectAllActivity:set",setOptions),options.accessibility.hasFocus=!0,$(target).data("selectAllActivity:options",options)))}),$(choice).children("."+options.containers.choices.overlay.css.identifier).bind("mouseout",function(){var options=$(target).data("selectAllActivity:options"),setOptions=($(choice).data("selectAllActivity:choice"),$(choice).parent().data("selectAllActivity:set"));options.data.enabled&&!setOptions.completed&&$(this).parent().hasClass(options.containers.choices.container.css.hover)&&($(this).parent().removeClass(options.containers.choices.container.css.hover),options.accessibility.hasFocus=!0,$(target).data("selectAllActivity:options",options))}),$(choice).children("."+options.containers.choices.overlay.css.identifier).bind("click",function(){var options=$(target).data("selectAllActivity:options"),setOptions=($(choice).data("selectAllActivity:choice"),$(choice).parent().data("selectAllActivity:set"));if(options.data.enabled&&!setOptions.completed){var shouldRecalculate=!1;setOptions.gradeIndividually?($(this).parent().hasClass(options.containers.choices.container.css.selected)?$(this).parent().hasClass(options.containers.choices.container.css.selected)&&setOptions.allowRetry&&$(this).parent().removeClass(options.containers.choices.container.css.selected):$(this).parent().addClass(options.containers.choices.container.css.selected),shouldRecalculate=!0):(setOptions.allowRetry||!setOptions.allowRetry&&0==setOptions.attempts)&&($(this).parent().hasClass(options.containers.choices.container.css.selected)?$(this).parent().hasClass(options.containers.choices.container.css.selected)&&$(this).parent().removeClass(options.containers.choices.container.css.selected):$(this).parent().addClass(options.containers.choices.container.css.selected),shouldRecalculate=!0),options.accessibility.hasFocus=!0,$(target).data("selectAllActivity:options",options),shouldRecalculate&&calculateActivityScore(target,options)}})}function getSetContainers(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier)||[]}function getActiveSetContainer(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier).filter("."+options.containers.set.css.selected)[0]||null}function getChoices(target,options){var activeSetContainer=getActiveSetContainer(0,options);return $(activeSetContainer).children("."+options.containers.choices.container.css.identifier)||[]}function getChoicesInSet(target,options,setContainer){return $(setContainer).children("."+options.containers.choices.container.css.identifier)||[]}function clearChoicesHover(target,options,choices){choices||(choices=getChoices(0,options));for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.hover)}function focusChoiceInSet(target,options,setContainer,id,row,column,selectChoice){log(target,options,"Focusing Choice:{id:"+id+",row:"+row+",column:"+column+"}","info");var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null;selectChoice=selectChoice||!1,clearChoicesHover(0,options,choices);for(var i=0;i<choices.length;i++)choice=choices[i],id==(choiceOptions=$(choice).data("selectAllActivity:choice")).id?($(choice).children("."+options.containers.choices.overlay.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.overlay.css.identifier).trigger("click")):row==choiceOptions.row&&column==choiceOptions.column?($(choice).children("."+options.containers.choices.overlay.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.overlay.css.identifier).trigger("click")):$(choice).children("."+options.containers.choices.overlay.css.identifier).trigger("mouseout")}function clearSelectedChoices(target,options,choices){choices=choices||getChoices(0,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.selected)}function parseXMLAndBuildActivity(target,options,data){log(target,options,"Parsing Activity XML","info");try{if(window.ActiveXObject){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.loadXML(data),data=doc}else window.DOMParser&&(data=(new DOMParser).parseFromString(data,"text/xml"))}catch(error){data=null,log(target,options,"XML Parse Error:{error:"+error+"}","error")}if(data){var activityData={allowRetry:!0,randomizeOnRetry:!0,gradeSetsIndividually:!1,dataSets:[]},dataSet=null,choice=null;$(data).children("selectAllActivity").find("allowRetry").first()&&(activityData.allowRetry="true"==$(data).children("selectAllActivity").find("allowRetry").first().text().toLowerCase()),$(data).children("selectAllActivity").attr("randomizeOnRetry")&&(activityData.randomizeOnRetry="true"==$(data).children("selectAllActivity").attr("randomizeOnRetry").toLowerCase()),$(data).children("selectAllActivity").attr("gradeSetsIndividually")&&(activityData.gradeSetsIndividually="true"==$(data).children("selectAllActivity").attr("gradeSetsIndividually").toLowerCase()),$(data).children("selectAllActivity").children("set").each(function(){dataSet={id:$(this).attr("id"),allowRetry:!1,showFeedback:!0,gradeIndividually:!1,autoComplete:!1,title:$(this).children("title:first").text(),rows:parseInt($(this).attr("rows")),columns:parseInt($(this).attr("columns")),choices:[]},$(this).children("title:first").attr("encoding")&&(dataSet.title=unescape(dataSet.title.replace(/\+/g," "))),$(this).children("choices").children("choice").each(function(){choice={id:$(this).attr("id"),content:$(this).text(),value:parseFloat($(this).attr("value")),correct:"true"==$(this).attr("correct").toLowerCase(),selectOnce:!1},$(this).attr("encoding")&&(choice.content=unescape(choice.content.replace(/\+/g," "))),$(this).attr("selectOnce")&&(choice.selectOnce="true"==$(this).attr("selectOnce").toLowerCase()),dataSet.choices.push(choice)}),activityData.dataSets.push(dataSet)}),function(target,options,activityData){var dataSet=null,choiceDimensions=null,currentChoice=(calculateContainerPadding(0,0,options.containers.choice.reference),null),choices=[],currentRow=0,currentColumn=0,choice=null,setContainer=null;if(options.data.allowRetry=activityData.allowRetry,options.data.randomizeOnRetry=activityData.randomizeOnRetry,options.data.gradeSetsIndividually=activityData.gradeSetsIndividually,options.data.overridePoints||0==options.data.overridePoints){var totalCorrectPoints=0;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.correct&&(totalCorrectPoints+=choice.value)})}),0!=totalCorrectPoints&&0!=options.data.overridePoints||(totalCorrectPoints=0,$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.correct&&(options.data.overridePoints>0?(choice.value=1,totalCorrectPoints++):choice.value=0)})}));var factor=options.data.overridePoints/totalCorrectPoints;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.value=choice.value*factor})})}for(var i=0;i<activityData.dataSets.length;i++){dataSet=$.extend({},activityData.dataSets[i],{choices:[],attempts:0,focusedChoiceId:null,focusedChoiceRow:-1,focusedChoiceColumn:-1,completed:!1}),activityData.dataSets[i].choices.length%dataSet.columns?dataSet.rows=parseInt(activityData.dataSets[i].choices.length/dataSet.columns)+1:dataSet.rows=parseInt(activityData.dataSets[i].choices.length/dataSet.columns),options.data.dataSets.push(dataSet),choiceDimensions=calculateChoiceDimensions(target,options,dataSet.rows,dataSet.columns),currentRow=0,currentColumn=0,choice=null;for(var j=0;j<activityData.dataSets[i].choices.length;j++)choice=activityData.dataSets[i].choices[j],currentChoice=createChoiceContainer(0,options,choice.content),$(currentChoice).data("selectAllActivity:choice",{id:choice.id,row:currentRow,column:currentColumn,value:choice.value,correct:choice.correct,selectOnce:choice.selectOnce}),registerChoiceEvents(target,options,currentChoice),dataSet.choices.push(currentChoice),choices.push(currentChoice),++currentColumn>=dataSet.columns&&(currentColumn=0,currentRow++);setContainer=createSetContainer(target,options),options.containers.set.references.push(setContainer),$(setContainer).data("selectAllActivity:set",dataSet),$(options.containers.choice.reference).append(setContainer);for(var j=0;j<dataSet.choices.length;j++)$(setContainer).append(dataSet.choices[j]);resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,dataSet.choices),randomizeChoicePositionsInSet(target,options,setContainer),positionChoices(target,options,dataSet.choices),alignChoices(target,options,dataSet.choices)}registerAccessibilityEvents(target,options,choices),enableDisable(target,options,choices),$(target).data("selectAllActivity:options",options),alignSets(target,options),showSet(target,options,activityData.dataSets[0].id),calculateActivityScore(target,options,!1),$(target).trigger("activityLoaded.selectAllActivity",[options.data.dataSets.length,0,options.data.allowRetry,options.data.gradeSetsIndividually])}(target,options,activityData)}else log(target,options,"XML Activity Build Error:{error:No data to build activity}","error")}function loadXMLAndBuildActivity(target,options,url){log(target,options,"Loading XML","info");var id=$(options.containers.activity.reference).parents(".softchalk-activity-wrapper").attr("id"),data=window[id.replace("-","")+"XML"];parseXMLAndBuildActivity(target,options=$(target).data("selectAllActivity:options"),data)}function alignSets(target,options,setContainers){setContainers=setContainers||getSetContainers(0,options);for(var setContainer=null,setContainerData=null,setWidth=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("selectAllActivity:set"),setWidth=$(setContainer).width(),$(setContainer).css("left",setWidth*setContainerData.id+"px")}function createSetContainer(target,options){return $("<div />").addClass(options.containers.set.css.identifier)}function showSet(target,options,id,setContainers,reset,resetPosition){setContainers=setContainers||getSetContainers(0,options),reset=reset||!1,resetPosition=resetPosition||!1;for(var setContainer=null,setContainerData=null,selectedSetContainerData=null,setPosition=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("selectAllActivity:set"),$(setContainer).removeClass(options.containers.set.css.selected),setContainerData.id==id&&(setPosition=i,selectedSetContainerData=setContainerData,setContainer,$(setContainer).addClass(options.containers.set.css.selected));var choices=getChoices(0,options);if(positionChoices(target,options,choices),alignChoices(target,options,choices),reset&&selectedSetContainerData&&(options.data.enabled=!0,enableDisable(target,options,choices),$(target).data("selectAllActivity:data",options)),resetPosition){var finalPosition=-$(options.containers.choice.reference).outerWidth()*[id];$(options.containers.choice.reference).css("left",finalPosition+"px")}$(target).trigger("titleChanged.selectAllActivity",[selectedSetContainerData.title]),$(target).trigger("setChanged.selectAllActivity",[setContainers.length,setPosition,options.data.gradeSetsIndividually,options.data.allowRetry,selectedSetContainerData.completed,options.data.enabled])}function getSetState(target,options,setContainer){for(var setContainerData=$(setContainer).data("selectAllActivity:set"),setState={id:setContainerData.id,allowRetry:setContainerData.allowRetry,showFeedback:setContainerData.showFeedback,gradeIndividually:setContainerData.gradeIndividually,attempts:setContainerData.attempts,completed:setContainerData.completed,choices:[]},setChoices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,normalizedChoiceData=null,i=0;i<setChoices.length;i++)choice=setChoices[i],normalizedChoiceData={id:(choiceOptions=$(choice).data("selectAllActivity:choice")).id,row:choiceOptions.row,column:choiceOptions.column,correct:choiceOptions.correct,value:choiceOptions.value,selected:$(choice).hasClass(options.containers.choices.container.css.selected),finished:$(choice).hasClass(options.containers.choices.container.css.correct)||$(choice).hasClass(options.containers.choices.container.css.incorrect)||!1},setState.choices.push(normalizedChoiceData);return setState}function setSetState(target,options,setContainer,setState){log(target,options,"Setting Set State:"+setState.id);var setContainerData=$(setContainer).data("selectAllActivity:set");setContainerData.allowRetry=setState.allowRetry,setContainerData.showFeedback=setState.showFeedback,setContainerData.gradeIndividually=setState.gradeIndividually,setContainerData.attempts=setState.attempts,setContainerData.completed=setState.completed,$(setContainer).data("selectAllActivity:set",setContainerData),setContainerData.completed&&!$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).addClass(options.containers.set.css.completed);for(var setChoices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,normalizedChoiceData=null,i=0;i<setChoices.length;i++){choice=setChoices[i],choiceOptions=$(choice).data("selectAllActivity:choice");for(var j=0;j<setState.choices.length;j++)(normalizedChoiceData=setState.choices[j]).id==choiceOptions.id&&(choiceOptions.row=normalizedChoiceData.row,choiceOptions.column=normalizedChoiceData.column,choiceOptions.correct=normalizedChoiceData.correct,choiceOptions.value=normalizedChoiceData.value,$(choice).removeClass(options.containers.choices.container.css.selected),normalizedChoiceData.selected&&$(choice).addClass(options.containers.choices.container.css.selected),normalizedChoiceData.finished&&(normalizedChoiceData.correct?$(choice).addClass(options.containers.choices.container.css.correct):$(choice).addClass(options.containers.choices.container.css.incorrect)));$(choice).data("selectAllActivity:choice",choiceOptions)}}function calculateActivityScore(target,options,incrementAttempts,autoCompleteOverride,doNotUpdateExternalScore){incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1,doNotUpdateExternalScore=doNotUpdateExternalScore||!1;for(var choiceSets=getSetContainers(0,options),activeSet=getActiveSetContainer(0,options),activeSetPosition=0,setScore=null,calculatedScore=0,calculatedPossible=0,totalCorrect=0,totalIncorrect=0,correctSelected=0,incorrectSelected=0,i=0;i<choiceSets.length;i++)$(choiceSets[i]).data("selectAllActivity:set"),choiceSets[i]==activeSet&&(activeSetPosition=i),calculatedScore+=(setScore=options.data.gradeSetsIndividually&&choiceSets[i]==activeSet?calculateSetScore(target,options,choiceSets[i],incrementAttempts,autoCompleteOverride):options.data.gradeSetsIndividually&&choiceSets[i]!=activeSet?calculateSetScore(target,options,choiceSets[i],!1,!1):calculateSetScore(target,options,choiceSets[i],incrementAttempts,autoCompleteOverride)).calculatedScore,calculatedPossible+=setScore.calculatedPossible,totalCorrect+=setScore.totalCorrect,totalIncorrect+=setScore.totalIncorrect,correctSelected+=setScore.correctSelected,incorrectSelected+=setScore.incorrectSelected,$(target).trigger("setScoreChanged.selectAllActivity",[options.data.dataSets.length,i,options.data.allowRetry,options.data.gradeSetsIndividually,setScore.calculatedScore,setScore.calculatedPossible,$(choiceSets[i]).data("selectAllActivity:set").completed,doNotUpdateExternalScore]);return log(target,options,"Score Recalculated:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityScoreChanged.selectAllActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,$(activeSet).data("selectAllActivity:set").completed,doNotUpdateExternalScore]),!options.data.gradeSetsIndividually&&autoCompleteOverride&&(options.data.enabled=!1,$(target).data("selectAllActivity:options",options),enableDisable(target,options),log(target,options,"Activity Completed:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityComplete.selectAllActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore])),{calculatedScore:calculatedScore,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}}function calculateSetScore(target,options,setContainer,incrementAttempts,autoCompleteOverride){setContainer=setContainer||getActiveSetContainer(0,options),incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1;var setData=$(setContainer).data("selectAllActivity:set"),setState=getSetState(0,options,setContainer),scoreResults=options.data.calculateScore(setState);return setData.gradeIndividually?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!0):setData.autoComplete&&scoreResults.totalCorrect==scoreResults.correctSelected||1==autoCompleteOverride?(setData.completed=!0,$(setContainer).hasClass(options.containers.set.css.completed)||$(setContainer).addClass(options.containers.set.css.completed),setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1),incrementAttempts&&setData.attempts++):(clearCorrectAndIncorrectInSet(target,options,setContainer),setData.completed?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1):scoreResults.calculatedScore=0),$(setContainer).data("selectAllActivity:set",setData),scoreResults}function showCorrectAndIncorrect(target,options,setContainer,showOnlySelected){if(setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,options.data.enabled)for(var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,showChoice=!1,i=0;i<choices.length;i++)choice=choices[i],choiceOptions=$(choice).data("selectAllActivity:choice"),showChoice=!1,showOnlySelected&&$(choice).hasClass(options.containers.choices.container.css.selected)?showChoice=!0:showOnlySelected||(showChoice=!0),showChoice?choiceOptions.correct?($(choice).removeClass(options.containers.choices.container.css.incorrect),$(choice).hasClass(options.containers.choices.container.css.correct)||$(choice).addClass(options.containers.choices.container.css.correct)):($(choice).removeClass(options.containers.choices.container.css.correct),$(choice).hasClass(options.containers.choices.container.css.incorrect)||$(choice).addClass(options.containers.choices.container.css.incorrect)):($(choice).removeClass(options.containers.choices.container.css.correct),$(choice).removeClass(options.containers.choices.container.css.incorrect))}function clearCorrectAndIncorrectInSet(target,options,setContainer,showOnlySelected){setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,choices=getChoicesInSet(0,options,setContainer);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.incorrect),$(choice).removeClass(options.containers.choices.container.css.correct)}function alignChoices(target,options,choices){if(choices=choices||getChoices(0,options))for(var choice=null,choiceContent=null,i=0;i<choices.length;i++)choice=choices[i],choiceContent=$(choice).children("."+options.containers.choices.content.css.identifier+":first"),alignToParent(target,options,options.containers.choices.content.horizontalAlign,options.containers.choices.content.verticalAlign,choiceContent)}function alignToParent(target,options,horizontalAlign,verticalAlign,container){if($(container).css("position","absolute"),horizontalAlign)switch(horizontalAlign.toLowerCase()){case"left":$(container).css("right",null).css("left","0px");break;case"right":$(container).css("left",null).css("right","0px");break;case"center":$(container).css("right",null).css("left",$(container).parent().innerWidth()/2-$(container).outerWidth()/2+"px")}if(verticalAlign)switch(verticalAlign.toLowerCase()){case"top":$(container).css("bottom",null).css("top","0px");break;case"bottom":$(container).css("top",null).css("bottom","0px");break;case"middle":$(container).css("bottom",null).css("top",$(container).parent().innerHeight()/2-$(container).outerHeight()/2+"px")}}return this},$.fn.selectAllActivity.defaults={},$.fn.selectAllActivity.defaults.containers={activity:{reference:null,css:{identifier:"softchalk-select-all-activity"}},content:{reference:null,css:{identifier:"softchalk-select-all-activity-content",enabled:"enabled",disabled:"disabled"}},choice:{reference:null,css:{identifier:"softchalk-select-all-activity-sets",animating:"animating"}},set:{references:[],css:{identifier:"softchalk-select-all-activity-set",selected:"selected",completed:"completed"}},choices:{references:[],container:{css:{identifier:"softchalk-select-all-activity-choice",selected:"selected",correct:"correct",incorrect:"incorrect",hover:"hover"}},content:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-select-all-activity-choice-content"}},feedback:{css:{identifier:"softchalk-select-all-activity-choice-feedback"}},feedbackIcon:{horizontalAlign:"right",verticalAlign:"middle",css:{identifier:"softchalk-select-all-activity-choice-feedback-icon"}},overlay:{css:{identifier:"softchalk-select-all-activity-choice-overlay"}}}},$.fn.selectAllActivity.defaults.data={dataSets:[],completed:!1,calculateScore:function(setState){for(var calculatedCorrect=0,calculatedIncorrect=0,calculatedPossible=0,choiceData=null,correctSelected=0,incorrectSelected=0,totalCorrect=0,totalIncorrect=0,i=0;i<setState.choices.length;i++)(choiceData=setState.choices[i]).correct?(calculatedPossible+=choiceData.value,totalCorrect++):totalIncorrect++,choiceData.selected&&choiceData.correct?(calculatedCorrect+=choiceData.value,correctSelected++):choiceData.selected&&!choiceData.correct&&(calculatedIncorrect+=choiceData.value,incorrectSelected++);return{calculatedScore:Math.max(0,calculatedCorrect-calculatedIncorrect),calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}},enabled:!0,enableLogging:!1,allowRetry:!0,randomizeOnRetry:!0,animate:!0,gradeSetsIndividually:!1,overridePoints:null},$.fn.selectAllActivity.defaults.accessibility={pseudoMouse:{allow:!1,mice:[]},keyboard:{allow:!0},hasFocus:!1},$.fn.selectAllActivity.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery),function($){$.fn.slideIdentificationActivity=function(action,options){var shouldReturnResults=!1,results=[],params=null;"object"==typeof(action=action||"initialize")&&(options=action,action="initialize"),"initialize"==action?options=options?$.extend(!0,{},$.fn.slideIdentificationActivity.defaults,options):$.fn.slideIdentificationActivity.defaults:params=options;var optionsReference=options;if($(this).each(function(){switch(action){case"initialize":log(this,optionsReference,"Action:Initializing Activity","info"),function(target,options){(options=$.extend(!0,{},options)).containers.activity.reference=target,$(options.containers.activity.reference).addClass(options.containers.activity.css.identifier),options.containers.content.reference=target,$(options.containers.content.reference).addClass(options.containers.content.css.identifier),null==options.containers.choice.reference&&(options.containers.choice.reference=$("<div />"),$(options.containers.content.reference).append(options.containers.choice.reference));options.containers.choice.reference.addClass(options.containers.choice.css.identifier),$(target).data("slideIdentificationActivity:options",options)}(this,optionsReference);break;case"loadXMLAndBuildActivity":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Loading XML","info"),function(target,options,url){log(target,options,"Loading XML","info");var id=$(options.containers.activity.reference).parents(".softchalk-activity-wrapper").attr("id"),data=window[id.replace("-","")+"XML"],options=$(target).data("slideIdentificationActivity:options");parseXMLAndBuildActivity(target,options,data)}(this,options);break;case"parseXMLAndBuildActivity":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Parsing XML","info"),parseXMLAndBuildActivity(this,options,params);break;case"calculateScore":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Calculating Score","info"),calculateScore(this,options);break;case"finish":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Finishing Activity","info"),calculateActivityScore(this,options,!0,!0);break;case"reset":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Resetting Activity","info"),function(target,options){if(options.data.allowRetry){log(target,options,"Resetting Activity","info");var setContainers=getSetContainers(target,options),activeSet=getActiveSetContainer(target,options),activeSetPosition=0,setContainer=null,setContainerData=null,choices=null,setScore=null;options.data.enabled=!0;for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideIdentificationActivity:set"),setContainer==activeSet&&(activeSetPosition=i),(options.data.gradeSetsIndividually&&setContainer==activeSet||!options.data.gradeSetsIndividually)&&(setContainerData.attempts=0,setContainerData.completed=!1,setContainerData.focusedChoiceId=null,setContainerData.focusedChoiceRow=-1,setContainerData.focusedChoiceColumn=-1,$(setContainer).data("slideIdentificationActivity:set",setContainerData),choices=getChoicesInSet(target,options,setContainer),clearChoicesHover(target,options,choices),clearCorrectAndIncorrectInSet(target,options,setContainer),clearSelectedChoices(target,options,choices),setScore=calculateSetScore(target,options,setContainer),setScore.calculatedScore,setScore.calculatedPossible,options.data.randomizeOnRetry&&(randomizeChoicePositionsInSet(target,options,setContainer),positionChoices(target,options,choices)),$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).removeClass(options.containers.set.css.completed));enableDisable(target,options);var setPosition=$(activeSet).data("slideIdentificationActivity:set").id;!options.data.gradeSetsIndividually&&options.data.randomizeOnRetry&&(setPosition=Math.floor(Math.random()*setContainers.length)),setContainer=setContainers[setPosition],setContainerData=$(setContainer).data("slideIdentificationActivity:set"),showSet(target,options,setContainerData.id,setContainers,!1,!0),activeSet=getActiveSetContainer(target,options);for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideIdentificationActivity:set"),setContainer==activeSet&&(activeSetPosition=i);$(target).data("slideIdentificationActivity:options",options),$(target).trigger("reset.slideIdentificationActivity",[setContainers.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually]),calculateActivityScore(target,options,!1)}}(this,options);break;case"showNextSet":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Showing Next Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i<setContainers.length-1){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i+1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i+1]).data("slideIdentificationActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"showPreviousSet":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Showing Previous Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i>0){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i-1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i-1]).data("slideIdentificationActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"getState":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Getting Activity State","info"),shouldReturnResults=!0,results.push({target:this,result:function(target,options){for(var activityState={enabled:options.data.enabled,allowRetry:options.data.allowRetry,randomizeOnRetry:options.data.randomizeOnRetry,activeSetId:function(target,options){return $(getActiveSetContainer(target,options)).data("slideIdentificationActivity:set").id||null}(target,options),sets:[]},setContainers=getSetContainers(target,options),i=0;i<setContainers.length;i++)activityState.sets.push(getSetState(target,options,setContainers[i]));return activityState}(this,options)});break;case"setState":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Setting Activity State","info"),function(target,options,activityState,completed){log(target,options,"Setting Activity State");var setData=null,setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,choices=null;showSet(target,options,activityState.activeSetId,!1,!0);for(var i=0;i<activityState.sets.length;i++){setData=activityState.sets[i];for(var j=0;j<setContainers.length;j++)setContainer=setContainers[j],setContainerData=$(setContainer).data("slideIdentificationActivity:set"),choices=getChoicesInSet(target,options,setContainer),setData.id==setContainerData.id&&setSetState(target,options,setContainer,setData),positionChoices(target,options,choices)}options.data.enabled=activityState.enabled,options.data.allowRetry=activityState.allowRetry,options.data.randomizeOnRetry=activityState.randomizeOnRetry,$(target).data("slideIdentificationActivity:options",options),enableDisable(target,options),calculateActivityScore(target,options,!1,completed,!0)}(this,options,params.state,params.completed);break;case"getEnabled":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Getting Enabled","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.enabled});break;case"setEnabled":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Setting Enabled","info"),options.data.enabled=params,$(this).data("slideIdentificationActivity:options",options),enableDisable(this,options);break;case"getSetIds":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Getting Set Ids","info");for(var setContainers=getSetContainers(this,options),setContainer=null,setContainerData=null,setIds=[],i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideIdentificationActivity:set"),setIds.push(setContainerData.id);shouldReturnResults=!0,results.push({target:this,result:setIds});break;case"getNumberOfSets":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Getting number of sets","info"),shouldReturnResults=!0,results.push({target:this,result:getSetContainers(this,options).length});break;case"showSet":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Getting number of sets","info"),showSet(this,options,params);break;case"getAllowReset":log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Getting allow reset","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.allowRetry});break;case"resize":var options;log(this,options=$(this).data("slideIdentificationActivity:options"),"Action:Resizing the activity","info"),function(target,options){alignSets(target,options);for(var setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,choices=null,choiceDimensions=null,i=(calculateContainerPadding(target,options,options.containers.choice.reference),0);i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideIdentificationActivity:set"),choices=getChoicesInSet(target,options,setContainer),choiceDimensions=calculateChoiceDimensions(target,options,setContainerData.rows,setContainerData.columns),resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,choices),positionChoices(target,options,choices),alignChoices(target,options,choices),alignSetImage(target,options,setContainer);log(target,options,"Activity Container Resized","info")}(this,options)}}),1==shouldReturnResults)return results;function log(target,options,data,level){level=level||"debug",level=$.trim(level).toLowerCase(),options.data.enableLogging&&window.console&&("info"==level&&window.console.info&&options.logging.info?$(target).attr("id")?window.console.info("[slideIdentificationActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.info("[slideIdentificationActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.info("[slideIdentificationActivity]["+target+"]"+data):"warn"==level&&window.console.warn&&options.logging.warn?$(target).attr("id")?window.console.warn("[slideIdentificationActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.warn("[slideIdentificationActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.warn("[slideIdentificationActivity]["+target+"]"+data):"error"==level&&window.console.error&&options.logging.error?$(target).attr("id")?window.console.error("[slideIdentificationActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.error("[slideIdentificationActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.error("[slideIdentificationActivity]["+target+"]"+data):window.console.log&&options.logging.debug&&($(target).attr("id")?window.console.log("[slideIdentificationActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.log("[slideIdentificationActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.log("[slideIdentificationActivity]["+target+"]"+data)))}function registerAccessibilityEvents(target,options,choices){var handleMiceEvents=function(event){var options=$(this).data("slideIdentificationActivity:options");if(options.data.enabled&&event.pageX&&event.pageY){var offset=$(this).offset(),width=$(this).outerWidth(),height=$(this).outerHeight();!options.accessibility.hasFocus&&event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height?(options.accessibility.hasFocus=!0,$(this).data("slideIdentificationActivity:options",options)):options.accessibility.hasFocus&&(event.pageX<offset.left||event.pageX>offset.left+width||event.pageY<offset.top||event.pageY>offset.top+height)&&(options.accessibility.hasFocus=!1,$(this).data("slideIdentificationActivity:options",options))}};$(target).bind("mouseover",handleMiceEvents).bind("mouseout",handleMiceEvents).bind("mousemove",handleMiceEvents),$(target).bind("focusin",function(event){var options=$(this).data("slideIdentificationActivity:options");if(options.data.enabled&&!options.accessibility.hasFocus){log(target,options,"Giving Focus","info"),options.accessibility.hasFocus=!0,$(this).data("slideIdentificationActivity:options",options);var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("slideIdentificationActivity:set");(activeSetData.focusedChoiceRow<0||activeSetData.focusedChoiceColumn<0||!activeSetData.focusedChoiceId)&&focusChoiceInSet(target,options,activeSet,null,0,0,!1)}}),$(target).bind("focusout",function(event){var options=$(this).data("slideIdentificationActivity:options");options.data.enabled&&options.accessibility.hasFocus&&(options.accessibility.hasFocus=!1,$(this).data("slideIdentificationActivity:options",options))}),options.accessibility.keyboard.allow&&function(target,options,choices){$(document).keydown(function(event){var options=$(target).data("slideIdentificationActivity:options");if(options.data.enabled&&options.accessibility.keyboard.allow&&options.accessibility.hasFocus){var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("slideIdentificationActivity:set");switch(event.keyCode){case 38:activeSetData.focusedChoiceRow-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow-1,activeSetData.focusedChoiceColumn);break;case 40:activeSetData.focusedChoiceRow+1<activeSetData.rows&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow+1,activeSetData.focusedChoiceColumn);break;case 37:activeSetData.focusedChoiceColumn-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn-1);break;case 39:activeSetData.focusedChoiceColumn+1<activeSetData.columns&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn+1);break;case 32:focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn,!0);break;case 13:calculateActivityScore(target,options)}}})}(target),options.accessibility.pseudoMouse.allow&&function(target,options,choices){for(var pseudoMice=options.accessibility.pseudoMouse.mice,mouse=null,offset=null,width=null,height=null,container=null,found=!1,i=0;i<pseudoMice.length;i++)mouse=pseudoMice[i],$(mouse).bind("mousemove",function(event){var options=$(target).data("slideIdentificationActivity:options");if(options.data.enabled){var event2=new $.Event("mousemove");event2.pageX=event.pageX,event2.pageY=event.pageY,$(target).trigger(event2)}if((options=$(target).data("slideIdentificationActivity:options")).data.enabled&&options.accessibility.hasFocus)for(var activeSet=getActiveSetContainer(target,options),choices=getChoicesInSet(target,options,activeSet),j=0;j<choices.length;j++)found=!1,container=$(choices[j]).children("."+options.containers.choices.downarrow.css.identifier).first(),offset=$(container).offset(),$(container).hasClass(options.containers.choices.container.css.hover)?(event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&(found=!0)),found||$(container).trigger("mouseout")):event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&$(container).trigger("mouseover"))}),$(mouse).bind("mouseup",function(event){var options=$(target).data("slideIdentificationActivity:options");if(options.data.enabled&&options.accessibility.hasFocus){container=null;for(var j=0;j<choices.length;j++)container=$(choices[j]).children("."+options.containers.choices.downarrow.css.identifier).first(),offset=$(container).offset(),width=$(container).width(),height=$(container).height(),event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height&&$(container).trigger("click")}})}(target,options,choices)}function calculateChoiceDimensions(target,options,rows,columns){var containerWidth=$(options.containers.choice.reference).width(),borderTestDiv=($(options.containers.choice.reference).height(),$("<div />").css("display","none").addClass(options.containers.choices.container.css.identifier).width(100).height(100));$(target).append(borderTestDiv);var borderWidthOffset=($(borderTestDiv).outerWidth()-$(borderTestDiv).innerWidth())/2,borderHeightOffset=($(borderTestDiv).outerHeight()-$(borderTestDiv).innerHeight())/2;$(borderTestDiv).remove();return{width:containerWidth-=borderWidthOffset+2,height:50}}function calculateContainerPadding(target,options,container){var paddingTestDiv=$('<div style="padding:0px 0px 0px 0px;"/>');paddingTestDiv.css("padding-top",$(container).css("padding-top"));var paddingTop=$(paddingTestDiv).height();paddingTestDiv.css("padding-top","0px"),paddingTestDiv.css("padding-right",$(container).css("padding-right"));var paddingRight=$(paddingTestDiv).width();paddingTestDiv.css("padding-right","0px"),paddingTestDiv.css("padding-bottom",$(container).css("padding-bottom"));var paddingBottom=$(paddingTestDiv).height();paddingTestDiv.css("padding-bottom","0px"),paddingTestDiv.css("padding-left",$(container).css("padding-left"));var paddingLeft=$(paddingTestDiv).width();return paddingTestDiv.css("padding-left","0px"),{top:paddingTop,right:paddingRight,bottom:paddingBottom,left:paddingLeft}}function createImageContainer(target,options,contentHtml,imageAlignDelay){var imageContainer=$("<div />").addClass(options.containers.image.container.css.identifier);if(contentHtml){var image=$("<div />").addClass(options.containers.image.image.css.identifier);options.data.overrideImages&&-1!=contentHtml.indexOf("<img")&&(contentHtml="<span class='"+options.containers.image.noImage.css.identifier+"'>Image not available</span>"),$(image).html(contentHtml),$(imageContainer).append(image),setTimeout(function(){alignSetImage(target,options,$(image).parent().parent())},imageAlignDelay)}return imageContainer}function createChoiceContainer(target,options,contentHtml){var choice=$("<div />").addClass(options.containers.choices.container.css.identifier).css("position","absolute"),contentDiv=$("<div />").addClass(options.containers.choices.content.css.identifier);$(choice).append(contentDiv);var feedbackDiv=$("<div />").addClass(options.containers.choices.feedback.css.identifier);$(choice).append(feedbackDiv);var feedbackIconDiv=$("<div />").addClass(options.containers.choices.feedbackIcon.css.identifier);$(choice).append(feedbackIconDiv);var overlayDiv=$("<div />").addClass(options.containers.choices.overlay.css.identifier);$(choice).append(overlayDiv);var leftButtonDiv=$("<div />").addClass(options.containers.choices.leftButton.container.css.identifier);$(choice).append(leftButtonDiv);var leftButton=$("<div />").addClass(options.containers.choices.leftButton.button.css.identifier);$(leftButtonDiv).append(leftButton);var rightButtonDiv=$("<div />").addClass(options.containers.choices.rightButton.container.css.identifier);$(choice).append(rightButtonDiv);var rightButton=$("<div />").addClass(options.containers.choices.rightButton.button.css.identifier);return $(rightButtonDiv).append(rightButton),contentHtml&&$(contentDiv).html(contentHtml),choice}function enableDisable(target,options,choices){log(target,options,"Enabling/Disabling Activity:"+options.data.enabled,"info"),choices=choices||getChoices(target,options),options.data.enabled?($(options.containers.content.reference).removeClass(options.containers.content.css.disabled),$(options.containers.content.reference).addClass(options.containers.content.css.enabled),$(target).trigger("enabled.slideIdentificationActivity",[options.data.dataSets.length])):($(options.containers.content.reference).removeClass(options.containers.content.css.enabled),$(options.containers.content.reference).addClass(options.containers.content.css.disabled),clearChoicesHover(target,options,choices),$(target).trigger("disabled.slideIdentificationActivity",[options.data.dataSets.length]))}function resizeChoices(target,options,width,height,choices){choices=choices||getChoices(target,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).width(width),$(choice).height(height)}function positionChoices(target,options,choices,containerPadding){choices=choices||getChoices(target,options),containerPadding=containerPadding||calculateContainerPadding(0,0,options.containers.choice.reference);for(var choiceData=null,choice=null,i=0;i<choices.length;i++)choice=choices[i],choiceData=$(choice).data("slideIdentificationActivity:choice"),$(choice).css("left",-containerPadding.left+$(choice).outerWidth()*(choiceData.column-1)+"px"),$(choice).css("top",$(options.containers.choice.reference).height()-$(choice).outerHeight()+"px")}function randomizeChoicePositionsInSet(target,options,setContainer){setContainer=setContainer||getActiveSetContainer(target,options);for(var setData=$(setContainer).data("slideIdentificationActivity:set"),choices=getChoicesInSet(target,options,setContainer),choice=null,choiceData=null,unpositionedChoices=[],i=0;i<choices.length;i++)choice=choices[i],(choiceData=$(choice).data("slideIdentificationActivity:choice")).column=null,$(choice).data("slideIdentificationActivity:choice",choiceData),unpositionedChoices.push(choice);var choiceMatrix=[],currentRow=0,currentColumn=0,currentRowArray=null;for(currentRow=0;currentRow<setData.rows;currentRow++){for(currentRowArray=[],currentColumn=0;currentColumn<setData.columns;currentColumn++)currentRowArray.push(null);choiceMatrix.push(currentRowArray)}for(var randomSelector=null,found=!1;unpositionedChoices.length>0;){for(randomSelector=Math.floor(Math.random()*unpositionedChoices.length),choice=unpositionedChoices.splice(randomSelector,1),choiceData=$(choice).data("slideIdentificationActivity:choice"),found=!1,currentRow=0,currentColumn=0;currentColumn<setData.columns;currentColumn++)choiceMatrix[currentRow][currentColumn]||found||(found=!0,choiceMatrix[currentRow][currentColumn]=choice);choice=null}for(currentRow=0;currentRow<setData.rows;currentRow++)for(currentColumn=0;currentColumn<setData.columns;currentColumn++)choice=choiceMatrix[currentRow][currentColumn],(choiceData=$(choice).data("slideIdentificationActivity:choice")).column=currentColumn,$(choice).data("slideIdentificationActivity:choice",choiceData)}function registerChoiceEvents(target,options,choice){$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("mouseover",function(){var options=$(target).data("slideIdentificationActivity:options"),choiceOptions=$(choice).data("slideIdentificationActivity:choice"),setOptions=$(choice).parent().data("slideIdentificationActivity:set");options.data.enabled&&!setOptions.completed&&($(this).hasClass(options.containers.choices.rightButton.container.css.hover)||(clearChoicesHover(target,options),$(this).addClass(options.containers.choices.rightButton.container.css.hover),setOptions.focusedChoiceId=choiceOptions.id,setOptions.focusedChoiceRow=choiceOptions.row,setOptions.focusedChoiceColumn=choiceOptions.column,$(choice).parent().data("slideIdentificationActivity:set",setOptions),options.accessibility.hasFocus=!0,$(target).data("slideIdentificationActivity:options",options)))}),$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("mouseout",function(){var options=$(target).data("slideIdentificationActivity:options"),setOptions=($(choice).data("slideIdentificationActivity:choice"),$(choice).parent().data("slideIdentificationActivity:set"));options.data.enabled&&!setOptions.completed&&$(this).hasClass(options.containers.choices.rightButton.container.css.hover)&&($(this).removeClass(options.containers.choices.rightButton.container.css.hover),options.accessibility.hasFocus=!0,$(target).data("slideIdentificationActivity:options",options))}),$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("click",function(event){var options=$(target).data("slideIdentificationActivity:options"),setOptions=($(choice).data("slideIdentificationActivity:choice"),$(choice).parent().data("slideIdentificationActivity:set"));if(options.data.enabled&&!setOptions.completed&&!$(choice).hasClass(options.containers.choices.container.css.animating)){var shouldRecalculate=!1;shiftRow(target,options,null,$(this).parent(),1),setOptions.gradeIndividually?shouldRecalculate=!0:(setOptions.allowRetry||!setOptions.allowRetry&&0==setOptions.attempts)&&(shouldRecalculate=!0),options.accessibility.hasFocus=!0,$(target).data("slideIdentificationActivity:options",options),shouldRecalculate&&calculateActivityScore(target,options)}}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("mouseover",function(){var options=$(target).data("slideIdentificationActivity:options"),choiceOptions=$(choice).data("slideIdentificationActivity:choice"),setOptions=$(choice).parent().data("slideIdentificationActivity:set");options.data.enabled&&!setOptions.completed&&($(this).hasClass(options.containers.choices.leftButton.container.css.hover)||(clearChoicesHover(target,options),$(this).addClass(options.containers.choices.leftButton.container.css.hover),setOptions.focusedChoiceId=choiceOptions.id,setOptions.focusedChoiceRow=choiceOptions.row,setOptions.focusedChoiceColumn=choiceOptions.column,$(choice).parent().data("slideIdentificationActivity:set",setOptions),options.accessibility.hasFocus=!0,$(target).data("slideIdentificationActivity:options",options)))}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("mouseout",function(){var options=$(target).data("slideIdentificationActivity:options"),setOptions=($(choice).data("slideIdentificationActivity:choice"),$(choice).parent().data("slideIdentificationActivity:set"));options.data.enabled&&!setOptions.completed&&$(this).hasClass(options.containers.choices.leftButton.container.css.hover)&&($(this).removeClass(options.containers.choices.leftButton.container.css.hover),options.accessibility.hasFocus=!0,$(target).data("slideIdentificationActivity:options",options))}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("click",function(event){var options=$(target).data("slideIdentificationActivity:options"),setOptions=($(choice).data("slideIdentificationActivity:choice"),$(choice).parent().data("slideIdentificationActivity:set"));if(options.data.enabled&&!setOptions.completed&&!$(choice).hasClass(options.containers.choices.container.css.animating)){var shouldRecalculate=!1;shiftRow(target,options,null,$(this).parent(),-1),setOptions.gradeIndividually?shouldRecalculate=!0:(setOptions.allowRetry||!setOptions.allowRetry&&0==setOptions.attempts)&&(shouldRecalculate=!0),options.accessibility.hasFocus=!0,$(target).data("slideIdentificationActivity:options",options),shouldRecalculate&&calculateActivityScore(target,options)}})}function shiftRow(target,options,setContainer,choice,columnDelta,wrapAround){log(target,options,choice,"info"),setContainer=setContainer||getActiveSetContainer(target,options),columnDelta=columnDelta||0,wrapAround=wrapAround||!0;var containerPadding=calculateContainerPadding(0,0,options.containers.choice.reference),choiceOptions=$(choice).data("slideIdentificationActivity:choice"),setOptions=$(setContainer).data("slideIdentificationActivity:set"),allChoicesInSet=getChoicesInSet(target,options,setContainer),workingChoice=null,workingChoiceData=null;if(options.data.animate)for(var i=0;i<allChoicesInSet.length;i++)workingChoice=allChoicesInSet[i],(workingChoiceData=$(workingChoice).data("slideIdentificationActivity:choice")).row==choiceOptions.row&&(workingChoiceData.column,$(workingChoice).css("left",-containerPadding.left+$(workingChoice).outerWidth()*(workingChoiceData.column-1)),workingChoiceData.column+=columnDelta,$(workingChoice).data("slideIdentificationActivity:choice",workingChoiceData),$(workingChoice).addClass(options.containers.choices.container.css.animating),2==setOptions.columns&&columnDelta<0&&(workingChoiceData.column<0?workingChoiceData.column+=setOptions.columns:workingChoiceData.column>=setOptions.columns&&(workingChoiceData.column-=setOptions.columns),$(workingChoice).css("left",-containerPadding.left+$(workingChoice).outerWidth()*workingChoiceData.column)),$(workingChoice).animate({left:-containerPadding.left+$(workingChoice).outerWidth()*(workingChoiceData.column-1)},"slow",null,function(){var reference=this;setTimeout(function(){$(reference).removeClass(options.containers.choices.container.css.animating);var data=$(reference).data("slideIdentificationActivity:choice");data.column<0?data.column+=setOptions.columns:data.column>=setOptions.columns&&(data.column-=setOptions.columns),$(reference).data("slideIdentificationActivity:choice",data),$(reference).css("left",-containerPadding.left+$(reference).outerWidth()*(data.column-1))},50)}));else{for(i=0;i<allChoicesInSet.length;i++)workingChoice=allChoicesInSet[i],(workingChoiceData=$(workingChoice).data("slideIdentificationActivity:choice")).row==choiceOptions.row&&(workingChoiceData.column+=columnDelta,workingChoiceData.column<0?workingChoiceData.column+=setOptions.columns:workingChoiceData.column>=setOptions.columns&&(workingChoiceData.column-=setOptions.columns),$(workingChoice).data("slideIdentificationActivity:choice",workingChoiceData));positionChoices(target,options)}}function getSetContainers(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier)||[]}function getActiveSetContainer(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier).filter("."+options.containers.set.css.selected)[0]||null}function getChoices(target,options){var activeSetContainer=getActiveSetContainer(0,options);return $(activeSetContainer).children("."+options.containers.choices.container.css.identifier)||[]}function getChoicesInSet(target,options,setContainer){return $(setContainer).children("."+options.containers.choices.container.css.identifier)||[]}function clearChoicesHover(target,options,choices){choices||(choices=getChoices(0,options));for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.hover)}function focusChoiceInSet(target,options,setContainer,id,row,column,selectChoice){log(target,options,"Focusing Choice:{id:"+id+",row:"+row+",column:"+column+"}","info");var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null;selectChoice=selectChoice||!1,clearChoicesHover(0,options,choices);for(var i=0;i<choices.length;i++)choice=choices[i],id==(choiceOptions=$(choice).data("slideIdentificationActivity:choice")).id?($(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("click")):row==choiceOptions.row&&column==choiceOptions.column?($(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("click")):$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseout")}function clearSelectedChoices(target,options,choices){choices=choices||getChoices(0,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.selected)}function parseXMLAndBuildActivity(target,options,data){log(target,options,"Parsing Activity XML","info");try{if(window.ActiveXObject){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.loadXML(data),data=doc}else window.DOMParser&&(data=(new DOMParser).parseFromString(data,"text/xml"))}catch(error){data=null,log(target,options,"XML Parse Error:{error:"+error+"}","error")}if(data){var activityData={allowRetry:!0,randomizeOnRetry:!0,gradeSetsIndividually:!1,dataSets:[]},dataSet=null,choice=null;$(data).children("slideIdentificationActivity").find("allowRetry").first()&&(activityData.allowRetry="true"==$(data).children("slideIdentificationActivity").find("allowRetry").first().text().toLowerCase()),$(data).children("slideIdentificationActivity").attr("randomizeOnRetry")&&(activityData.randomizeOnRetry="true"==$(data).children("slideIdentificationActivity").attr("randomizeOnRetry").toLowerCase()),$(data).children("slideIdentificationActivity").attr("gradeSetsIndividually")&&(activityData.gradeSetsIndividually="true"==$(data).children("slideIdentificationActivity").attr("gradeSetsIndividually").toLowerCase()),$(data).children("slideIdentificationActivity").children("set").each(function(){dataSet={id:$(this).attr("id"),allowRetry:!1,showFeedback:!0,gradeIndividually:!1,autoComplete:!1,title:$(this).children("title:first").text(),image:$(this).children("image:first").text(),allowImageScale:!0,imageAlignDelay:50,rows:parseInt($(this).attr("rows")),columns:parseInt($(this).attr("columns")),choices:[]},$(this).children("title:first").attr("encoding")&&(dataSet.title=unescape(dataSet.title.replace(/\+/g," "))),$(this).children("image:first").attr("encoding")&&(dataSet.image=unescape(dataSet.image.replace(/\+/g," "))),"false"==$(this).children("image:first").attr("allowScale")&&(dataSet.allowImageScale=!1),$(this).children("image:first").attr("imageAlignDelay")&&(dataSet.imageAlignDelay=parseInt($(this).children("image:first").attr("imageAlignDelay"))),$(this).children("choices").children("choice").each(function(){choice={id:$(this).attr("id"),content:$(this).text(),value:parseFloat($(this).attr("value")),correct:"true"==$(this).attr("correct").toLowerCase(),row:parseFloat($(this).attr("row")),selectOnce:!1},$(this).attr("encoding")&&(choice.content=unescape(choice.content.replace(/\+/g," "))),$(this).attr("selectOnce")&&(choice.selectOnce="true"==$(this).attr("selectOnce").toLowerCase()),dataSet.choices.push(choice)}),activityData.dataSets.push(dataSet)}),function(target,options,activityData){var dataSet=null,choiceDimensions=null,currentChoice=(calculateContainerPadding(0,0,options.containers.choice.reference),null),choices=[],currentColumn=0,choice=null,setContainer=null;if(options.data.allowRetry=activityData.allowRetry,options.data.randomizeOnRetry=activityData.randomizeOnRetry,options.data.gradeSetsIndividually=activityData.gradeSetsIndividually,options.data.overridePoints||0==options.data.overridePoints){var totalCorrectPoints=0;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.correct&&(totalCorrectPoints+=choice.value)})}),0!=totalCorrectPoints&&0!=options.data.overridePoints||(totalCorrectPoints=0,$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.correct&&(options.data.overridePoints>0?(choice.value=1,totalCorrectPoints++):choice.value=0)})}));var factor=options.data.overridePoints/totalCorrectPoints;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.value=choice.value*factor})})}for(var i=0;i<activityData.dataSets.length;i++){dataSet=$.extend({},activityData.dataSets[i],{choices:[],attempts:0,focusedChoiceId:null,focusedChoiceRow:-1,focusedChoiceColumn:-1,completed:!1}),activityData.dataSets[i].choices.length%dataSet.columns?dataSet.rows=parseInt(activityData.dataSets[i].choices.length/dataSet.columns)+1:dataSet.rows=parseInt(activityData.dataSets[i].choices.length/dataSet.columns),options.data.dataSets.push(dataSet),choiceDimensions=calculateChoiceDimensions(target,options,dataSet.rows,dataSet.columns),0,currentColumn=0,choice=null;for(var j=0;j<activityData.dataSets[i].choices.length;j++)choice=activityData.dataSets[i].choices[j],currentChoice=createChoiceContainer(0,options,choice.content),$(currentChoice).data("slideIdentificationActivity:choice",{id:choice.id,row:0,column:currentColumn,value:choice.value,correct:choice.correct,selectOnce:choice.selectOnce}),registerChoiceEvents(target,options,currentChoice),dataSet.choices.push(currentChoice),choices.push(currentChoice),++currentColumn>=dataSet.columns&&(currentColumn=0,0);setContainer=createSetContainer(target,options),options.containers.set.references.push(setContainer),$(setContainer).data("slideIdentificationActivity:set",dataSet),imageContainer=createImageContainer(target,options,dataSet.image,dataSet.imageAlignDelay),$(setContainer).append(imageContainer),$(options.containers.choice.reference).append(setContainer);for(var j=0;j<dataSet.choices.length;j++)$(setContainer).append(dataSet.choices[j]);resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,dataSet.choices),randomizeChoicePositionsInSet(target,options,setContainer),positionChoices(target,options,dataSet.choices),alignChoices(target,options,dataSet.choices)}registerAccessibilityEvents(target,options,choices),enableDisable(target,options,choices),$(target).data("slideIdentificationActivity:options",options),alignSets(target,options),showSet(target,options,activityData.dataSets[0].id),calculateActivityScore(target,options,!1),$(target).trigger("activityLoaded.slideIdentificationActivity",[options.data.dataSets.length,0,options.data.allowRetry,options.data.gradeSetsIndividually])}(target,options,activityData)}else log(target,options,"XML Activity Build Error:{error:No data to build activity}","error")}function createSetContainer(target,options){return $("<div />").addClass(options.containers.set.css.identifier)}function showSet(target,options,id,setContainers,reset,resetPosition){setContainers=setContainers||getSetContainers(0,options),reset=reset||!1,resetPosition=resetPosition||!1;for(var setContainer=null,setContainerData=null,selectedSetContainerData=null,setPosition=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideIdentificationActivity:set"),$(setContainer).removeClass(options.containers.set.css.selected),setContainerData.id==id&&(setPosition=i,selectedSetContainerData=setContainerData,setContainer,$(setContainer).addClass(options.containers.set.css.selected));var choices=getChoices(0,options);if(positionChoices(target,options,choices),alignChoices(target,options,choices),reset&&selectedSetContainerData&&(options.data.enabled=!0,enableDisable(target,options,choices),$(target).data("slideIdentificationActivity:data",options)),resetPosition){var finalPosition=-$(options.containers.choice.reference).outerWidth()*[id];$(options.containers.choice.reference).css("left",finalPosition+"px")}$(target).trigger("titleChanged.slideIdentificationActivity",[selectedSetContainerData.title]),$(target).trigger("setChanged.slideIdentificationActivity",[setContainers.length,setPosition,options.data.gradeSetsIndividually,options.data.allowRetry,selectedSetContainerData.completed,options.data.enabled])}function getSetState(target,options,setContainer){for(var setContainerData=$(setContainer).data("slideIdentificationActivity:set"),setState={id:setContainerData.id,allowRetry:setContainerData.allowRetry,showFeedback:setContainerData.showFeedback,gradeIndividually:setContainerData.gradeIndividually,attempts:setContainerData.attempts,completed:setContainerData.completed,rows:setContainerData.rows,choices:[]},setChoices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,normalizedChoiceData=null,i=0;i<setChoices.length;i++)choice=setChoices[i],normalizedChoiceData={id:(choiceOptions=$(choice).data("slideIdentificationActivity:choice")).id,row:choiceOptions.row,column:choiceOptions.column,correct:choiceOptions.correct,value:choiceOptions.value,selected:$(choice).hasClass(options.containers.choices.container.css.selected),finished:$(choice).hasClass(options.containers.choices.container.css.correct)||$(choice).hasClass(options.containers.choices.container.css.incorrect)||!1},setState.choices.push(normalizedChoiceData);return setState}function setSetState(target,options,setContainer,setState){log(target,options,"Setting Set State:"+setState.id);var setContainerData=$(setContainer).data("slideIdentificationActivity:set");setContainerData.allowRetry=setState.allowRetry,setContainerData.showFeedback=setState.showFeedback,setContainerData.gradeIndividually=setState.gradeIndividually,setContainerData.attempts=setState.attempts,setContainerData.completed=setState.completed,$(setContainer).data("slideIdentificationActivity:set",setContainerData),setContainerData.completed&&!$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).addClass(options.containers.set.css.completed);for(var setChoices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,normalizedChoiceData=null,i=0;i<setChoices.length;i++){choice=setChoices[i],choiceOptions=$(choice).data("slideIdentificationActivity:choice");for(var j=0;j<setState.choices.length;j++)(normalizedChoiceData=setState.choices[j]).id==choiceOptions.id&&(choiceOptions.row=normalizedChoiceData.row,choiceOptions.column=normalizedChoiceData.column,choiceOptions.correct=normalizedChoiceData.correct,choiceOptions.value=normalizedChoiceData.value,$(choice).removeClass(options.containers.choices.container.css.selected),normalizedChoiceData.selected&&$(choice).addClass(options.containers.choices.container.css.selected),normalizedChoiceData.finished&&(normalizedChoiceData.correct?$(choice).addClass(options.containers.choices.container.css.correct):$(choice).addClass(options.containers.choices.container.css.incorrect)));$(choice).data("slideIdentificationActivity:choice",choiceOptions)}}function calculateActivityScore(target,options,incrementAttempts,autoCompleteOverride,doNotUpdateExternalScore){incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1,doNotUpdateExternalScore=doNotUpdateExternalScore||!1;for(var choiceSets=getSetContainers(0,options),activeSet=getActiveSetContainer(0,options),activeSetPosition=0,setScore=null,calculatedScore=0,calculatedPossible=0,totalCorrect=0,totalIncorrect=0,correctSelected=0,incorrectSelected=0,i=0;i<choiceSets.length;i++)choiceSets[i]==activeSet&&(activeSetPosition=i),calculatedScore+=(setScore=options.data.gradeSetsIndividually&&choiceSets[i]==activeSet?calculateSetScore(target,options,choiceSets[i],incrementAttempts,autoCompleteOverride):options.data.gradeSetsIndividually&&choiceSets[i]!=activeSet?calculateSetScore(target,options,choiceSets[i],!1,!1):calculateSetScore(target,options,choiceSets[i],incrementAttempts,autoCompleteOverride)).calculatedScore,calculatedPossible+=setScore.calculatedPossible,totalCorrect+=setScore.totalCorrect,totalIncorrect+=setScore.totalIncorrect,correctSelected+=setScore.correctSelected,incorrectSelected+=setScore.incorrectSelected,$(target).trigger("setScoreChanged.slideIdentificationActivity",[options.data.dataSets.length,i,options.data.allowRetry,options.data.gradeSetsIndividually,setScore.calculatedScore,setScore.calculatedPossible,$(choiceSets[i]).data("slideIdentificationActivity:set").completed,doNotUpdateExternalScore]);return log(target,options,"Score Recalculated:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityScoreChanged.slideIdentificationActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,$(activeSet).data("slideIdentificationActivity:set").completed,doNotUpdateExternalScore]),!options.data.gradeSetsIndividually&&autoCompleteOverride&&(options.data.enabled=!1,$(target).data("slideIdentificationActivity:options",options),enableDisable(target,options),log(target,options,"Activity Completed:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityComplete.slideIdentificationActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore])),{calculatedScore:calculatedScore,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}}function calculateSetScore(target,options,setContainer,incrementAttempts,autoCompleteOverride){setContainer=setContainer||getActiveSetContainer(0,options),incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1;var setData=$(setContainer).data("slideIdentificationActivity:set"),setState=getSetState(0,options,setContainer),scoreResults=options.data.calculateScore(setState);return setData.gradeIndividually?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!0):setData.autoComplete&&scoreResults.totalCorrect==scoreResults.correctSelected||1==autoCompleteOverride?(setData.completed=!0,$(setContainer).hasClass(options.containers.set.css.completed)||$(setContainer).addClass(options.containers.set.css.completed),setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1),incrementAttempts&&setData.attempts++):(clearCorrectAndIncorrectInSet(target,options,setContainer),setData.completed?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1):scoreResults.calculatedScore=0),$(setContainer).data("slideIdentificationActivity:set",setData),scoreResults}function showCorrectAndIncorrect(target,options,setContainer,showOnlySelected){if(setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,options.data.enabled)for(var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,i=0;i<choices.length;i++)choice=choices[i],choiceOptions=$(choice).data("slideIdentificationActivity:choice"),!0?choiceOptions.correct?($(choice).removeClass(options.containers.choices.container.css.incorrect),$(choice).hasClass(options.containers.choices.container.css.correct)||$(choice).addClass(options.containers.choices.container.css.correct)):($(choice).removeClass(options.containers.choices.container.css.correct),$(choice).hasClass(options.containers.choices.container.css.incorrect)||$(choice).addClass(options.containers.choices.container.css.incorrect)):($(choice).removeClass(options.containers.choices.container.css.correct),$(choice).removeClass(options.containers.choices.container.css.incorrect))}function clearCorrectAndIncorrectInSet(target,options,setContainer,showOnlySelected){setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,choices=getChoicesInSet(0,options,setContainer);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.incorrect),$(choice).removeClass(options.containers.choices.container.css.correct)}function alignSetImage(target,options,setContainer){setContainer=setContainer||getActiveSetContainer(0,options);var setContainerData=$(setContainer).data("slideIdentificationActivity:set"),imageContainer=$(setContainer).find("."+options.containers.image.container.css.identifier).first(),image=$(imageContainer).find("."+options.containers.image.image.css.identifier).first();setContainerData.allowImageScale&&$(image).transform({scale:[1,1]});var choiceContainer=$(setContainer).find("."+options.containers.choices.container.css.identifier).first(),setHeight=($(setContainer).width(),$(setContainer).height()-$(choiceContainer).outerHeight());if($(imageContainer).height(setHeight),setContainerData.allowImageScale){var imageContainerWidth=$(imageContainer).width(),imageContainerHeight=$(imageContainer).height(),imageWidth=$(image).outerWidth(),imageHeight=$(image).outerHeight(),imageNewWidth=null,imageNewHeight=null;$(image).outerWidth()>imageContainerWidth&&(imageNewWidth=imageContainerWidth),$(image).outerHeight()>imageContainerHeight&&(imageNewHeight=imageContainerHeight);var scale=1;if(imageNewWidth||imageNewHeight)if(imageNewWidth&&!imageNewHeight)scale=imageNewWidth/imageWidth;else scale=imageNewHeight&&!imageNewWidth?imageNewHeight/imageHeight:Math.min(imageNewWidth/imageWidth,imageNewHeight/imageHeight);$(image).transform({scale:[scale,scale]})}alignToParent(target,options,options.containers.image.image.horizontalAlign,options.containers.image.image.verticalAlign,image)}function alignChoices(target,options,choices){if(choices=choices||getChoices(0,options))for(var choice=null,choiceContent=null,leftContent=null,rightContent=null,feedbackIconContent=null,i=0;i<choices.length;i++)choice=choices[i],choiceContent=$(choice).children("."+options.containers.choices.content.css.identifier+":first"),leftContent=$(choice).find("."+options.containers.choices.leftButton.button.css.identifier+":first"),rightContent=$(choice).find("."+options.containers.choices.rightButton.button.css.identifier+":first"),feedbackIconContent=$(choice).find("."+options.containers.choices.feedbackIcon.css.identifier+":first"),alignToParent(target,options,options.containers.choices.content.horizontalAlign,options.containers.choices.content.verticalAlign,choiceContent),alignToParent(target,options,"left","middle",leftContent),alignToParent(target,options,"right","middle",rightContent),alignToParent(target,options,options.containers.choices.feedbackIcon.horizontalAlign,options.containers.choices.feedbackIcon.verticalAlign,feedbackIconContent)}function alignSets(target,options,setContainers){setContainers=setContainers||getSetContainers(0,options);for(var setContainer=null,setContainerData=null,setWidth=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideIdentificationActivity:set"),setWidth=$(setContainer).width(),$(setContainer).css("left",setWidth*setContainerData.id+"px")}function alignToParent(target,options,horizontalAlign,verticalAlign,container){if($(container).css("position","absolute"),horizontalAlign)switch(horizontalAlign.toLowerCase()){case"left":$(container).css("right",null).css("left","0px");break;case"right":$(container).css("left",null).css("right","0px");break;case"center":$(container).css("right",null).css("left",$(container).parent().innerWidth()/2-$(container).outerWidth()/2+"px")}if(verticalAlign)switch(verticalAlign.toLowerCase()){case"top":$(container).css("bottom",null).css("top","0px");break;case"bottom":$(container).css("top",null).css("bottom","0px");break;case"middle":$(container).css("bottom",null).css("top",$(container).parent().innerHeight()/2-$(container).outerHeight()/2+"px")}}return this},$.fn.slideIdentificationActivity.defaults={},$.fn.slideIdentificationActivity.defaults.containers={activity:{reference:null,css:{identifier:"softchalk-slide-identification-activity"}},content:{reference:null,css:{identifier:"softchalk-slide-identification-activity-content",enabled:"enabled",disabled:"disabled"}},choice:{reference:null,css:{identifier:"softchalk-slide-identification-activity-sets",animating:"animating"}},set:{references:[],css:{identifier:"softchalk-slide-identification-activity-set",selected:"selected",completed:"completed"}},choices:{references:[],container:{css:{identifier:"softchalk-slide-identification-activity-choice",selected:"selected",correct:"correct",incorrect:"incorrect",hover:"hover",animating:"animating"}},content:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-slide-identification-activity-choice-content"}},leftButton:{container:{css:{identifier:"softchalk-slide-identification-activity-choice-left-button-container",hover:"hover"}},button:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-slide-identification-activity-choice-left-button",hover:"hover"}}},rightButton:{container:{css:{identifier:"softchalk-slide-identification-activity-choice-right-button-container",hover:"hover"}},button:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-slide-identification-activity-choice-right-button",hover:"hover"}}},feedback:{css:{identifier:"softchalk-slide-identification-activity-choice-feedback"}},feedbackIcon:{horizontalAlign:"right",verticalAlign:"middle",css:{identifier:"softchalk-slide-identification-activity-choice-feedback-icon"}},overlay:{css:{identifier:"softchalk-slide-identification-activity-choice-overlay"}}},image:{container:{references:null,css:{identifier:"softchalk-slide-identification-activity-image-container"}},image:{references:null,horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-slide-identification-activity-image"}},noImage:{css:{identifier:"softchalk-slide-identification-activity-no-image"}}}},$.fn.slideIdentificationActivity.defaults.data={dataSets:[],calculateScore:function(setState){for(var calculatedCorrect=0,calculatedIncorrect=0,calculatedPossible=0,choiceData=null,correctSelected=0,incorrectSelected=0,totalCorrect=0,totalIncorrect=0,i=0;i<setState.choices.length;i++)1==(choiceData=setState.choices[i]).correct?(totalCorrect++,calculatedPossible+=choiceData.value):totalIncorrect++,1==choiceData.column&&(1==choiceData.correct?(calculatedCorrect+=choiceData.value,correctSelected++):(calculatedIncorrect+=choiceData.value,incorrectSelected++));Math.max(0,calculatedCorrect-calculatedIncorrect);return{calculatedScore:calculatedCorrect,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}},enabled:!0,enableLogging:!1,allowRetry:!0,randomizeOnRetry:!0,animate:!0,gradeSetsIndividually:!1,overridePoints:null,overrideImages:!1},$.fn.slideIdentificationActivity.defaults.accessibility={pseudoMouse:{allow:!0,mice:[]},keyboard:{allow:!0},hasFocus:!1},$.fn.slideIdentificationActivity.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery),function($){$.fn.slideShowActivity=function(action,options){var shouldReturnResults=!1,results=[],params=null;"object"==typeof(action=action||"initialize")&&(options=action,action="initialize"),"initialize"==action?options=options?$.extend(!0,{},$.fn.slideShowActivity.defaults,options):$.fn.slideShowActivity.defaults:params=options;var optionsReference=options;if($(this).each(function(){switch(action){case"initialize":log(this,optionsReference,"Action:Initializing Activity","info"),function(target,options){(options=$.extend(!0,{},options)).containers.activity.reference=target,$(options.containers.activity.reference).addClass(options.containers.activity.css.identifier),options.containers.content.reference=target,$(options.containers.content.reference).addClass(options.containers.content.css.identifier),null==options.containers.choice.reference&&(options.containers.choice.reference=$("<div />"),$(options.containers.content.reference).append(options.containers.choice.reference));options.containers.choice.reference.addClass(options.containers.choice.css.identifier),$(target).data("slideShowActivity:options",options)}(this,optionsReference);break;case"loadXMLAndBuildActivity":log(this,options=$(this).data("slideShowActivity:options"),"Action:Loading XML","info"),function(target,options,url){log(target,options,"Loading XML","info");var id=$(options.containers.activity.reference).parents(".softchalk-activity-wrapper").attr("id"),data=window[id.replace("-","")+"XML"],options=$(target).data("slideShowActivity:options");parseXMLAndBuildActivity(target,options,data)}(this,options);break;case"parseXMLAndBuildActivity":log(this,options=$(this).data("slideShowActivity:options"),"Action:Parsing XML","info"),parseXMLAndBuildActivity(this,options,params);break;case"showNextSet":log(this,options=$(this).data("slideShowActivity:options"),"Action:Showing Next Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i<setContainers.length-1){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i+1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i+1]).data("slideShowActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"showPreviousSet":log(this,options=$(this).data("slideShowActivity:options"),"Action:Showing Previous Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i>0){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i-1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i-1]).data("slideShowActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"getState":log(this,options=$(this).data("slideShowActivity:options"),"Action:Getting Activity State","info"),shouldReturnResults=!0,results.push({target:this,result:function(target,options){for(var activityState={enabled:options.data.enabled,allowRetry:options.data.allowRetry,randomizeOnRetry:options.data.randomizeOnRetry,activeSetId:function(target,options){return $(getActiveSetContainer(target,options)).data("slideShowActivity:set").id||null}(target,options),sets:[]},setContainers=getSetContainers(target,options),i=0;i<setContainers.length;i++)activityState.sets.push(getSetState(target,options,setContainers[i]));return activityState}(this,options)});break;case"setState":log(this,options=$(this).data("slideShowActivity:options"),"Action:Setting Activity State","info"),function(target,options,activityState){log(target,options,"Setting Activity State");var setData=null,setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null;showSet(target,options,activityState.activeSetId,!1,!0);for(var i=0;i<activityState.sets.length;i++){setData=activityState.sets[i];for(var j=0;j<setContainers.length;j++)setContainer=setContainers[j],setContainerData=$(setContainer).data("slideShowActivity:set"),getChoicesInSet(target,options,setContainer),setData.id==setContainerData.id&&setSetState(target,options,setContainer,setData)}options.data.enabled=activityState.enabled,options.data.allowRetry=activityState.allowRetry,options.data.randomizeOnRetry=activityState.randomizeOnRetry,$(target).data("slideShowActivity:options",options),enableDisable(target,options)}(this,options,params.state);break;case"getEnabled":log(this,options=$(this).data("slideShowActivity:options"),"Action:Getting Enabled","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.enabled});break;case"setEnabled":log(this,options=$(this).data("slideShowActivity:options"),"Action:Setting Enabled","info"),options.data.enabled=params,$(this).data("slideShowActivity:options",options),enableDisable(this,options);break;case"getSetIds":log(this,options=$(this).data("slideShowActivity:options"),"Action:Getting Set Ids","info");for(var setContainers=getSetContainers(this,options),setContainer=null,setContainerData=null,setIds=[],i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideShowActivity:set"),setIds.push(setContainerData.id);shouldReturnResults=!0,results.push({target:this,result:setIds});break;case"getNumberOfSets":log(this,options=$(this).data("slideShowActivity:options"),"Action:Getting number of sets","info"),shouldReturnResults=!0,results.push({target:this,result:getSetContainers(this,options).length});break;case"showSet":log(this,options=$(this).data("slideShowActivity:options"),"Action:Getting number of sets","info"),showSet(this,options,params);break;case"toggleSetContent":log(this,options=$(this).data("slideShowActivity:options"),"Action:Toggling Set Content","info"),function(target,options,setContainer){setContainer=setContainer||getActiveSetContainer(target,options);var setContainerData=$(setContainer).data("slideShowActivity:set"),setContentContainer=$(setContainer).find("."+options.containers.more.container.css.identifier).first();$(setContentContainer).hasClass(options.containers.more.container.css.animating)||(setContainerData.contentShown?(setContainerData.contentShown=!1,options.data.animate?($(setContentContainer).stop(!0,!1),$(setContentContainer).addClass(options.containers.more.container.css.animating),$(setContentContainer).animate({top:"100%"},"slow",null,function(){var reference=this;setTimeout(function(){$(reference).removeClass(options.containers.more.container.css.animating)},50)})):$(setContentContainer).css("top","100%"),$(target).trigger("contentHidden.slideShowActivity")):(setContainerData.contentShown=!0,options.data.animate?($(setContentContainer).stop(!0,!1),$(setContentContainer).addClass(options.containers.more.container.css.animating),$(setContentContainer).animate({top:"50%"},"slow",null,function(){var reference=this;setTimeout(function(){$(reference).removeClass(options.containers.more.container.css.animating)},50)})):$(setContentContainer).css("top","50%"),$(target).trigger("contentShown.slideShowActivity")))}(this,options);break;case"resize":var options;log(this,options=$(this).data("slideShowActivity:options"),"Action:Resizing the activity","info"),function(target,options){alignSets(target,options);for(var setContainers=getSetContainers(target,options),setContainer=null,i=(calculateContainerPadding(target,options,options.containers.choice.reference),0);i<setContainers.length;i++)setContainer=setContainers[i],$(setContainer).data("slideShowActivity:set"),alignSetImage(target,options,setContainer);log(target,options,"Activity Container Resized","info")}(this,options)}}),1==shouldReturnResults)return results;function log(target,options,data,level){level=level||"debug",level=$.trim(level).toLowerCase(),options.data.enableLogging&&window.console&&("info"==level&&window.console.info&&options.logging.info?$(target).attr("id")?window.console.info("[slideShowActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.info("[slideShowActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.info("[slideShowActivity]["+target+"]"+data):"warn"==level&&window.console.warn&&options.logging.warn?$(target).attr("id")?window.console.warn("[slideShowActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.warn("[slideShowActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.warn("[slideShowActivity]["+target+"]"+data):"error"==level&&window.console.error&&options.logging.error?$(target).attr("id")?window.console.error("[slideShowActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.error("[slideShowActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.error("[slideShowActivity]["+target+"]"+data):window.console.log&&options.logging.debug&&($(target).attr("id")?window.console.log("[slideShowActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.log("[slideShowActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.log("[slideShowActivity]["+target+"]"+data)))}function registerAccessibilityEvents(target,options,choices){var handleMiceEvents=function(event){var options=$(this).data("slideShowActivity:options");if(options.data.enabled&&event.pageX&&event.pageY){var offset=$(this).offset(),width=$(this).outerWidth(),height=$(this).outerHeight();!options.accessibility.hasFocus&&event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height?(options.accessibility.hasFocus=!0,$(this).data("slideShowActivity:options",options)):options.accessibility.hasFocus&&(event.pageX<offset.left||event.pageX>offset.left+width||event.pageY<offset.top||event.pageY>offset.top+height)&&(options.accessibility.hasFocus=!1,$(this).data("slideShowActivity:options",options))}};$(target).bind("mouseover",handleMiceEvents).bind("mouseout",handleMiceEvents).bind("mousemove",handleMiceEvents),$(target).bind("focusin",function(event){var options=$(this).data("slideShowActivity:options");if(options.data.enabled&&!options.accessibility.hasFocus){log(target,options,"Giving Focus","info"),options.accessibility.hasFocus=!0,$(this).data("slideShowActivity:options",options);var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("slideShowActivity:set");(activeSetData.focusedChoiceRow<0||activeSetData.focusedChoiceColumn<0||!activeSetData.focusedChoiceId)&&focusChoiceInSet(target,options,activeSet,null,0,0,!1)}}),$(target).bind("focusout",function(event){var options=$(this).data("slideShowActivity:options");options.data.enabled&&options.accessibility.hasFocus&&(options.accessibility.hasFocus=!1,$(this).data("slideShowActivity:options",options))}),options.accessibility.keyboard.allow&&function(target,options,choices){$(document).keydown(function(event){var options=$(target).data("slideShowActivity:options");if(options.data.enabled&&options.accessibility.keyboard.allow&&options.accessibility.hasFocus){var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("slideShowActivity:set");switch(event.keyCode){case 38:activeSetData.focusedChoiceRow-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow-1,activeSetData.focusedChoiceColumn);break;case 40:activeSetData.focusedChoiceRow+1<activeSetData.rows&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow+1,activeSetData.focusedChoiceColumn);break;case 37:activeSetData.focusedChoiceColumn-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn-1);break;case 39:activeSetData.focusedChoiceColumn+1<activeSetData.columns&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn+1);break;case 32:focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn,!0)}}})}(target),options.accessibility.pseudoMouse.allow&&function(target,options,choices){for(var pseudoMice=options.accessibility.pseudoMouse.mice,mouse=null,offset=null,width=null,height=null,container=null,found=!1,i=0;i<pseudoMice.length;i++)mouse=pseudoMice[i],$(mouse).bind("mousemove",function(event){var options=$(target).data("slideShowActivity:options");if(options.data.enabled){var event2=new $.Event("mousemove");event2.pageX=event.pageX,event2.pageY=event.pageY,$(target).trigger(event2)}if((options=$(target).data("slideShowActivity:options")).data.enabled&&options.accessibility.hasFocus)for(var activeSet=getActiveSetContainer(target,options),choices=getChoicesInSet(target,options,activeSet),j=0;j<choices.length;j++)found=!1,container=$(choices[j]).children("."+options.containers.choices.downarrow.css.identifier).first(),offset=$(container).offset(),$(container).hasClass(options.containers.choices.container.css.hover)?(event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&(found=!0)),found||$(container).trigger("mouseout")):event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&$(container).trigger("mouseover"))}),$(mouse).bind("mouseup",function(event){var options=$(target).data("slideShowActivity:options");if(options.data.enabled&&options.accessibility.hasFocus){container=null;for(var j=0;j<choices.length;j++)container=$(choices[j]).children("."+options.containers.choices.downarrow.css.identifier).first(),offset=$(container).offset(),width=$(container).width(),height=$(container).height(),event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height&&$(container).trigger("click")}})}(target,options,choices)}function calculateChoiceDimensions(target,options,rows,columns){var containerWidth=$(options.containers.choice.reference).width(),borderTestDiv=($(options.containers.choice.reference).height(),$("<div />").css("display","none").addClass(options.containers.more.container.css.identifier).width(100).height(100));$(target).append(borderTestDiv);var borderWidthOffset=($(borderTestDiv).outerWidth()-$(borderTestDiv).innerWidth())/2,borderHeightOffset=($(borderTestDiv).outerHeight()-$(borderTestDiv).innerHeight())/2;$(borderTestDiv).remove();return{width:(containerWidth-=borderWidthOffset*(2*columns))+20,height:50}}function calculateContainerPadding(target,options,container){var paddingTestDiv=$('<div style="padding:0px 0px 0px 0px;"/>');paddingTestDiv.css("padding-top",$(container).css("padding-top"));var paddingTop=$(paddingTestDiv).height();paddingTestDiv.css("padding-top","0px"),paddingTestDiv.css("padding-right",$(container).css("padding-right"));var paddingRight=$(paddingTestDiv).width();paddingTestDiv.css("padding-right","0px"),paddingTestDiv.css("padding-bottom",$(container).css("padding-bottom"));var paddingBottom=$(paddingTestDiv).height();paddingTestDiv.css("padding-bottom","0px"),paddingTestDiv.css("padding-left",$(container).css("padding-left"));var paddingLeft=$(paddingTestDiv).width();return paddingTestDiv.css("padding-left","0px"),{top:paddingTop,right:paddingRight,bottom:paddingBottom,left:paddingLeft}}function createImageContainer(target,options,contentHtml,imageAlignDelay){var imageContainer=$("<div />").addClass(options.containers.image.container.css.identifier);if(contentHtml){var image=$("<div />").addClass(options.containers.image.image.css.identifier);$(image).html(contentHtml),$(imageContainer).append(image),setTimeout(function(){alignSetImage(target,options,$(image).parent().parent())},imageAlignDelay)}return imageContainer}function createChoiceContainer(target,options,contentHtml){var choice=$("<div />").addClass(options.containers.more.container.css.identifier).css("position","absolute"),backgroundDiv=$("<div />").addClass(options.containers.more.background.css.identifier);$(choice).append(backgroundDiv);var contentDiv=$("<div />").addClass(options.containers.more.content.css.identifier);return $(choice).append(contentDiv),contentHtml&&$(contentDiv).html(contentHtml),choice}function enableDisable(target,options,choices){log(target,options,"Enabling/Disabling Activity:"+options.data.enabled,"info"),choices=choices||getChoices(target,options),options.data.enabled?($(options.containers.content.reference).removeClass(options.containers.content.css.disabled),$(options.containers.content.reference).addClass(options.containers.content.css.enabled),$(target).trigger("enabled.slideShowActivity",[options.data.dataSets.length])):($(options.containers.content.reference).removeClass(options.containers.content.css.enabled),$(options.containers.content.reference).addClass(options.containers.content.css.disabled),clearChoicesHover(target,options,choices),$(target).trigger("disabled.slideShowActivity",[options.data.dataSets.length]))}function resizeChoices(target,options,width,height,choices){choices=choices||getChoices(target,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).width(width),$(choice).height(height)}function getSetContainers(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier)||[]}function getActiveSetContainer(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier).filter("."+options.containers.set.css.selected)[0]||null}function getChoices(target,options){var activeSetContainer=getActiveSetContainer(0,options);return $(activeSetContainer).children("."+options.containers.more.container.css.identifier)||[]}function getChoicesInSet(target,options,setContainer){return $(setContainer).children("."+options.containers.choices.container.css.identifier)||[]}function clearChoicesHover(target,options,choices){choices||(choices=getChoices(0,options));for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.hover)}function focusChoiceInSet(target,options,setContainer,id,row,column,selectChoice){log(target,options,"Focusing Choice:{id:"+id+",row:"+row+",column:"+column+"}","info");var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null;selectChoice=selectChoice||!1,clearChoicesHover(0,options,choices);for(var i=0;i<choices.length;i++)choice=choices[i],id==(choiceOptions=$(choice).data("slideShowActivity:choice")).id?($(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("click")):row==choiceOptions.row&&column==choiceOptions.column?($(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("click")):$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseout")}function parseXMLAndBuildActivity(target,options,data){log(target,options,"Parsing Activity XML","info");try{if(window.ActiveXObject){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.loadXML(data),data=doc}else window.DOMParser&&(data=(new DOMParser).parseFromString(data,"text/xml"))}catch(error){data=null,log(target,options,"XML Parse Error:{error:"+error+"}","error")}if(data){var activityData={dataSets:[]},dataSet=null;$(data).children("slideShowActivity").find("allowRetry").first()&&(activityData.allowRetry="true"==$(data).children("slideShowActivity").find("allowRetry").first().text().toLowerCase()),$(data).children("slideShowActivity").attr("randomizeOnRetry")&&(activityData.randomizeOnRetry="true"==$(data).children("slideShowActivity").attr("randomizeOnRetry").toLowerCase()),$(data).children("slideShowActivity").children("set").each(function(){dataSet={id:$(this).attr("id"),title:$(this).children("title:first").text(),image:$(this).children("image:first").text(),allowImageScale:!0,imageAlignDelay:50,content:[],rows:1,columns:1},$(this).children("title:first").attr("encoding")&&(dataSet.title=unescape(dataSet.title.replace(/\+/g," "))),$(this).children("image:first").attr("encoding")&&(dataSet.image=unescape(dataSet.image.replace(/\+/g," "))),"false"==$(this).children("image:first").attr("allowScale")&&(dataSet.allowImageScale=!1),$(this).children("image:first").attr("imageAlignDelay")&&(dataSet.imageAlignDelay=parseInt($(this).children("image:first").attr("imageAlignDelay"))),$(this).children("content").each(function(){var text=$(this).text();$(this).attr("encoding")&&(text=unescape(text.replace(/\+/g," "))),dataSet.content.push(text)}),activityData.dataSets.push(dataSet)}),function(target,options,activityData){for(var dataSet=null,choiceDimensions=null,choices=(calculateContainerPadding(0,0,options.containers.choice.reference),[]),setContainer=null,imageContainer=null,choiceContainer=null,i=0;i<activityData.dataSets.length;i++)dataSet=$.extend({},activityData.dataSets[i],{choices:[],attempts:0,focusedChoiceId:null,focusedChoiceRow:-1,focusedChoiceColumn:-1,contentShown:!1}),options.data.dataSets.push(dataSet),choiceDimensions=calculateChoiceDimensions(target,options,dataSet.rows,dataSet.columns),0,0,null,setContainer=createSetContainer(target,options),options.containers.set.references.push(setContainer),$(setContainer).data("slideShowActivity:set",dataSet),imageContainer=createImageContainer(target,options,dataSet.image,dataSet.imageAlignDelay),$(setContainer).append(imageContainer),choiceContainer=createChoiceContainer(0,options,dataSet.content[0]),$(setContainer).append(choiceContainer),$(options.containers.choice.reference).append(setContainer),resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,dataSet.choices);registerAccessibilityEvents(target,options,choices),enableDisable(target,options,choices),$(target).data("slideShowActivity:options",options),alignSets(target,options),showSet(target,options,activityData.dataSets[0].id),$(target).trigger("activityLoaded.slideIdentificationActivity",[options.data.dataSets.length,0])}(target,options,activityData)}else log(target,options,"XML Activity Build Error:{error:No data to build activity}","error")}function createSetContainer(target,options){return $("<div />").addClass(options.containers.set.css.identifier)}function showSet(target,options,id,setContainers,reset,resetPosition){setContainers=setContainers||getSetContainers(0,options),reset=reset||!1,resetPosition=resetPosition||!1;for(var setContainer=null,setContainerData=null,selectedSetContainerData=null,setPosition=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideShowActivity:set"),$(setContainer).removeClass(options.containers.set.css.selected),setContainerData.id==id&&(setPosition=i,selectedSetContainerData=setContainerData,setContainer,$(setContainer).addClass(options.containers.set.css.selected));var choices=getChoices(0,options);if(reset&&selectedSetContainerData&&(options.data.enabled=!0,enableDisable(target,options,choices),$(target).data("slideShowActivity:data",options)),resetPosition){var finalPosition=-$(options.containers.choice.reference).outerWidth()*[id];$(options.containers.choice.reference).css("left",finalPosition+"px")}$(target).trigger("titleChanged.slideShowActivity",[selectedSetContainerData.title]),$(target).trigger("setChanged.slideShowActivity",[setContainers.length,setPosition,selectedSetContainerData.content.length,selectedSetContainerData.contentShown,options.data.enabled])}function getSetState(target,options,setContainer){var setContainerData=$(setContainer).data("slideShowActivity:set");return{id:setContainerData.id,allowRetry:setContainerData.allowRetry,showFeedback:setContainerData.showFeedback,gradeIndividually:setContainerData.gradeIndividually,attempts:setContainerData.attempts,rows:setContainerData.rows}}function setSetState(target,options,setContainer,setState){log(target,options,"Setting Set State:"+setState.id);var setContainerData=$(setContainer).data("slideShowActivity:set");setContainerData.allowRetry=setState.allowRetry,setContainerData.showFeedback=setState.showFeedback,setContainerData.gradeIndividually=setState.gradeIndividually,setContainerData.attempts=setState.attempts,$(setContainer).data("slideShowActivity:set",setContainerData)}function alignSetImage(target,options,setContainer){setContainer=setContainer||getActiveSetContainer(0,options);var setContainerData=$(setContainer).data("slideShowActivity:set"),imageContainer=$(setContainer).find("."+options.containers.image.container.css.identifier).first(),image=$(imageContainer).find("."+options.containers.image.image.css.identifier).first();setContainerData.allowImageScale&&$(image).transform({scale:[1,1]});$(setContainer).width();var setHeight=$(setContainer).height();if($(imageContainer).height(setHeight),setContainerData.allowImageScale){var imageContainerWidth=$(imageContainer).width(),imageContainerHeight=$(imageContainer).height(),imageWidth=$(image).outerWidth(),imageHeight=$(image).outerHeight(),imageNewWidth=null,imageNewHeight=null;$(image).outerWidth()>imageContainerWidth&&(imageNewWidth=imageContainerWidth),$(image).outerHeight()>imageContainerHeight&&(imageNewHeight=imageContainerHeight);var scale=1;if(imageNewWidth||imageNewHeight)if(imageNewWidth&&!imageNewHeight)scale=imageNewWidth/imageWidth;else scale=imageNewHeight&&!imageNewWidth?imageNewHeight/imageHeight:Math.min(imageNewWidth/imageWidth,imageNewHeight/imageHeight);$(image).transform({scale:[scale,scale]})}alignToParent(target,options,options.containers.image.image.horizontalAlign,options.containers.image.image.verticalAlign,image)}function alignSets(target,options,setContainers){setContainers=setContainers||getSetContainers(0,options);for(var setContainer=null,setContainerData=null,setWidth=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideShowActivity:set"),setWidth=$(setContainer).width(),$(setContainer).css("left",setWidth*setContainerData.id+"px")}function alignToParent(target,options,horizontalAlign,verticalAlign,container){if($(container).css("position","absolute"),horizontalAlign)switch(horizontalAlign.toLowerCase()){case"left":$(container).css("right",null).css("left","0px");break;case"right":$(container).css("left",null).css("right","0px");break;case"center":$(container).css("right",null).css("left",$(container).parent().innerWidth()/2-$(container).outerWidth()/2+"px")}if(verticalAlign)switch(verticalAlign.toLowerCase()){case"top":$(container).css("bottom",null).css("top","0px");break;case"bottom":$(container).css("top",null).css("bottom","0px");break;case"middle":$(container).css("bottom",null).css("top",$(container).parent().innerHeight()/2-$(container).outerHeight()/2+"px")}}return this},$.fn.slideShowActivity.defaults={},$.fn.slideShowActivity.defaults.containers={activity:{reference:null,css:{identifier:"softchalk-slide-show-activity"}},content:{reference:null,css:{identifier:"softchalk-slide-show-activity-content",enabled:"enabled",disabled:"disabled"}},choice:{reference:null,css:{identifier:"softchalk-slide-show-activity-sets",animating:"animating"}},set:{references:[],css:{identifier:"softchalk-slide-show-activity-set",selected:"selected"}},more:{container:{css:{identifier:"softchalk-slide-show-activity-more-container",animating:"animating"}},background:{css:{identifier:"softchalk-slide-show-activity-more-background"}},content:{css:{identifier:"softchalk-slide-show-activity-more-content"}}},image:{container:{references:null,css:{identifier:"softchalk-slide-show-activity-image-container"}},image:{references:null,horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-slide-show-activity-image"}}}},$.fn.slideShowActivity.defaults.data={dataSets:[],enabled:!0,enableLogging:!1,animate:!0},$.fn.slideShowActivity.defaults.accessibility={pseudoMouse:{allow:!0,mice:[]},keyboard:{allow:!0},hasFocus:!1},$.fn.slideShowActivity.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery),function($){$.fn.slideSlotActivity=function(action,options){var shouldReturnResults=!1,results=[],params=null;"object"==typeof(action=action||"initialize")&&(options=action,action="initialize"),"initialize"==action?options=options?$.extend(!0,{},$.fn.slideSlotActivity.defaults,options):$.fn.slideSlotActivity.defaults:params=options;var optionsReference=options;if($(this).each(function(){switch(action){case"initialize":log(this,optionsReference,"Action:Initializing Activity","info"),function(target,options){(options=$.extend(!0,{},options)).containers.activity.reference=target,$(options.containers.activity.reference).addClass(options.containers.activity.css.identifier),options.containers.content.reference=target,$(options.containers.content.reference).addClass(options.containers.content.css.identifier),null==options.containers.choice.reference&&(options.containers.choice.reference=$("<div />"),$(options.containers.content.reference).append(options.containers.choice.reference));options.containers.choice.reference.addClass(options.containers.choice.css.identifier),$(target).data("slideSlotActivity:options",options)}(this,optionsReference);break;case"loadXMLAndBuildActivity":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Loading XML","info"),function(target,options,url){log(target,options,"Loading XML","info");var id=$(options.containers.activity.reference).parents(".softchalk-activity-wrapper").attr("id"),data=window[id.replace("-","")+"XML"],options=$(target).data("slideSlotActivity:options");parseXMLAndBuildActivity(target,options,data)}(this,options);break;case"parseXMLAndBuildActivity":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Parsing XML","info"),parseXMLAndBuildActivity(this,options,params);break;case"calculateScore":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Calculating Score","info"),calculateScore(this,options);break;case"reset":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Resetting Activity","info"),function(target,options){if(options.data.allowRetry){log(target,options,"Resetting Activity","info");var setContainers=getSetContainers(target,options),activeSet=getActiveSetContainer(target,options),activeSetPosition=0,setContainer=null,setContainerData=null,choices=null,setScore=null;options.data.enabled=!0;for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideSlotActivity:set"),setContainer==activeSet&&(activeSetPosition=i),(options.data.gradeSetsIndividually&&setContainer==activeSet||!options.data.gradeSetsIndividually)&&(setContainerData.attempts=0,setContainerData.completed=!1,setContainerData.focusedChoiceId=null,setContainerData.focusedChoiceRow=-1,setContainerData.focusedChoiceColumn=-1,$(setContainer).data("slideSlotActivity:set",setContainerData),choices=getChoicesInSet(target,options,setContainer),clearChoicesHover(target,options,choices),clearCorrectAndIncorrectInSet(target,options,setContainer),clearSelectedChoices(target,options,choices),setScore=calculateSetScore(target,options,setContainer),setScore.calculatedScore,setScore.calculatedPossible,options.data.randomizeOnRetry&&(randomizeChoicePositionsInSet(target,options,setContainer),positionChoices(target,options,choices)),$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).removeClass(options.containers.set.css.completed));enableDisable(target,options);var setPosition=$(activeSet).data("slideSlotActivity:set").id;!options.data.gradeSetsIndividually&&options.data.randomizeOnRetry&&(setPosition=Math.floor(Math.random()*setContainers.length)),setContainer=setContainers[setPosition],setContainerData=$(setContainer).data("slideSlotActivity:set"),showSet(target,options,setContainerData.id,setContainers,!1,!0),activeSet=getActiveSetContainer(target,options);for(var i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideSlotActivity:set"),setContainer==activeSet&&(activeSetPosition=i);$(target).data("slideSlotActivity:options",options),$(target).trigger("reset.slideSlotActivity",[setContainers.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually]),calculateActivityScore(target,options,!1)}}(this,options);break;case"finish":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Finishing Activity","info"),calculateActivityScore(this,options,!0,!0);break;case"showNextSet":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Showing Next Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i<setContainers.length-1){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i+1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i+1]).data("slideSlotActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"showPreviousSet":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Showing Previous Set","info"),function(target,options){var setContainers=getSetContainers(target,options),currentSetContainer=getActiveSetContainer(target,options),setData=null;if(currentSetContainer)for(var i=0;i<setContainers.length;i++)if(setContainers[i]==currentSetContainer&&i>0){var width=$(options.containers.choice.reference).outerWidth(),finalPosition=-width*[i-1];options.data.animate?$(options.containers.choice.reference).stop(!0,!1).addClass(options.containers.choice.css.animating).animate({left:finalPosition},"slow",null,function(){$(this).removeClass(options.containers.choice.css.animating)}):$(options.containers.choice.reference).css("left",finalPosition+"px"),setData=$(setContainers[i-1]).data("slideSlotActivity:set"),showSet(target,options,setData.id,setContainers);break}}(this,options);break;case"getState":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Getting Activity State","info"),shouldReturnResults=!0,results.push({target:this,result:function(target,options){for(var activityState={enabled:options.data.enabled,allowRetry:options.data.allowRetry,randomizeOnRetry:options.data.randomizeOnRetry,activeSetId:function(target,options){return $(getActiveSetContainer(target,options)).data("slideSlotActivity:set").id||null}(target,options),sets:[]},setContainers=getSetContainers(target,options),i=0;i<setContainers.length;i++)activityState.sets.push(getSetState(target,options,setContainers[i]));return activityState}(this,options)});break;case"setState":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Setting Activity State","info"),function(target,options,activityState,completed){log(target,options,"Setting Activity State");var setData=null,setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,choices=null;showSet(target,options,activityState.activeSetId,!1,!0);for(var i=0;i<activityState.sets.length;i++){setData=activityState.sets[i];for(var j=0;j<setContainers.length;j++)setContainer=setContainers[j],setContainerData=$(setContainer).data("slideSlotActivity:set"),choices=getChoicesInSet(target,options,setContainer),setData.id==setContainerData.id&&setSetState(target,options,setContainer,setData),positionChoices(target,options,choices)}options.data.enabled=activityState.enabled,options.data.allowRetry=activityState.allowRetry,options.data.randomizeOnRetry=activityState.randomizeOnRetry,$(target).data("slideSlotActivity:options",options),enableDisable(target,options),calculateActivityScore(target,options,!1,completed,!0)}(this,options,params.state,params.completed);break;case"getEnabled":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Getting Enabled","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.enabled});break;case"setEnabled":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Setting Enabled","info"),options.data.enabled=params,$(this).data("slideSlotActivity:options",options),enableDisable(this,options);break;case"getSetIds":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Getting Set Ids","info");for(var setContainers=getSetContainers(this,options),setContainer=null,setContainerData=null,setIds=[],i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideSlotActivity:set"),setIds.push(setContainerData.id);shouldReturnResults=!0,results.push({target:this,result:setIds});break;case"getNumberOfSets":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Getting number of sets","info"),shouldReturnResults=!0,results.push({target:this,result:getSetContainers(this,options).length});break;case"showSet":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Getting number of sets","info"),showSet(this,options,params);break;case"getAllowReset":log(this,options=$(this).data("slideSlotActivity:options"),"Action:Getting allow reset","info"),shouldReturnResults=!0,results.push({target:this,result:options.data.allowRetry});break;case"resize":var options;log(this,options=$(this).data("slideSlotActivity:options"),"Action:Resizing the activity","info"),function(target,options){alignSets(target,options);for(var setContainers=getSetContainers(target,options),setContainer=null,setContainerData=null,choices=null,choiceDimensions=null,i=(calculateContainerPadding(target,options,options.containers.choice.reference),0);i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideSlotActivity:set"),choices=getChoicesInSet(target,options,setContainer),choiceDimensions=calculateChoiceDimensions(target,options,setContainerData.rows.length,setContainerData.columns),resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,choices),positionChoices(target,options,choices),alignChoices(target,options,choices);log(target,options,"Activity Container Resized","info")}(this,options)}}),1==shouldReturnResults)return results;function log(target,options,data,level){level=level||"debug",level=$.trim(level).toLowerCase(),options.data.enableLogging&&window.console&&("info"==level&&window.console.info&&options.logging.info?$(target).attr("id")?window.console.info("[slideSlotActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.info("[slideSlotActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.info("[slideSlotActivity]["+target+"]"+data):"warn"==level&&window.console.warn&&options.logging.warn?$(target).attr("id")?window.console.warn("[slideSlotActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.warn("[slideSlotActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.warn("[slideSlotActivity]["+target+"]"+data):"error"==level&&window.console.error&&options.logging.error?$(target).attr("id")?window.console.error("[slideSlotActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.error("[slideSlotActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.error("[slideSlotActivity]["+target+"]"+data):window.console.log&&options.logging.debug&&($(target).attr("id")?window.console.log("[slideSlotActivity]["+target+", id="+$(target).attr("id")+"]"+data):$(target).attr("name")?window.console.log("[slideSlotActivity]["+target+", name="+$(target).attr("name")+"]"+data):window.console.log("[slideSlotActivity]["+target+"]"+data)))}function registerAccessibilityEvents(target,options,choices){var handleMiceEvents=function(event){var options=$(this).data("slideSlotActivity:options");if(options.data.enabled&&event.pageX&&event.pageY){var offset=$(this).offset(),width=$(this).outerWidth(),height=$(this).outerHeight();!options.accessibility.hasFocus&&event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height?(options.accessibility.hasFocus=!0,$(this).data("slideSlotActivity:options",options)):options.accessibility.hasFocus&&(event.pageX<offset.left||event.pageX>offset.left+width||event.pageY<offset.top||event.pageY>offset.top+height)&&(options.accessibility.hasFocus=!1,$(this).data("slideSlotActivity:options",options))}};$(target).bind("mouseover",handleMiceEvents).bind("mouseout",handleMiceEvents).bind("mousemove",handleMiceEvents),$(target).bind("focusin",function(event){var options=$(this).data("slideSlotActivity:options");if(options.data.enabled&&!options.accessibility.hasFocus){log(target,options,"Giving Focus","info"),options.accessibility.hasFocus=!0,$(this).data("slideSlotActivity:options",options);var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("slideSlotActivity:set");(activeSetData.focusedChoiceRow<0||activeSetData.focusedChoiceColumn<0||!activeSetData.focusedChoiceId)&&focusChoiceInSet(target,options,activeSet,null,0,0,!1)}}),$(target).bind("focusout",function(event){var options=$(this).data("slideSlotActivity:options");options.data.enabled&&options.accessibility.hasFocus&&(options.accessibility.hasFocus=!1,$(this).data("slideSlotActivity:options",options))}),options.accessibility.keyboard.allow&&function(target,options,choices){$(document).keydown(function(event){var options=$(target).data("slideSlotActivity:options");if(options.data.enabled&&options.accessibility.keyboard.allow&&options.accessibility.hasFocus){var activeSet=getActiveSetContainer(target,options),activeSetData=$(activeSet).data("slideSlotActivity:set");switch(event.keyCode){case 38:activeSetData.focusedChoiceRow-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow-1,activeSetData.focusedChoiceColumn);break;case 40:activeSetData.focusedChoiceRow+1<activeSetData.rows&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow+1,activeSetData.focusedChoiceColumn);break;case 37:activeSetData.focusedChoiceColumn-1>=0&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn-1);break;case 39:activeSetData.focusedChoiceColumn+1<activeSetData.columns&&focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn+1);break;case 32:focusChoiceInSet(target,options,activeSet,null,activeSetData.focusedChoiceRow,activeSetData.focusedChoiceColumn,!0);break;case 13:calculateActivityScore(target,options)}}})}(target),options.accessibility.pseudoMouse.allow&&function(target,options,choices){for(var pseudoMice=options.accessibility.pseudoMouse.mice,mouse=null,offset=null,width=null,height=null,container=null,found=!1,i=0;i<pseudoMice.length;i++)mouse=pseudoMice[i],$(mouse).bind("mousemove",function(event){var options=$(target).data("slideSlotActivity:options");if(options.data.enabled){var event2=new $.Event("mousemove");event2.pageX=event.pageX,event2.pageY=event.pageY,$(target).trigger(event2)}if((options=$(target).data("slideSlotActivity:options")).data.enabled&&options.accessibility.hasFocus)for(var activeSet=getActiveSetContainer(target,options),choices=getChoicesInSet(target,options,activeSet),j=0;j<choices.length;j++)found=!1,container=$(choices[j]).children("."+options.containers.choices.downarrow.css.identifier).first(),offset=$(container).offset(),$(container).hasClass(options.containers.choices.container.css.hover)?(event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&(found=!0)),found||$(container).trigger("mouseout")):event.pageX>=offset.left&&event.pageY>=offset.top&&(width=$(container).outerWidth(),height=$(container).outerHeight(),event.pageX<=offset.left+width&&event.pageY<=offset.top+height&&$(container).trigger("mouseover"))}),$(mouse).bind("mouseup",function(event){var options=$(target).data("slideSlotActivity:options");if(options.data.enabled&&options.accessibility.hasFocus){container=null;for(var j=0;j<choices.length;j++)container=$(choices[j]).children("."+options.containers.choices.downarrow.css.identifier).first(),offset=$(container).offset(),width=$(container).width(),height=$(container).height(),event.pageX>=offset.left&&event.pageX<=offset.left+width&&event.pageY>=offset.top&&event.pageY<=offset.top+height&&$(container).trigger("click")}})}(target,options,choices)}function calculateChoiceDimensions(target,options,rows,columns){var containerWidth=$(options.containers.choice.reference).width(),containerHeight=$(options.containers.choice.reference).height(),borderTestDiv=$("<div />").css("display","none").addClass(options.containers.choices.container.css.identifier).width(100).height(100);return $(target).append(borderTestDiv),containerWidth-=($(borderTestDiv).outerWidth()-$(borderTestDiv).innerWidth())/2+2,containerHeight-=($(borderTestDiv).outerHeight()-$(borderTestDiv).innerHeight())/2*(2*rows),$(borderTestDiv).remove(),{width:containerWidth,height:containerHeight/rows}}function calculateContainerPadding(target,options,container){var paddingTestDiv=$('<div style="padding:0px 0px 0px 0px;"/>');paddingTestDiv.css("padding-top",$(container).css("padding-top"));var paddingTop=$(paddingTestDiv).height();paddingTestDiv.css("padding-top","0px"),paddingTestDiv.css("padding-right",$(container).css("padding-right"));var paddingRight=$(paddingTestDiv).width();paddingTestDiv.css("padding-right","0px"),paddingTestDiv.css("padding-bottom",$(container).css("padding-bottom"));var paddingBottom=$(paddingTestDiv).height();paddingTestDiv.css("padding-bottom","0px"),paddingTestDiv.css("padding-left",$(container).css("padding-left"));var paddingLeft=$(paddingTestDiv).width();return paddingTestDiv.css("padding-left","0px"),{top:paddingTop,right:paddingRight,bottom:paddingBottom,left:paddingLeft}}function createChoiceContainer(target,options,contentHtml){var choice=$("<div />").addClass(options.containers.choices.container.css.identifier).css("position","absolute"),contentDiv=$("<div />").addClass(options.containers.choices.content.css.identifier);$(choice).append(contentDiv);var feedbackDiv=$("<div />").addClass(options.containers.choices.feedback.css.identifier);$(choice).append(feedbackDiv);var feedbackIconDiv=$("<div />").addClass(options.containers.choices.feedbackIcon.css.identifier);$(choice).append(feedbackIconDiv);var overlayDiv=$("<div />").addClass(options.containers.choices.overlay.css.identifier);$(choice).append(overlayDiv);var leftButtonDiv=$("<div />").addClass(options.containers.choices.leftButton.container.css.identifier);$(choice).append(leftButtonDiv);var leftButton=$("<div />").addClass(options.containers.choices.leftButton.button.css.identifier);$(leftButtonDiv).append(leftButton);var rightButtonDiv=$("<div />").addClass(options.containers.choices.rightButton.container.css.identifier);$(choice).append(rightButtonDiv);var rightButton=$("<div />").addClass(options.containers.choices.rightButton.button.css.identifier);return $(rightButtonDiv).append(rightButton),contentHtml&&$(contentDiv).html(contentHtml),choice}function enableDisable(target,options,choices){log(target,options,"Enabling/Disabling Activity:"+options.data.enabled,"info"),choices=choices||getChoices(target,options),options.data.enabled?($(options.containers.content.reference).removeClass(options.containers.content.css.disabled),$(options.containers.content.reference).addClass(options.containers.content.css.enabled),$(target).trigger("enabled.slideSlotActivity",[options.data.dataSets.length])):($(options.containers.content.reference).removeClass(options.containers.content.css.enabled),$(options.containers.content.reference).addClass(options.containers.content.css.disabled),clearChoicesHover(target,options,choices),$(target).trigger("disabled.slideSlotActivity",[options.data.dataSets.length]))}function resizeChoices(target,options,width,height,choices){choices=choices||getChoices(target,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).width(width),$(choice).height(height)}function positionChoices(target,options,choices,containerPadding){choices=choices||getChoices(target,options),containerPadding=containerPadding||calculateContainerPadding(0,0,options.containers.choice.reference);for(var choiceData=null,choice=null,i=0;i<choices.length;i++)choice=choices[i],choiceData=$(choice).data("slideSlotActivity:choice"),$(choice).css("left",-containerPadding.left+$(choice).outerWidth()*(choiceData.column-1)+"px"),$(choice).css("top",-containerPadding.top+$(choice).outerHeight()*choiceData.row+"px")}function randomizeChoicePositionsInSet(target,options,setContainer){setContainer=setContainer||getActiveSetContainer(target,options);for(var setData=$(setContainer).data("slideSlotActivity:set"),choices=getChoicesInSet(target,options,setContainer),choice=null,choiceData=null,unpositionedChoices=[],i=0;i<choices.length;i++)choice=choices[i],(choiceData=$(choice).data("slideSlotActivity:choice")).column=null,$(choice).data("slideSlotActivity:choice",choiceData),unpositionedChoices.push(choice);var choiceMatrix=[],currentRow=0,currentColumn=0,currentRowArray=null,rowData=null;for(currentRow=0;currentRow<setData.rows.length;currentRow++){for(currentRowArray=[],rowData=setData.rows[currentRow],currentColumn=0;currentColumn<rowData.columns;currentColumn++)currentRowArray.push(null);choiceMatrix.push(currentRowArray)}for(var randomSelector=null,found=!1;unpositionedChoices.length>0;){for(randomSelector=Math.floor(Math.random()*unpositionedChoices.length),choice=unpositionedChoices.splice(randomSelector,1),found=!1,currentRow=(choiceData=$(choice).data("slideSlotActivity:choice")).row,rowData=null,$.each(setData.rows,function(i,data){if(data.id==choiceData.row)return rowData=data,!0}),currentColumn=0;currentColumn<rowData.columns;currentColumn++)choiceMatrix[currentRow][currentColumn]||found||(found=!0,choiceMatrix[currentRow][currentColumn]=choice);choice=null}for(currentRow=0;currentRow<setData.rows.length;currentRow++)for(rowData=setData.rows[currentRow],currentColumn=0;currentColumn<rowData.columns;currentColumn++)choice=choiceMatrix[currentRow][currentColumn],(choiceData=$(choice).data("slideSlotActivity:choice")).column=currentColumn,$(choice).data("slideSlotActivity:choice",choiceData)}function registerChoiceEvents(target,options,choice){$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("mouseover",function(){var options=$(target).data("slideSlotActivity:options"),choiceOptions=$(choice).data("slideSlotActivity:choice"),setOptions=$(choice).parent().data("slideSlotActivity:set");options.data.enabled&&!setOptions.completed&&($(this).hasClass(options.containers.choices.rightButton.container.css.hover)||(clearChoicesHover(target,options),$(this).addClass(options.containers.choices.rightButton.container.css.hover),setOptions.focusedChoiceId=choiceOptions.id,setOptions.focusedChoiceRow=choiceOptions.row,setOptions.focusedChoiceColumn=choiceOptions.column,$(choice).parent().data("slideSlotActivity:set",setOptions),options.accessibility.hasFocus=!0,$(target).data("slideSlotActivity:options",options)))}),$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("mouseout",function(){var options=$(target).data("slideSlotActivity:options"),setOptions=($(choice).data("slideSlotActivity:choice"),$(choice).parent().data("slideSlotActivity:set"));options.data.enabled&&!setOptions.completed&&$(this).hasClass(options.containers.choices.rightButton.container.css.hover)&&($(this).removeClass(options.containers.choices.rightButton.container.css.hover),options.accessibility.hasFocus=!0,$(target).data("slideSlotActivity:options",options))}),$(choice).children("."+options.containers.choices.rightButton.container.css.identifier).bind("click",function(event){var options=$(target).data("slideSlotActivity:options"),setOptions=($(choice).data("slideSlotActivity:choice"),$(choice).parent().data("slideSlotActivity:set"));if(options.data.enabled&&!setOptions.completed&&!$(choice).hasClass(options.containers.choices.container.css.animating)){var shouldRecalculate=!1;shiftRow(target,options,null,$(this).parent(),1),setOptions.gradeIndividually?shouldRecalculate=!0:(setOptions.allowRetry||!setOptions.allowRetry&&0==setOptions.attempts)&&(shouldRecalculate=!0),options.accessibility.hasFocus=!0,$(target).data("slideSlotActivity:options",options),shouldRecalculate&&calculateActivityScore(target,options)}}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("mouseover",function(){var options=$(target).data("slideSlotActivity:options"),choiceOptions=$(choice).data("slideSlotActivity:choice"),setOptions=$(choice).parent().data("slideSlotActivity:set");options.data.enabled&&!setOptions.completed&&($(this).hasClass(options.containers.choices.leftButton.container.css.hover)||(clearChoicesHover(target,options),$(this).addClass(options.containers.choices.leftButton.container.css.hover),setOptions.focusedChoiceId=choiceOptions.id,setOptions.focusedChoiceRow=choiceOptions.row,setOptions.focusedChoiceColumn=choiceOptions.column,$(choice).parent().data("slideSlotActivity:set",setOptions),options.accessibility.hasFocus=!0,$(target).data("slideSlotActivity:options",options)))}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("mouseout",function(){var options=$(target).data("slideSlotActivity:options"),setOptions=($(choice).data("slideSlotActivity:choice"),$(choice).parent().data("slideSlotActivity:set"));options.data.enabled&&!setOptions.completed&&$(this).hasClass(options.containers.choices.leftButton.container.css.hover)&&($(this).removeClass(options.containers.choices.leftButton.container.css.hover),options.accessibility.hasFocus=!0,$(target).data("slideSlotActivity:options",options))}),$(choice).children("."+options.containers.choices.leftButton.container.css.identifier).bind("click",function(event){var options=$(target).data("slideSlotActivity:options"),setOptions=($(choice).data("slideSlotActivity:choice"),$(choice).parent().data("slideSlotActivity:set"));if(options.data.enabled&&!setOptions.completed&&!$(choice).hasClass(options.containers.choices.container.css.animating)){var shouldRecalculate=!1;shiftRow(target,options,null,$(this).parent(),-1),setOptions.gradeIndividually?shouldRecalculate=!0:(setOptions.allowRetry||!setOptions.allowRetry&&0==setOptions.attempts)&&(shouldRecalculate=!0),options.accessibility.hasFocus=!0,$(target).data("slideSlotActivity:options",options),shouldRecalculate&&calculateActivityScore(target,options)}})}function shiftRow(target,options,setContainer,choice,columnDelta,wrapAround){log(target,options,choice,"info"),setContainer=setContainer||getActiveSetContainer(target,options),columnDelta=columnDelta||0,wrapAround=wrapAround||!0;var containerPadding=calculateContainerPadding(0,0,options.containers.choice.reference),choiceOptions=$(choice).data("slideSlotActivity:choice"),setOptions=$(setContainer).data("slideSlotActivity:set"),allChoicesInSet=getChoicesInSet(target,options,setContainer),rowData=null,workingChoice=null,workingChoiceData=null;if(options.data.animate)for(var i=0;i<allChoicesInSet.length;i++)workingChoice=allChoicesInSet[i],(workingChoiceData=$(workingChoice).data("slideSlotActivity:choice")).row==choiceOptions.row&&($.each(setOptions.rows,function(index,data){if(data.id==workingChoiceData.row)return rowData=data,!0}),workingChoiceData.column,$(workingChoice).css("left",-containerPadding.left+$(workingChoice).outerWidth()*(workingChoiceData.column-1)),workingChoiceData.column+=columnDelta,$(workingChoice).data("slideSlotActivity:choice",workingChoiceData),$(workingChoice).addClass(options.containers.choices.container.css.animating),2==rowData.columns&&columnDelta<0&&(workingChoiceData.column<0?workingChoiceData.column+=rowData.columns:workingChoiceData.column>=rowData.columns&&(workingChoiceData.column-=rowData.columns),$(workingChoice).css("left",-containerPadding.left+$(workingChoice).outerWidth()*workingChoiceData.column)),$(workingChoice).animate({left:-containerPadding.left+$(workingChoice).outerWidth()*(workingChoiceData.column-1)},"slow",null,function(){var reference=this;setTimeout(function(){$(reference).removeClass(options.containers.choices.container.css.animating);var data=$(reference).data("slideSlotActivity:choice");data.column<0?data.column+=rowData.columns:data.column>=rowData.columns&&(data.column-=rowData.columns),$(reference).data("slideSlotActivity:choice",data),$(reference).css("left",-containerPadding.left+$(reference).outerWidth()*(data.column-1))},50)}));else{for(i=0;i<allChoicesInSet.length;i++)workingChoice=allChoicesInSet[i],(workingChoiceData=$(workingChoice).data("slideSlotActivity:choice")).row==choiceOptions.row&&($.each(setOptions.rows,function(index,data){if(data.id==workingChoiceData.row)return rowData=data,!0}),workingChoiceData.column+=columnDelta,workingChoiceData.column<0?workingChoiceData.column+=rowData.columns:workingChoiceData.column>=rowData.columns&&(workingChoiceData.column-=rowData.columns),$(workingChoice).data("slideSlotActivity:choice",workingChoiceData));positionChoices(target,options)}}function getSetContainers(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier)||[]}function getActiveSetContainer(target,options){return $(options.containers.choice.reference).children("."+options.containers.set.css.identifier).filter("."+options.containers.set.css.selected)[0]||null}function getChoices(target,options){var activeSetContainer=getActiveSetContainer(0,options);return $(activeSetContainer).children("."+options.containers.choices.container.css.identifier)||[]}function getChoicesInSet(target,options,setContainer){return $(setContainer).children("."+options.containers.choices.container.css.identifier)||[]}function clearChoicesHover(target,options,choices){choices||(choices=getChoices(0,options));for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.hover)}function focusChoiceInSet(target,options,setContainer,id,row,column,selectChoice){log(target,options,"Focusing Choice:{id:"+id+",row:"+row+",column:"+column+"}","info");var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null;selectChoice=selectChoice||!1,clearChoicesHover(0,options,choices);for(var i=0;i<choices.length;i++)choice=choices[i],id==(choiceOptions=$(choice).data("slideSlotActivity:choice")).id?($(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("click")):row==choiceOptions.row&&column==choiceOptions.column?($(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseover"),selectChoice&&$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("click")):$(choice).children("."+options.containers.choices.downarrow.css.identifier).trigger("mouseout")}function clearSelectedChoices(target,options,choices){choices=choices||getChoices(0,options);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.selected)}function parseXMLAndBuildActivity(target,options,data){log(target,options,"Parsing Activity XML","info");try{if(window.ActiveXObject){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.loadXML(data),data=doc}else window.DOMParser&&(data=(new DOMParser).parseFromString(data,"text/xml"))}catch(error){data=null,log(target,options,"XML Parse Error:{error:"+error+"}","error")}if(data){var activityData={allowRetry:!0,randomizeOnRetry:!0,gradeSetsIndividually:!1,dataSets:[]},dataSet=null,choice=null;$(data).children("slideSlotActivity").find("allowRetry").first()&&(activityData.allowRetry="true"==$(data).children("slideSlotActivity").find("allowRetry").first().text().toLowerCase()),$(data).children("slideSlotActivity").attr("randomizeOnRetry")&&(activityData.randomizeOnRetry="true"==$(data).children("slideSlotActivity").attr("randomizeOnRetry").toLowerCase()),$(data).children("slideSlotActivity").attr("gradeSetsIndividually")&&(activityData.gradeSetsIndividually="true"==$(data).children("slideSlotActivity").attr("gradeSetsIndividually").toLowerCase()),$(data).children("slideSlotActivity").children("set").each(function(){dataSet={id:$(this).attr("id"),allowRetry:!1,showFeedback:!0,gradeIndividually:!1,autoComplete:!1,title:$(this).children("title:first").text(),rows:[],choices:[]},$(this).children("title:first").attr("encoding")&&(dataSet.title=unescape(dataSet.title.replace(/\+/g," "))),$(this).children("choices").children("choice").each(function(){choice={id:$(this).attr("id"),content:$(this).text(),value:parseFloat($(this).attr("value")),correct:"true"==$(this).attr("correct").toLowerCase(),row:parseFloat($(this).attr("row")),selectOnce:!1};var rowDataFound=!1;$.each(dataSet.rows,function(i,rowData){if(rowData.id==choice.row)return rowDataFound=!0,rowData.columns++,!0}),rowDataFound||dataSet.rows.push({id:choice.row,columns:1}),$(this).attr("encoding")&&(choice.content=unescape(choice.content.replace(/\+/g," "))),$(this).attr("selectOnce")&&(choice.selectOnce="true"==$(this).attr("selectOnce").toLowerCase()),dataSet.choices.push(choice)}),activityData.dataSets.push(dataSet)}),function(target,options,activityData){var dataSet=null,choiceDimensions=null,currentChoice=(calculateContainerPadding(0,0,options.containers.choice.reference),null),choices=[],choice=null,setContainer=null,columnsInRows=[];if(options.data.allowRetry=activityData.allowRetry,options.data.randomizeOnRetry=activityData.randomizeOnRetry,options.data.gradeSetsIndividually=activityData.gradeSetsIndividually,options.data.overridePoints||0==options.data.overridePoints){var totalCorrectPoints=0;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.correct&&(totalCorrectPoints+=choice.value)})}),0!=totalCorrectPoints&&0!=options.data.overridePoints||(totalCorrectPoints=0,$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.correct&&(options.data.overridePoints>0?(choice.value=1,totalCorrectPoints++):choice.value=0)})}));var factor=options.data.overridePoints/totalCorrectPoints;$.each(activityData.dataSets,function(i,dataSet){$.each(dataSet.choices,function(j,choice){choice.value=choice.value*factor})})}for(var rowData=null,i=0;i<activityData.dataSets.length;i++){dataSet=$.extend({},activityData.dataSets[i],{choices:[],attempts:0,focusedChoiceId:null,focusedChoiceRow:-1,focusedChoiceColumn:-1,completed:!1}),options.data.dataSets.push(dataSet),choiceDimensions=calculateChoiceDimensions(target,options,dataSet.rows.length),choice=null;for(var j=0;j<activityData.dataSets[i].choices.length;j++)choice=activityData.dataSets[i].choices[j],rowData=null,$.each(columnsInRows,function(k,data){data.id==choice.row&&(rowData=data)}),rowData||(rowData={id:choice.row,columns:0},columnsInRows.push(rowData)),currentChoice=createChoiceContainer(0,options,choice.content),$(currentChoice).data("slideSlotActivity:choice",{id:choice.id,row:choice.row,column:rowData.columns,value:choice.value,correct:choice.correct,selectOnce:choice.selectOnce}),registerChoiceEvents(target,options,currentChoice),dataSet.choices.push(currentChoice),choices.push(currentChoice),rowData.columns++;setContainer=createSetContainer(target,options),options.containers.set.references.push(setContainer),$(setContainer).data("slideSlotActivity:set",dataSet),$(options.containers.choice.reference).append(setContainer);for(var j=0;j<dataSet.choices.length;j++)$(setContainer).append(dataSet.choices[j]);resizeChoices(target,options,choiceDimensions.width,choiceDimensions.height,dataSet.choices),randomizeChoicePositionsInSet(target,options,setContainer),positionChoices(target,options,dataSet.choices),alignChoices(target,options,dataSet.choices)}registerAccessibilityEvents(target,options,choices),enableDisable(target,options,choices),$(target).data("slideSlotActivity:options",options),alignSets(target,options),showSet(target,options,activityData.dataSets[0].id),calculateActivityScore(target,options,!1),$(target).trigger("activityLoaded.slideSlotActivity",[options.data.dataSets.length,0,options.data.allowRetry,options.data.gradeSetsIndividually])}(target,options,activityData)}else log(target,options,"XML Activity Build Error:{error:No data to build activity}","error")}function createSetContainer(target,options){return $("<div />").addClass(options.containers.set.css.identifier)}function showSet(target,options,id,setContainers,reset,resetPosition){setContainers=setContainers||getSetContainers(0,options),reset=reset||!1,resetPosition=resetPosition||!1;for(var setContainer=null,setContainerData=null,selectedSetContainerData=null,setPosition=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideSlotActivity:set"),$(setContainer).removeClass(options.containers.set.css.selected),setContainerData.id==id&&(setPosition=i,selectedSetContainerData=setContainerData,setContainer,$(setContainer).addClass(options.containers.set.css.selected));var choices=getChoices(0,options);if(positionChoices(target,options,choices),alignChoices(target,options,choices),reset&&selectedSetContainerData&&(options.data.enabled=!0,enableDisable(target,options,choices),$(target).data("slideSlotActivity:data",options)),resetPosition){var finalPosition=-$(options.containers.choice.reference).outerWidth()*[id];$(options.containers.choice.reference).css("left",finalPosition+"px")}$(target).trigger("titleChanged.slideSlotActivity",[selectedSetContainerData.title]),$(target).trigger("setChanged.slideSlotActivity",[setContainers.length,setPosition,options.data.gradeSetsIndividually,options.data.allowRetry,selectedSetContainerData.completed,options.data.enabled])}function getSetState(target,options,setContainer){for(var setContainerData=$(setContainer).data("slideSlotActivity:set"),setState={id:setContainerData.id,allowRetry:setContainerData.allowRetry,showFeedback:setContainerData.showFeedback,gradeIndividually:setContainerData.gradeIndividually,attempts:setContainerData.attempts,completed:setContainerData.completed,rows:setContainerData.rows,choices:[]},setChoices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,normalizedChoiceData=null,i=0;i<setChoices.length;i++)choice=setChoices[i],normalizedChoiceData={id:(choiceOptions=$(choice).data("slideSlotActivity:choice")).id,row:choiceOptions.row,column:choiceOptions.column,correct:choiceOptions.correct,value:choiceOptions.value,selected:$(choice).hasClass(options.containers.choices.container.css.selected),finished:$(choice).hasClass(options.containers.choices.container.css.correct)||$(choice).hasClass(options.containers.choices.container.css.incorrect)||!1},setState.choices.push(normalizedChoiceData);return setState}function setSetState(target,options,setContainer,setState){log(target,options,"Setting Set State:"+setState.id);var setContainerData=$(setContainer).data("slideSlotActivity:set");setContainerData.allowRetry=setState.allowRetry,setContainerData.showFeedback=setState.showFeedback,setContainerData.gradeIndividually=setState.gradeIndividually,setContainerData.attempts=setState.attempts,setContainerData.completed=setState.completed,setContainerData.rows=setState.rows,$(setContainer).data("slideSlotActivity:set",setContainerData),setContainerData.completed&&!$(setContainer).hasClass(options.containers.set.css.completed)&&$(setContainer).addClass(options.containers.set.css.completed);for(var setChoices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,normalizedChoiceData=null,i=0;i<setChoices.length;i++){choice=setChoices[i],choiceOptions=$(choice).data("slideSlotActivity:choice");for(var j=0;j<setState.choices.length;j++)(normalizedChoiceData=setState.choices[j]).id==choiceOptions.id&&(choiceOptions.row=normalizedChoiceData.row,choiceOptions.column=normalizedChoiceData.column,choiceOptions.correct=normalizedChoiceData.correct,choiceOptions.value=normalizedChoiceData.value,$(choice).removeClass(options.containers.choices.container.css.selected),normalizedChoiceData.selected&&$(choice).addClass(options.containers.choices.container.css.selected),normalizedChoiceData.finished&&(normalizedChoiceData.correct?$(choice).addClass(options.containers.choices.container.css.correct):$(choice).addClass(options.containers.choices.container.css.incorrect)));$(choice).data("slideSlotActivity:choice",choiceOptions)}}function calculateActivityScore(target,options,incrementAttempts,autoCompleteOverride,doNotUpdateExternalScore){incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1,doNotUpdateExternalScore=doNotUpdateExternalScore||!1;for(var choiceSets=getSetContainers(0,options),activeSet=getActiveSetContainer(0,options),activeSetPosition=0,setScore=null,calculatedScore=0,calculatedPossible=0,totalCorrect=0,totalIncorrect=0,correctSelected=0,incorrectSelected=0,i=0;i<choiceSets.length;i++)choiceSets[i]==activeSet&&(activeSetPosition=i),calculatedScore+=(setScore=options.data.gradeSetsIndividually&&choiceSets[i]==activeSet?calculateSetScore(target,options,choiceSets[i],incrementAttempts,autoCompleteOverride):options.data.gradeSetsIndividually&&choiceSets[i]!=activeSet?calculateSetScore(target,options,choiceSets[i],!1,!1):calculateSetScore(target,options,choiceSets[i],incrementAttempts,autoCompleteOverride)).calculatedScore,calculatedPossible+=setScore.calculatedPossible,totalCorrect+=setScore.totalCorrect,totalIncorrect+=setScore.totalIncorrect,correctSelected+=setScore.correctSelected,incorrectSelected+=setScore.incorrectSelected,$(target).trigger("setScoreChanged.slideSlotActivity",[options.data.dataSets.length,i,options.data.allowRetry,options.data.gradeSetsIndividually,setScore.calculatedScore,setScore.calculatedPossible,$(choiceSets[i]).data("slideSlotActivity:set").completed,doNotUpdateExternalScore]);return log(target,options,"Score Recalculated:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityScoreChanged.slideSlotActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,$(activeSet).data("slideSlotActivity:set").completed,doNotUpdateExternalScore]),!options.data.gradeSetsIndividually&&autoCompleteOverride&&(options.data.enabled=!1,$(target).data("slideSlotActivity:options",options),enableDisable(target,options),log(target,options,"Activity Completed:"+calculatedScore+"/"+calculatedPossible,"info"),$(target).trigger("activityComplete.slideSlotActivity",[options.data.dataSets.length,activeSetPosition,options.data.allowRetry,options.data.gradeSetsIndividually,calculatedScore,calculatedPossible,doNotUpdateExternalScore])),{calculatedScore:calculatedScore,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}}function calculateSetScore(target,options,setContainer,incrementAttempts,autoCompleteOverride){setContainer=setContainer||getActiveSetContainer(0,options),incrementAttempts=incrementAttempts||!0,autoCompleteOverride=autoCompleteOverride||!1;var setData=$(setContainer).data("slideSlotActivity:set"),setState=getSetState(0,options,setContainer),scoreResults=options.data.calculateScore(setState);return setData.gradeIndividually?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!0):setData.autoComplete&&scoreResults.totalCorrect==scoreResults.correctSelected||1==autoCompleteOverride?(setData.completed=!0,$(setContainer).hasClass(options.containers.set.css.completed)||$(setContainer).addClass(options.containers.set.css.completed),setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1),incrementAttempts&&setData.attempts++):(clearCorrectAndIncorrectInSet(target,options,setContainer),setData.completed?setData.showFeedback&&showCorrectAndIncorrect(target,options,setContainer,!1):scoreResults.calculatedScore=0),$(setContainer).data("slideSlotActivity:set",setData),scoreResults}function showCorrectAndIncorrect(target,options,setContainer,showOnlySelected){if(setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,options.data.enabled)for(var choices=getChoicesInSet(0,options,setContainer),choice=null,choiceOptions=null,i=0;i<choices.length;i++)choice=choices[i],choiceOptions=$(choice).data("slideSlotActivity:choice"),!0?choiceOptions.correct?($(choice).removeClass(options.containers.choices.container.css.incorrect),$(choice).hasClass(options.containers.choices.container.css.correct)||$(choice).addClass(options.containers.choices.container.css.correct)):($(choice).removeClass(options.containers.choices.container.css.correct),$(choice).hasClass(options.containers.choices.container.css.incorrect)||$(choice).addClass(options.containers.choices.container.css.incorrect)):($(choice).removeClass(options.containers.choices.container.css.correct),$(choice).removeClass(options.containers.choices.container.css.incorrect))}function clearCorrectAndIncorrectInSet(target,options,setContainer,showOnlySelected){setContainer=setContainer||getActiveSetContainer(0,options),showOnlySelected=showOnlySelected||!0,choices=getChoicesInSet(0,options,setContainer);for(var choice=null,i=0;i<choices.length;i++)choice=choices[i],$(choice).removeClass(options.containers.choices.container.css.incorrect),$(choice).removeClass(options.containers.choices.container.css.correct)}function alignChoices(target,options,choices){if(choices=choices||getChoices(0,options))for(var choice=null,choiceContent=null,leftContent=null,rightContent=null,feedbackIconContent=null,i=0;i<choices.length;i++)choice=choices[i],choiceContent=$(choice).children("."+options.containers.choices.content.css.identifier+":first"),leftContent=$(choice).find("."+options.containers.choices.leftButton.button.css.identifier+":first"),rightContent=$(choice).find("."+options.containers.choices.rightButton.button.css.identifier+":first"),feedbackIconContent=$(choice).find("."+options.containers.choices.feedbackIcon.css.identifier+":first"),alignToParent(target,options,options.containers.choices.content.horizontalAlign,options.containers.choices.content.verticalAlign,choiceContent),alignToParent(target,options,"left","middle",leftContent),alignToParent(target,options,"right","middle",rightContent),alignToParent(target,options,options.containers.choices.feedbackIcon.horizontalAlign,options.containers.choices.feedbackIcon.verticalAlign,feedbackIconContent)}function alignSets(target,options,setContainers){setContainers=setContainers||getSetContainers(0,options);for(var setContainer=null,setContainerData=null,setWidth=0,i=0;i<setContainers.length;i++)setContainer=setContainers[i],setContainerData=$(setContainer).data("slideSlotActivity:set"),setWidth=$(setContainer).width(),$(setContainer).css("left",setWidth*setContainerData.id+"px")}function alignToParent(target,options,horizontalAlign,verticalAlign,container){if($(container).css("position","absolute"),horizontalAlign)switch(horizontalAlign.toLowerCase()){case"left":$(container).css("right",null).css("left","0px");break;case"right":$(container).css("left",null).css("right","0px");break;case"center":$(container).css("right",null).css("left",$(container).parent().innerWidth()/2-$(container).outerWidth()/2+"px")}if(verticalAlign)switch(verticalAlign.toLowerCase()){case"top":$(container).css("bottom",null).css("top","0px");break;case"bottom":$(container).css("top",null).css("bottom","0px");break;case"middle":$(container).css("bottom",null).css("top",$(container).parent().innerHeight()/2-$(container).outerHeight()/2+"px")}}return this},$.fn.slideSlotActivity.defaults={},$.fn.slideSlotActivity.defaults.containers={activity:{reference:null,css:{identifier:"softchalk-slide-slot-activity"}},content:{reference:null,css:{identifier:"softchalk-slide-slot-activity-content",enabled:"enabled",disabled:"disabled"}},choice:{reference:null,css:{identifier:"softchalk-slide-slot-activity-sets",animating:"animating"}},set:{references:[],css:{identifier:"softchalk-slide-slot-activity-set",selected:"selected",completed:"completed"}},choices:{references:[],container:{css:{identifier:"softchalk-slide-slot-activity-choice",selected:"selected",correct:"correct",incorrect:"incorrect",hover:"hover",animating:"animating"}},content:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-slide-slot-activity-choice-content"}},leftButton:{container:{css:{identifier:"softchalk-slide-slot-activity-choice-left-button-container",hover:"hover"}},button:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-slide-slot-activity-choice-left-button",hover:"hover"}}},rightButton:{container:{css:{identifier:"softchalk-slide-slot-activity-choice-right-button-container",hover:"hover"}},button:{horizontalAlign:"center",verticalAlign:"middle",css:{identifier:"softchalk-slide-slot-activity-choice-right-button",hover:"hover"}}},feedback:{css:{identifier:"softchalk-slide-slot-activity-choice-feedback"}},feedbackIcon:{horizontalAlign:"right",verticalAlign:"middle",css:{identifier:"softchalk-slide-slot-activity-choice-feedback-icon"}},overlay:{css:{identifier:"softchalk-slide-slot-activity-choice-overlay"}}}},$.fn.slideSlotActivity.defaults.data={dataSets:[],calculateScore:function(setState){for(var calculatedCorrect=0,calculatedIncorrect=0,calculatedPossible=0,choiceData=null,correctSelected=0,incorrectSelected=0,totalCorrect=0,totalIncorrect=0,i=0;i<setState.choices.length;i++)1==(choiceData=setState.choices[i]).correct?(totalCorrect++,calculatedPossible+=choiceData.value):totalIncorrect++,1==choiceData.column&&(1==choiceData.correct?(calculatedCorrect+=choiceData.value,correctSelected++):(calculatedIncorrect+=choiceData.value,incorrectSelected++));Math.max(0,calculatedCorrect-calculatedIncorrect);return{calculatedScore:calculatedCorrect,calculatedPossible:calculatedPossible,totalCorrect:totalCorrect,totalIncorrect:totalIncorrect,correctSelected:correctSelected,incorrectSelected:incorrectSelected}},enabled:!0,enableLogging:!1,allowRetry:!0,randomizeOnRetry:!0,animate:!0,gradeSetsIndividually:!1,overridePoints:null},$.fn.slideSlotActivity.defaults.accessibility={pseudoMouse:{allow:!0,mice:[]},keyboard:{allow:!0},hasFocus:!1},$.fn.slideSlotActivity.defaults.logging={debug:!1,info:!0,warn:!1,error:!1}}(jQuery);
